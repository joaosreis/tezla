{ storage
    (pair (pair (address %collector) (pair (nat %id) (nat %limit)))
          (pair (list %previousWinners address)
                (pair (address %t_addr) (map %ticketToAddress nat address)))) ;
  parameter nat ;
  code { UNPAIR ;
         AMOUNT ;
         PUSH mutez 1000000 ;
         DUP 3 ;
         MUL ;
         COMPARE ;
         EQ ;
         IF {}
            { PUSH string "WrongCondition: sp.tez(params) == sp.amount" ; FAILWITH } ;
         PUSH mutez 0 ;
         SWAP ;
         DUP ;
         DUG 2 ;
         DIG 3 ;
         DUP ;
         CAR ;
         GET 3 ;
         SWAP ;
         DUP ;
         DUG 5 ;
         CAR ;
         GET 4 ;
         SUB ;
         ISNAT ;
         IF_NONE { PUSH int 172 ; FAILWITH } {} ;
         DUP 4 ;
         COMPARE ;
         GT ;
         IF { DROP 2 ;
              SWAP ;
              DUP ;
              CAR ;
              GET 3 ;
              SWAP ;
              DUP ;
              DUG 3 ;
              CAR ;
              GET 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 172 ; FAILWITH } {} ;
              PUSH mutez 1000000 ;
              DIG 3 ;
              DUP ;
              CAR ;
              GET 3 ;
              SWAP ;
              DUP ;
              DUG 5 ;
              CAR ;
              GET 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 172 ; FAILWITH } {} ;
              DUP 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 175 ; FAILWITH } {} ;
              MUL ;
              SWAP }
            {} ;
         DUP ;
         PUSH nat 1 ;
         ADD ;
         PUSH nat 1 ;
         DUP ;
         DUP 3 ;
         COMPARE ;
         GT ;
         LOOP { DUP 6 ;
                UNPAIR ;
                SWAP ;
                UNPAIR ;
                SWAP ;
                UNPAIR ;
                SWAP ;
                SENDER ;
                SOME ;
                DIG 10 ;
                CAR ;
                GET 3 ;
                UPDATE ;
                SWAP ;
                PAIR ;
                SWAP ;
                PAIR ;
                SWAP ;
                UNPAIR ;
                SWAP ;
                UNPAIR ;
                PUSH nat 1 ;
                ADD ;
                PAIR ;
                SWAP ;
                PAIR ;
                PAIR ;
                DUG 5 ;
                PUSH nat 1 ;
                ADD ;
                DUP ;
                DUP 3 ;
                COMPARE ;
                GT } ;
         DROP 2 ;
         PUSH mutez 0 ;
         DUP 3 ;
         COMPARE ;
         GT ;
         IF { NIL operation ;
              SENDER ;
              CONTRACT unit ;
              IF_NONE { PUSH int 183 ; FAILWITH } {} ;
              DUP 4 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS }
            { NIL operation } ;
         DUP 5 ;
         GET 5 ;
         CONTRACT %transfer (pair (address %from_) (pair (address %to_) (nat %value))) ;
         IF_NONE { PUSH int 186 ; FAILWITH } {} ;
         PUSH mutez 0 ;
         PUSH nat 354 ;
         DUP 7 ;
         MUL ;
         SENDER ;
         PAIR %to_ %value ;
         SELF_ADDRESS ;
         PAIR %from_ ;
         TRANSFER_TOKENS ;
         CONS ;
         PUSH nat 5 ;
         DUP 6 ;
         CAR ;
         GET 3 ;
         COMPARE ;
         EQ ;
         IF { DUP 5 ;
              GET 6 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-04-22T17:01:53Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 208 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 211 ; FAILWITH } {} ;
              CONTRACT unit ;
              IF_NONE { PUSH int 211 ; FAILWITH } {} ;
              PUSH mutez 4000000 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS ;
              DUP 5 ;
              CAR ;
              CAR ;
              CONTRACT unit ;
              IF_NONE { PUSH int 212 ; FAILWITH } {} ;
              PUSH mutez 1000000 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS ;
              DUP 5 ;
              UNPAIR ;
              SWAP ;
              CDR ;
              DIG 6 ;
              DUP ;
              GET 3 ;
              SWAP ;
              GET 6 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-04-22T17:01:53Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 208 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 213 ; FAILWITH } {} ;
              CONS ;
              PAIR ;
              SWAP ;
              UNPAIR ;
              SWAP ;
              CDR ;
              PUSH nat 0 ;
              PAIR ;
              SWAP ;
              PAIR ;
              PAIR ;
              DUP ;
              DUG 5 ;
              CAR ;
              GET 4 ;
              PUSH nat 0 ;
              DUP ;
              DUP 3 ;
              COMPARE ;
              GT ;
              LOOP { DIG 6 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     NONE address ;
                     DUP 6 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUG 6 ;
                     PUSH nat 1 ;
                     ADD ;
                     DUP ;
                     DUP 3 ;
                     COMPARE ;
                     GT } ;
              DROP 2 ;
              SWAP ;
              DROP ;
              SWAP ;
              DROP ;
              SWAP ;
              DROP }
            { SWAP ; DROP ; SWAP ; DROP ; SWAP ; DROP } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
