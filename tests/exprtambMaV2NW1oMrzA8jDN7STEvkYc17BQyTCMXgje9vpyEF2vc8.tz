{ parameter
    (or (or (or (pair %addLiquidity (pair address nat) (pair nat timestamp))
                (pair %approve (pair address nat) nat))
            (or (unit %default)
                (pair %removeLiquidity
                   (pair (pair address address) (pair nat mutez))
                   (pair nat timestamp))))
        (or (or (pair %setBaker (option key_hash) bool)
                (pair %tokenToXtz (pair (pair address address) (pair nat mutez)) timestamp))
            (or (nat %updateTokenPool) (pair %xtzToToken (pair address nat) timestamp)))) ;
  storage
    (pair (big_map %accounts address (pair (map %allowances address nat) (nat %balance)))
          (pair %s
             (pair (pair (bool %freeze_baker) (nat %lqt_total))
                   (pair (address %manager) (address %token_address)))
             (nat %token_pool))) ;
  code { EMPTY_MAP address nat ;
         DUP ;
         NIL operation ;
         SWAP ;
         LAMBDA
           mutez
           nat
           { PUSH mutez 1 ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             EDIV ;
             IF_NONE { FAILWITH } {} ;
             CAR ;
             DIP { DROP } } ;
         SWAP ;
         LAMBDA
           nat
           mutez
           { PUSH mutez 1 ; DIG 1 ; DUP ; DUG 2 ; MUL ; DIP { DROP } } ;
         SWAP ;
         LAMBDA
           (pair (map address nat)
                 (pair address (big_map address (pair (map %allowances address nat) (nat %balance)))))
           (pair (map %allowances address nat) (nat %balance))
           { DUP ;
             CAR ;
             SWAP ;
             CDR ;
             DUP ;
             CDR ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             CAR ;
             GET ;
             IF_NONE
               { PUSH nat 0 ; DIG 2 ; DUP ; DUG 3 ; PAIR }
               { DUP ; DIP { DROP } } ;
             DIP { DROP 2 } } ;
         SWAP ;
         APPLY ;
         DIG 5 ;
         DUP ;
         DUG 6 ;
         CDR ;
         DIG 6 ;
         DUP ;
         DUG 7 ;
         CAR ;
         IF_LEFT
           { DUP ;
             IF_LEFT
               { DUP ;
                 IF_LEFT
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     PAIR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CDR ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     CAR ;
                     CAR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CDR ;
                     CAR ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CDR ;
                     NIL operation ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH nat 0 ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH mutez 0 ;
                     AMOUNT ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH nat 0 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     PAIR ;
                     PUSH nat 0 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     CDR ;
                     CAR ;
                     CAR ;
                     CDR ;
                     COMPARE ;
                     GT ;
                     IF { AMOUNT ;
                          BALANCE ;
                          SUB ;
                          DIG 18 ;
                          DUP ;
                          DUG 19 ;
                          SWAP ;
                          EXEC ;
                          AMOUNT ;
                          DIG 19 ;
                          DUP ;
                          DUG 20 ;
                          SWAP ;
                          EXEC ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 9 ;
                          DUP ;
                          DUG 10 ;
                          CDR ;
                          CDR ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          MUL ;
                          EDIV ;
                          IF_NONE { FAILWITH } {} ;
                          CAR ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 10 ;
                          DUP ;
                          DUG 11 ;
                          CDR ;
                          CAR ;
                          CAR ;
                          CDR ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          MUL ;
                          EDIV ;
                          IF_NONE { FAILWITH } {} ;
                          CAR ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 12 ;
                          DUP ;
                          DUG 13 ;
                          COMPARE ;
                          GE ;
                          IF { PUSH unit Unit } { FAILWITH } ;
                          DIG 13 ;
                          DUP ;
                          DUG 14 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          COMPARE ;
                          GE ;
                          IF { PUSH unit Unit } { FAILWITH } ;
                          DIG 12 ;
                          DUP ;
                          DUG 13 ;
                          CAR ;
                          DIG 16 ;
                          DUP ;
                          DUG 17 ;
                          PAIR ;
                          DIG 22 ;
                          DUP ;
                          DUG 23 ;
                          SWAP ;
                          EXEC ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CDR ;
                          ADD ;
                          DIG 14 ;
                          DUP ;
                          DUG 15 ;
                          DIG 15 ;
                          DUP ;
                          DUG 16 ;
                          CAR ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          CAR ;
                          PAIR ;
                          DIG 20 ;
                          DUP ;
                          DUG 21 ;
                          SWAP ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          CDR ;
                          CAR ;
                          CAR ;
                          CDR ;
                          ADD ;
                          DIP { DUP ;
                                CAR ;
                                SWAP ;
                                CDR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                CAR } ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          CDR ;
                          CDR ;
                          ADD ;
                          DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          CDR ;
                          CAR ;
                          CDR ;
                          CDR ;
                          CONTRACT %transfer (pair (pair address address) nat) ;
                          IF_NONE { FAILWITH } {} ;
                          DUP ;
                          PUSH mutez 0 ;
                          DIG 11 ;
                          DUP ;
                          DUG 12 ;
                          SELF ;
                          ADDRESS ;
                          DIG 25 ;
                          DUP ;
                          DUG 26 ;
                          PAIR ;
                          PAIR ;
                          TRANSFER_TOKENS ;
                          NIL operation ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CONS ;
                          DIG 14 ;
                          DUP ;
                          DUG 15 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 5 ;
                          DUP ;
                          DUG 6 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP 14 } }
                        { PUSH mutez 1000000 ;
                          AMOUNT ;
                          COMPARE ;
                          GE ;
                          IF { PUSH unit Unit } { FAILWITH } ;
                          BALANCE ;
                          DIG 19 ;
                          DUP ;
                          DUG 20 ;
                          SWAP ;
                          EXEC ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIP { DUP ;
                                CAR ;
                                SWAP ;
                                CDR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                CAR } ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CAR ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          DIG 25 ;
                          DUP ;
                          DUG 26 ;
                          PAIR ;
                          DIG 15 ;
                          DUP ;
                          DUG 16 ;
                          SWAP ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          DIG 12 ;
                          DUP ;
                          DUG 13 ;
                          DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DUP ;
                          CDR ;
                          CAR ;
                          CDR ;
                          CDR ;
                          CONTRACT %transfer (pair (pair address address) nat) ;
                          IF_NONE { FAILWITH } {} ;
                          DUP ;
                          PUSH mutez 0 ;
                          DIG 15 ;
                          DUP ;
                          DUG 16 ;
                          SELF ;
                          ADDRESS ;
                          DIG 19 ;
                          DUP ;
                          DUG 20 ;
                          PAIR ;
                          PAIR ;
                          TRANSFER_TOKENS ;
                          NIL operation ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CONS ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 5 ;
                          DUP ;
                          DUG 6 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP 8 } } ;
                     DUP ;
                     DIP { DROP 13 } }
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     PAIR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     CAR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     SENDER ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     COMPARE ;
                     NEQ ;
                     IF { DUP ;
                          CAR ;
                          SENDER ;
                          PAIR ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          SWAP ;
                          EXEC ;
                          DUP ;
                          CAR ;
                          PUSH nat 0 ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          PAIR ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          GET ;
                          IF_NONE
                            { DIG 1 ; DUP ; DUG 2 }
                            { DIG 2 ; DUP ; DUG 3 ; DIG 1 ; DUP ; DUG 2 ; DIP { DROP 2 } } ;
                          DIG 7 ;
                          DUP ;
                          DUG 8 ;
                          CDR ;
                          CAR ;
                          COMPARE ;
                          EQ ;
                          IF { DIG 2 ;
                               DUP ;
                               DUG 3 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CAR ;
                               CDR ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               SWAP ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               CAR ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               CDR ;
                               DIG 3 ;
                               DUP ;
                               DUG 4 ;
                               PAIR ;
                               SOME ;
                               SENDER ;
                               UPDATE ;
                               SWAP ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               DIG 2 ;
                               DUP ;
                               DUG 3 ;
                               DIG 2 ;
                               DUP ;
                               DUG 3 ;
                               SWAP ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               SWAP ;
                               CAR ;
                               PAIR ;
                               DIP { DROP 2 } }
                             { FAILWITH } ;
                          DIG 5 ;
                          DUP ;
                          DUG 6 ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CDR ;
                          DIP { DROP 6 } }
                        { FAILWITH } ;
                     DUP ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     PAIR ;
                     DIP { DROP 5 } } ;
                 DIP { DROP } }
               { DUP ;
                 IF_LEFT
                   { NIL operation ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DIP { DROP 2 } }
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CDR ;
                     CAR ;
                     PAIR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CAR ;
                     CDR ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     CAR ;
                     CAR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CDR ;
                     CAR ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     CDR ;
                     CAR ;
                     CAR ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     CDR ;
                     CDR ;
                     NIL operation ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH mutez 0 ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH nat 0 ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH nat 0 ;
                     DIG 8 ;
                     DUP ;
                     DUG 9 ;
                     COMPARE ;
                     GT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     PUSH nat 0 ;
                     DIG 6 ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     GET ;
                     IF_NONE
                       { FAILWITH }
                       { DIG 12 ;
                         DUP ;
                         DUG 13 ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DUP ;
                              CAR ;
                              SENDER ;
                              GET ;
                              IF_NONE
                                { FAILWITH }
                                { DIG 11 ;
                                  DUP ;
                                  DUG 12 ;
                                  DIG 1 ;
                                  DUP ;
                                  DUG 2 ;
                                  COMPARE ;
                                  GE ;
                                  IF { PUSH unit Unit } { FAILWITH } ;
                                  DIG 12 ;
                                  DUP ;
                                  DUG 13 ;
                                  DIG 3 ;
                                  DUP ;
                                  DUG 4 ;
                                  CDR ;
                                  COMPARE ;
                                  GE ;
                                  IF { PUSH unit Unit } { FAILWITH } ;
                                  DIG 4 ;
                                  DUP ;
                                  DUG 5 ;
                                  DIG 3 ;
                                  DUP ;
                                  DUG 4 ;
                                  DIP { DROP 4 } } ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              DIG 1 ;
                              DUP ;
                              DUG 2 ;
                              DIP { DROP 2 } }
                            { DUP ;
                              CDR ;
                              DIG 11 ;
                              DUP ;
                              DUG 12 ;
                              DIG 1 ;
                              DUP ;
                              DUG 2 ;
                              COMPARE ;
                              GE ;
                              IF { PUSH unit Unit } { FAILWITH } ;
                              DIG 3 ;
                              DUP ;
                              DUG 4 ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              DIP { DROP 3 } } ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         DIG 1 ;
                         DUP ;
                         DUG 2 ;
                         DIP { DROP 3 } } ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     CDR ;
                     CAR ;
                     CAR ;
                     CDR ;
                     BALANCE ;
                     DIG 22 ;
                     DUP ;
                     DUG 23 ;
                     SWAP ;
                     EXEC ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     MUL ;
                     EDIV ;
                     IF_NONE { FAILWITH } {} ;
                     CAR ;
                     DIG 20 ;
                     DUP ;
                     DUG 21 ;
                     SWAP ;
                     EXEC ;
                     DIG 10 ;
                     DUP ;
                     DUG 11 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     DIG 9 ;
                     DUP ;
                     DUG 10 ;
                     CDR ;
                     CAR ;
                     CAR ;
                     CDR ;
                     DIG 10 ;
                     DUP ;
                     DUG 11 ;
                     CDR ;
                     CDR ;
                     DIG 14 ;
                     DUP ;
                     DUG 15 ;
                     MUL ;
                     EDIV ;
                     IF_NONE { FAILWITH } {} ;
                     CAR ;
                     DIG 11 ;
                     DUP ;
                     DUG 12 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     DIG 11 ;
                     DUP ;
                     DUG 12 ;
                     CAR ;
                     DIG 17 ;
                     DUP ;
                     DUG 18 ;
                     PAIR ;
                     DIG 23 ;
                     DUP ;
                     DUG 24 ;
                     SWAP ;
                     EXEC ;
                     DIG 15 ;
                     DUP ;
                     DUG 16 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     SUB ;
                     PUSH nat 0 ;
                     PUSH int 0 ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     COMPARE ;
                     GE ;
                     IF { DUP ; DIG 2 ; DUP ; DUG 3 ; ABS ; DIP { DROP } } { FAILWITH } ;
                     DIG 15 ;
                     DUP ;
                     DUG 16 ;
                     DIG 16 ;
                     DUP ;
                     DUG 17 ;
                     CAR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     DIG 6 ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     PAIR ;
                     DIG 23 ;
                     DUP ;
                     DUG 24 ;
                     SWAP ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     CDR ;
                     SWAP ;
                     PAIR ;
                     DIG 19 ;
                     DUP ;
                     DUG 20 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CAR ;
                     CAR ;
                     CDR ;
                     SUB ;
                     PUSH int 0 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          ABS ;
                          DIP { DUP ;
                                CAR ;
                                SWAP ;
                                CDR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                DUP ;
                                CDR ;
                                SWAP ;
                                CAR ;
                                CAR } ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP } }
                        { FAILWITH } ;
                     DIG 8 ;
                     DUP ;
                     DUG 9 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     SUB ;
                     PUSH int 0 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          ABS ;
                          DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP } }
                        { FAILWITH } ;
                     DIG 23 ;
                     DUP ;
                     DUG 24 ;
                     DIG 14 ;
                     DUP ;
                     DUG 15 ;
                     SUB ;
                     PUSH nat 0 ;
                     PUSH int 0 ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     COMPARE ;
                     GE ;
                     IF { DUP ; DIG 2 ; DUP ; DUG 3 ; ABS ; DIP { DROP } } { FAILWITH } ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     SENDER ;
                     DIG 30 ;
                     DUP ;
                     DUG 31 ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     CAR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     COMPARE ;
                     NEQ ;
                     IF { DUP ;
                          CAR ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          PAIR ;
                          DIG 39 ;
                          DUP ;
                          DUG 40 ;
                          SWAP ;
                          EXEC ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          CAR ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          CAR ;
                          DIG 9 ;
                          DUP ;
                          DUG 10 ;
                          CDR ;
                          CAR ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          SWAP ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DIG 7 ;
                          DUP ;
                          DUG 8 ;
                          SWAP ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP 2 } }
                        { DUP } ;
                     DUP ;
                     DIP { DROP 5 } ;
                     DIG 28 ;
                     DUP ;
                     DUG 29 ;
                     CONTRACT unit ;
                     IF_NONE { FAILWITH } {} ;
                     DUP ;
                     DIG 18 ;
                     DUP ;
                     DUG 19 ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CONTRACT %transfer (pair (pair address address) nat) ;
                     IF_NONE { FAILWITH } {} ;
                     DUP ;
                     PUSH mutez 0 ;
                     DIG 19 ;
                     DUP ;
                     DUG 20 ;
                     DIG 34 ;
                     DUP ;
                     DUG 35 ;
                     SELF ;
                     ADDRESS ;
                     PAIR ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     NIL operation ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CONS ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CONS ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DIP { DROP 37 } } ;
                 DIP { DROP } } ;
             DIP { DROP } }
           { DUP ;
             IF_LEFT
               { DUP ;
                 IF_LEFT
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DUP ;
                     CDR ;
                     NIL operation ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          PAIR ;
                          PUSH bool False ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          CDR ;
                          CAR ;
                          CAR ;
                          CAR ;
                          COMPARE ;
                          EQ ;
                          IF { NIL operation ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               CAR ;
                               CAR ;
                               SET_DELEGATE ;
                               CONS ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               SWAP ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CAR ;
                               CDR ;
                               DIP { DUP ;
                                     CAR ;
                                     SWAP ;
                                     CDR ;
                                     DUP ;
                                     CDR ;
                                     SWAP ;
                                     CAR ;
                                     DUP ;
                                     CDR ;
                                     SWAP ;
                                     CAR ;
                                     CDR } ;
                               PAIR ;
                               PAIR ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               CAR ;
                               PAIR ;
                               DIP { DROP } }
                             { FAILWITH } ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CAR ;
                          SWAP ;
                          CDR ;
                          SWAP ;
                          PAIR ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          PAIR ;
                          DIP { DROP 2 } }
                        { FAILWITH } ;
                     DUP ;
                     DIP { DROP 6 } }
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     PAIR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CDR ;
                     CAR ;
                     PAIR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CAR ;
                     CDR ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     CDR ;
                     CAR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     NIL operation ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CDR ;
                     CAR ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     AMOUNT ;
                     BALANCE ;
                     SUB ;
                     PUSH nat 997 ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     MUL ;
                     PUSH nat 1000 ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     CDR ;
                     CDR ;
                     MUL ;
                     ADD ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     DIG 14 ;
                     DUP ;
                     DUG 15 ;
                     SWAP ;
                     EXEC ;
                     PUSH nat 997 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     MUL ;
                     MUL ;
                     EDIV ;
                     IF_NONE { FAILWITH } {} ;
                     CAR ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     SWAP ;
                     EXEC ;
                     DIG 6 ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     CDR ;
                     CDR ;
                     ADD ;
                     DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DIG 8 ;
                     DUP ;
                     DUG 9 ;
                     CAR ;
                     CAR ;
                     CDR ;
                     CONTRACT unit ;
                     IF_NONE { FAILWITH } {} ;
                     DUP ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CONTRACT %transfer (pair (pair address address) nat) ;
                     IF_NONE { FAILWITH } {} ;
                     DUP ;
                     PUSH mutez 0 ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     SELF ;
                     ADDRESS ;
                     DIG 15 ;
                     DUP ;
                     DUG 16 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     NIL operation ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CONS ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     CONS ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DIP { DROP 15 } } ;
                 DIP { DROP } }
               { DUP ;
                 IF_LEFT
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DUP ;
                     CDR ;
                     NIL operation ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CDR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { FAILWITH }
                        { DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          CAR ;
                          DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP } } ;
                     DUP ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     PAIR ;
                     DIP { DROP 5 } }
                   { DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     PAIR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CDR ;
                     CDR ;
                     NIL operation ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CAR ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     AMOUNT ;
                     BALANCE ;
                     SUB ;
                     DIG 11 ;
                     DUP ;
                     DUG 12 ;
                     SWAP ;
                     EXEC ;
                     AMOUNT ;
                     DIG 12 ;
                     DUP ;
                     DUG 13 ;
                     SWAP ;
                     EXEC ;
                     PUSH nat 997 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     MUL ;
                     PUSH nat 1000 ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     MUL ;
                     ADD ;
                     DIG 5 ;
                     DUP ;
                     DUG 6 ;
                     CDR ;
                     CDR ;
                     PUSH nat 997 ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     MUL ;
                     MUL ;
                     EDIV ;
                     IF_NONE { FAILWITH } {} ;
                     CAR ;
                     DIG 6 ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     CDR ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { PUSH unit Unit } { FAILWITH } ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     DIG 7 ;
                     DUP ;
                     DUG 8 ;
                     CDR ;
                     CDR ;
                     SUB ;
                     PUSH int 0 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     GE ;
                     IF { DIG 7 ;
                          DUP ;
                          DUG 8 ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          ABS ;
                          DIP { DUP ; CAR ; SWAP ; CDR ; CAR } ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DIP { DROP } }
                        { FAILWITH } ;
                     DUP ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CONTRACT %transfer (pair (pair address address) nat) ;
                     IF_NONE { FAILWITH } {} ;
                     DUP ;
                     PUSH mutez 0 ;
                     DIG 6 ;
                     DUP ;
                     DUG 7 ;
                     DIG 13 ;
                     DUP ;
                     DUG 14 ;
                     CAR ;
                     CAR ;
                     SELF ;
                     ADDRESS ;
                     PAIR ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     NIL operation ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     CONS ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     PAIR ;
                     DIP { DROP 14 } } ;
                 DIP { DROP } } ;
             DIP { DROP } } ;
         DIP { DROP 7 } } }
