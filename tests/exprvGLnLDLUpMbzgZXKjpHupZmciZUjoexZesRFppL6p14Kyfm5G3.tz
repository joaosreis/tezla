{ parameter
    (or (list %transfer
           (pair (address %from_)
                 (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount))))))
        (unit %u)) ;
  storage (pair (big_map %tokenMeta nat string) (big_map %tokenOwners nat address)) ;
  code { DUP ;
         CDR ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         CAR ;
         IF_LEFT
           { DIG 1 ;
             DUP ;
             DUG 2 ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             PAIR ;
             DUP ;
             CDR ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             CAR ;
             ITER { SWAP ;
                    PAIR ;
                    DUP ;
                    CDR ;
                    DUP ;
                    CAR ;
                    SENDER ;
                    DIG 1 ;
                    DUP ;
                    DUG 2 ;
                    COMPARE ;
                    NEQ ;
                    IF { PUSH string "FA2_NOT_OWNER" ; FAILWITH } { PUSH unit Unit } ;
                    DIG 1 ;
                    DUP ;
                    DUG 2 ;
                    DIG 4 ;
                    DUP ;
                    DUG 5 ;
                    CAR ;
                    PAIR ;
                    DIG 3 ;
                    DUP ;
                    DUG 4 ;
                    CDR ;
                    ITER { SWAP ;
                           PAIR ;
                           DUP ;
                           CAR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CDR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CAR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CDR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CDR ;
                           CAR ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CAR ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           CDR ;
                           CDR ;
                           PAIR ;
                           PAIR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CDR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CDR ;
                           GET ;
                           IF_NONE
                             { PUSH string "FA2_TOKEN_UNDEFINED" ; FAILWITH }
                             { DIG 2 ;
                               DUP ;
                               DUG 3 ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               COMPARE ;
                               EQ ;
                               IF { DUP } { PUSH string "FA2_INSUFFICIENT_BALANCE" ; FAILWITH } ;
                               DIP { DROP } } ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           DIG 5 ;
                           DUP ;
                           DUG 6 ;
                           PAIR ;
                           DUP ;
                           CAR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CDR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CDR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CAR ;
                           CDR ;
                           SOME ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           UPDATE ;
                           SWAP ;
                           CAR ;
                           PAIR ;
                           DIP { DROP 3 } ;
                           PAIR ;
                           DIP { DROP 7 } } ;
                    DUP ;
                    CAR ;
                    DIP { DROP 5 } } ;
             DUP ;
             NIL operation ;
             PAIR ;
             DIP { DROP 3 } }
           { DIG 1 ; DUP ; DUG 2 ; NIL operation ; PAIR ; DIP { DROP } } ;
         DIP { DROP 2 } } }
