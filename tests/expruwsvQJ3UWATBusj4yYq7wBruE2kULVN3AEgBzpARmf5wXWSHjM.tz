{ parameter
    (or (or (or (unit %DelayedReward) (or (unit %ExerciseSecurity) (nat %IncreaseCollateral)))
            (or (or (nat %IncreaseLoan) (pair %InterestAccured unit (contract nat)))
                (or (pair %OpenLoan (nat %amount) (nat %loan) (nat %type))
                    (pair %OracleLiquidate
                       (pair (address %address) (nat %penality))
                       (nat %price)
                       (nat %ratio)
                       (nat %stabilityFees)))))
        (or (or (or (pair %PurchaseSecurity (nat %duration) (nat %order) (address %securityDelegator))
                    (pair %Repay (nat %Operation) (nat %amount)))
                (or (unit %SwitchInterestRate) (nat %TransferToken)))
            (or (or (pair %UpdateParameter (address %address) (nat %interest))
                    (nat %WithdrawCollateral))
                (or (unit %default) (option %delegate key_hash))))) ;
  storage
    (pair (pair (pair (bool %Closed) (timestamp %Insurance) (bool %Liquidated))
                (bool %Reward)
                (timestamp %duration)
                (nat %interest))
          (pair (nat %interestRate) (address %owner) (address %securityDelegator))
          (nat %token)
          (address %validator)
          (nat %xtz)) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { DROP ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "Sender is not Authorized to recive baking rewards" ; FAILWITH } ;
                     DUP ;
                     CAR ;
                     CAR ;
                     CAR ;
                     IF {} { PUSH string "Vault is not Closed" ; FAILWITH } ;
                     DUP ;
                     GET 8 ;
                     PUSH nat 0 ;
                     COMPARE ;
                     LT ;
                     IF { DUP ;
                          GET 3 ;
                          GET 3 ;
                          CONTRACT unit ;
                          IF_NONE { PUSH int 252 ; FAILWITH } {} ;
                          NIL operation ;
                          SWAP ;
                          BALANCE ;
                          UNIT ;
                          TRANSFER_TOKENS ;
                          CONS ;
                          SWAP ;
                          PUSH nat 0 ;
                          UPDATE 8 ;
                          SWAP }
                        { NIL operation } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     GET 4 ;
                     IF { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          CAR ;
                          PUSH bool False ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          DUP ;
                          DUG 2 ;
                          GET 7 ;
                          CONTRACT %UpdateLiquidateOwner address ;
                          IF_NONE { PUSH string " updating vault owner call failed" ; FAILWITH } {} ;
                          PUSH mutez 0 ;
                          DUP 4 ;
                          GET 3 ;
                          GET 3 ;
                          TRANSFER_TOKENS ;
                          CONS }
                        {} }
                   { IF_LEFT
                       { DROP ;
                         DUP ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         NOW ;
                         SWAP ;
                         COMPARE ;
                         GE ;
                         IF {} { PUSH string "PUT Options have already expired" ; FAILWITH } ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH bool True } { DUP ; GET 3 ; GET 4 ; SENDER ; COMPARE ; EQ } ;
                         IF { UNPAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              NOW ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              GET 7 ;
                              CONTRACT %SecuritiesExercise address ;
                              IF_NONE
                                { PUSH string "call to exercise security to vault factory contract failed" ;
                                  FAILWITH }
                                {} ;
                              NIL operation ;
                              SWAP ;
                              PUSH mutez 0 ;
                              DUP 4 ;
                              GET 3 ;
                              GET 3 ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { NIL operation } }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF { PUSH string "Loan has not been opened yet by the vault." ; FAILWITH }
                            {} ;
                         AMOUNT ;
                         PUSH mutez 1 ;
                         DIG 2 ;
                         MUL ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.mutez(params.amount) == sp.amount" ;
                              FAILWITH } ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 7 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 7 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 45 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         NIL operation } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Sender is not authorized to increase Loan Amount" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF { PUSH string "Closed Vault cannot mint DAL tokens" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         NOW ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string "Insured Vaults cannot Mint more DAL tokens" ; FAILWITH } ;
                         SWAP ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 8 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 8 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 130 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         DIG 2 ;
                         DUP ;
                         GET 5 ;
                         DUP 4 ;
                         ADD ;
                         UPDATE 5 ;
                         DUG 2 ;
                         NIL operation ;
                         PUSH address "KT1K1DbS8ZZY5KzasRiZU1djySfB7WzERrw3" ;
                         CONTRACT %MintToken (pair (pair nat nat) (pair address (pair nat address))) ;
                         IF_NONE
                           { PUSH string "call to oracle to mint stablecoins failed" ; FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DIG 5 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 7 ;
                         CAR ;
                         GET 6 ;
                         DIG 5 ;
                         ADD ;
                         PAIR ;
                         DUP 6 ;
                         GET 3 ;
                         GET 3 ;
                         PAIR ;
                         DIG 4 ;
                         DUP 6 ;
                         GET 8 ;
                         PAIR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { PUSH nat 0 ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF {}
                            { DROP ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              GET 5 ;
                              NOW ;
                              SUB ;
                              ABS ;
                              PUSH nat 31536000000000 ;
                              DUP 4 ;
                              GET 3 ;
                              CAR ;
                              DIG 2 ;
                              DUP 5 ;
                              GET 5 ;
                              MUL ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH int 366 ; FAILWITH } { CAR } ;
                              DUP 3 ;
                              CAR ;
                              GET 6 ;
                              ADD } ;
                         NIL operation ;
                         DIG 2 ;
                         CDR ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         TRANSFER_TOKENS ;
                         CONS } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Sender is not the owner of the vault" ; FAILWITH } ;
                         AMOUNT ;
                         PUSH mutez 1 ;
                         DUP 3 ;
                         CAR ;
                         MUL ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "params.amount and xtz sent are not equal" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF {} { PUSH string " Loan is already Opened" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         IF { PUSH string " Vault is already liquidated" ; FAILWITH } {} ;
                         SWAP ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         GET 5 ;
                         DUP 3 ;
                         GET 3 ;
                         ADD ;
                         UPDATE 5 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         CDR ;
                         PUSH bool False ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         DUP ;
                         GET 4 ;
                         PUSH nat 1 ;
                         COMPARE ;
                         EQ ;
                         IF { SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              PUSH bool False ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP }
                            { SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              PUSH bool True ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP } ;
                         NIL operation ;
                         PUSH address "KT1K1DbS8ZZY5KzasRiZU1djySfB7WzERrw3" ;
                         CONTRACT %MintToken (pair (pair nat nat) (pair address (pair nat address))) ;
                         IF_NONE { PUSH string " oracle call to open loan failed" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DUP 5 ;
                         GET 7 ;
                         PUSH nat 0 ;
                         PAIR ;
                         DUP 6 ;
                         GET 3 ;
                         GET 3 ;
                         PAIR ;
                         DIG 4 ;
                         GET 3 ;
                         DUP 6 ;
                         GET 8 ;
                         PAIR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 7 ;
                         CONTRACT %GetInterestRate (pair address bool) ;
                         IF_NONE
                           { PUSH string "getting the global interest rate call failed" ; FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         DUP ;
                         CAR ;
                         GET 3 ;
                         SWAP ;
                         DUP ;
                         DUG 5 ;
                         GET 3 ;
                         GET 3 ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { PUSH address "KT1K1DbS8ZZY5KzasRiZU1djySfB7WzERrw3" ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Sender is not the Oracle Contract" ; FAILWITH } ;
                         SWAP ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 8 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 8 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 214 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         DUP ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 6 ;
                         DIG 3 ;
                         DUP ;
                         CAR ;
                         GET 6 ;
                         SWAP ;
                         DUP ;
                         DUG 5 ;
                         GET 5 ;
                         ADD ;
                         ADD ;
                         MUL ;
                         PUSH nat 1000000000000 ;
                         DUP 3 ;
                         GET 3 ;
                         DUP 5 ;
                         GET 8 ;
                         MUL ;
                         MUL ;
                         COMPARE ;
                         LT ;
                         IF { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 3 ; NOW ; COMPARE ; GT }
                            { PUSH bool False } ;
                         IF { DUP ;
                              CAR ;
                              CDR ;
                              DUP 3 ;
                              GET 5 ;
                              EDIV ;
                              IF_NONE { PUSH int 219 ; FAILWITH } { CAR } ;
                              NIL operation ;
                              PUSH address "KT1F39AcSLAipyWFfweQ2sF7UiNghH47tvMW" ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE
                                { PUSH string " transferring DAL from Liquidator to vault failed" ; FAILWITH }
                                {} ;
                              PUSH mutez 0 ;
                              DUP 4 ;
                              DUP 6 ;
                              GET 6 ;
                              DIG 7 ;
                              DUP ;
                              CAR ;
                              GET 6 ;
                              SWAP ;
                              DUP ;
                              DUG 9 ;
                              GET 5 ;
                              ADD ;
                              ADD ;
                              ADD ;
                              SELF_ADDRESS ;
                              DUP 7 ;
                              CAR ;
                              CAR ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DUP 4 ;
                              GET 7 ;
                              CONTRACT %burn (pair address (pair address nat)) ;
                              IF_NONE
                                { PUSH string "burning call to vault factory contract failed" ; FAILWITH }
                                {} ;
                              PUSH mutez 0 ;
                              DIG 5 ;
                              DUP ;
                              GET 5 ;
                              SWAP ;
                              DUP ;
                              DUG 7 ;
                              GET 3 ;
                              GET 3 ;
                              SELF_ADDRESS ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              PUSH address "KT1F39AcSLAipyWFfweQ2sF7UiNghH47tvMW" ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE
                                { PUSH string " transferring interest + penality to vault factory contract failed" ;
                                  FAILWITH }
                                {} ;
                              PUSH mutez 0 ;
                              DIG 3 ;
                              DUP 5 ;
                              GET 6 ;
                              DUP 7 ;
                              CAR ;
                              GET 6 ;
                              ADD ;
                              ADD ;
                              DUP 6 ;
                              GET 7 ;
                              SELF_ADDRESS ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIG 2 ;
                              UNPAIR ;
                              UNPAIR ;
                              CDR ;
                              PUSH bool True ;
                              SWAP ;
                              CAR ;
                              PUSH bool True ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PUSH nat 0 ;
                              UPDATE 8 ;
                              PUSH nat 0 ;
                              UPDATE 5 ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              PUSH nat 0 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              DUP 6 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              DUG 2 ;
                              SWAP ;
                              CAR ;
                              CAR ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 243 ; FAILWITH } {} ;
                              BALANCE ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { DROP ; NIL operation } } } } }
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Sender is not the vault's owner" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         PUSH (set nat) { 1 ; 7 ; 14 ; 21 } ;
                         SWAP ;
                         MEM ;
                         IF {} { PUSH string "Invalid Duration for PUT Options contract" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF { PUSH string "Closed Vaults cannot Purchase Securities" ; FAILWITH } {} ;
                         SWAP ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         NOW ;
                         PUSH int 60 ;
                         DUP ;
                         PUSH int 24 ;
                         DUP 9 ;
                         CAR ;
                         INT ;
                         MUL ;
                         MUL ;
                         MUL ;
                         ADD ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DUP 5 ;
                         GET 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 8 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 8 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 302 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         NOW ;
                         NOW ;
                         PUSH int 60 ;
                         DUP ;
                         PUSH int 24 ;
                         DUP 6 ;
                         CAR ;
                         INT ;
                         MUL ;
                         MUL ;
                         MUL ;
                         ADD ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         GET 3 ;
                         CAR ;
                         SWAP ;
                         DUP 4 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         PUSH nat 315360000000 ;
                         SWAP ;
                         EDIV ;
                         IF_NONE { PUSH int 309 ; FAILWITH } { CAR } ;
                         NIL operation ;
                         DUP 4 ;
                         GET 7 ;
                         CONTRACT %SecuritiesPurchase (pair (pair nat nat) (pair address (pair nat nat))) ;
                         IF_NONE
                           { PUSH string "call to purchase security to vault factory contract failed" ;
                             FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DUP 6 ;
                         GET 8 ;
                         DIG 4 ;
                         DIG 6 ;
                         DUP ;
                         CAR ;
                         GET 6 ;
                         SWAP ;
                         DUP ;
                         DUG 8 ;
                         GET 5 ;
                         ADD ;
                         ADD ;
                         PAIR ;
                         DUP 6 ;
                         GET 3 ;
                         GET 3 ;
                         PAIR ;
                         DIG 4 ;
                         DUP ;
                         GET 3 ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF { PUSH string "Loan has not been opened by the vault" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 8 ;
                         GET 3 ;
                         CAR ;
                         DUP 7 ;
                         DIG 9 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 151 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUG 2 ;
                         PUSH nat 1 ;
                         DUP 3 ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { DIG 2 ;
                              DUP ;
                              GET 5 ;
                              SWAP ;
                              DUP ;
                              DUG 4 ;
                              CAR ;
                              GET 6 ;
                              ADD ;
                              DUP 3 ;
                              CDR ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ; DUP ; GET 5 ; SWAP ; DUP ; DUG 4 ; CAR ; GET 6 ; ADD }
                                 { SWAP ; DUP ; DUG 2 ; CDR } ;
                              NIL operation ;
                              PUSH address "KT1F39AcSLAipyWFfweQ2sF7UiNghH47tvMW" ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE
                                { PUSH string "transferring DAL from sender to vault failed" ; FAILWITH }
                                {} ;
                              PUSH mutez 0 ;
                              DUP 4 ;
                              SELF_ADDRESS ;
                              SENDER ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { SWAP ; DUP ; DUG 2 ; CDR ; NIL operation } ;
                         PUSH nat 0 ;
                         DUP 6 ;
                         CAR ;
                         GET 6 ;
                         DUP 4 ;
                         COMPARE ;
                         GT ;
                         IF { DUP 6 ;
                              CAR ;
                              GET 6 ;
                              DUP 4 ;
                              SUB ;
                              ABS ;
                              DUP 7 ;
                              GET 5 ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              COMPARE ;
                              GE ;
                              IF { DROP 2 ;
                                   SWAP ;
                                   DROP ;
                                   SWAP ;
                                   DROP ;
                                   SWAP ;
                                   DROP ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   GET 5 ;
                                   SWAP ;
                                   DUP 3 ;
                                   GET 3 ;
                                   GET 3 ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                                   BALANCE ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS ;
                                   SWAP ;
                                   DIG 2 ;
                                   UNPAIR ;
                                   UNPAIR ;
                                   CDR ;
                                   PUSH bool True ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR ;
                                   PUSH nat 0 ;
                                   UPDATE 8 ;
                                   PUSH nat 0 ;
                                   UPDATE 5 ;
                                   DUG 2 }
                                 { SWAP ;
                                   DROP ;
                                   DIG 2 ;
                                   DROP ;
                                   DIG 2 ;
                                   DROP ;
                                   DIG 2 ;
                                   DROP ;
                                   DUP ;
                                   DUP 4 ;
                                   DIG 2 ;
                                   DIG 4 ;
                                   GET 5 ;
                                   SUB ;
                                   ABS ;
                                   UPDATE 5 ;
                                   DUG 2 } ;
                              DUP 3 ;
                              CAR ;
                              GET 6 ;
                              SWAP ;
                              DIG 3 ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              PUSH nat 0 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              DUG 3 ;
                              DIG 2 ;
                              DUP 4 ;
                              GET 7 ;
                              CONTRACT %burn (pair address (pair address nat)) ;
                              IF_NONE
                                { PUSH string "burning DAL to vault factory contract failed" ; FAILWITH }
                                {} ;
                              PUSH mutez 0 ;
                              DIG 3 ;
                              DUP 6 ;
                              GET 3 ;
                              GET 3 ;
                              SELF_ADDRESS ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              SWAP }
                            { DROP ;
                              DIG 2 ;
                              DROP ;
                              DIG 2 ;
                              DROP ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              DUP 4 ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              DIG 6 ;
                              DIG 7 ;
                              CAR ;
                              GET 6 ;
                              SUB ;
                              ABS ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              DUG 2 } ;
                         SWAP ;
                         PUSH address "KT1F39AcSLAipyWFfweQ2sF7UiNghH47tvMW" ;
                         CONTRACT %transfer (pair address (pair address nat)) ;
                         IF_NONE
                           { PUSH string "transferring interest to vault factory contract failed" ;
                             FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         DUP 5 ;
                         GET 7 ;
                         SELF_ADDRESS ;
                         PAIR 3 ;
                         TRANSFER_TOKENS ;
                         CONS } }
                   { IF_LEFT
                       { DROP ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Sender is not the owner of the vault" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF { PUSH string " Loan is already Closed" ; FAILWITH } {} ;
                         DUP ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         IF { PUSH string " Vault is already liquidated" ; FAILWITH } {} ;
                         DUP ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 315360000000 ;
                         DUP 7 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 7 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 89 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 3 ;
                         CAR ;
                         GET 3 ;
                         NOT ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         GET 7 ;
                         CONTRACT %GetInterestRate (pair address bool) ;
                         IF_NONE
                           { PUSH string "getting the global interest rate call failed" ; FAILWITH }
                           {} ;
                         NIL operation ;
                         SWAP ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         DUP ;
                         CAR ;
                         GET 3 ;
                         SWAP ;
                         DUP ;
                         DUG 5 ;
                         GET 3 ;
                         GET 3 ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Sender is not authorized to withdraw funds from the vault" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         IF {} { PUSH string "WrongCondition: self.data.Closed" ; FAILWITH } ;
                         NIL operation ;
                         PUSH address "KT1F39AcSLAipyWFfweQ2sF7UiNghH47tvMW" ;
                         CONTRACT %transfer (pair address (pair address nat)) ;
                         IF_NONE
                           { PUSH string "transferring surplus DAL to owner failed" ; FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         DUP 5 ;
                         GET 3 ;
                         GET 3 ;
                         SELF_ADDRESS ;
                         PAIR 3 ;
                         TRANSFER_TOKENS ;
                         CONS } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 7 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Sender is not authorized to update parameters" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         DUP 3 ;
                         GET 3 ;
                         GET 3 ;
                         COMPARE ;
                         NEQ ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              IF {}
                                 { PUSH string " Only Closed Vaults OwnerShip can be modified" ; FAILWITH } ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              IF { PUSH string " Vault is already liquidated" ; FAILWITH } {} ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              DUP 5 ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              PUSH bool True ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP }
                            {} ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         CDR ;
                         DIG 3 ;
                         CDR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         NIL operation }
                       { SWAP ;
                         PUSH mutez 1 ;
                         BALANCE ;
                         EDIV ;
                         IF_NONE
                           { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                           {} ;
                         CAR ;
                         UPDATE 8 ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Sender is not Vault Owner" ; FAILWITH } ;
                         DUP ;
                         DUP 3 ;
                         GET 8 ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string "Withdraw Amount is greater than Vault's balance" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         NOW ;
                         SUB ;
                         ABS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH nat 31536000000000 ;
                         DUP 8 ;
                         GET 3 ;
                         CAR ;
                         DIG 6 ;
                         DIG 8 ;
                         GET 5 ;
                         MUL ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 345 ; FAILWITH } { CAR } ;
                         ADD ;
                         NOW ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         DIG 3 ;
                         GET 8 ;
                         SUB ;
                         ABS ;
                         UPDATE 8 ;
                         SWAP ;
                         NIL operation ;
                         PUSH address "KT1K1DbS8ZZY5KzasRiZU1djySfB7WzERrw3" ;
                         CONTRACT %WithdrawCollateral (pair nat nat) ;
                         IF_NONE
                           { PUSH string " call to oracle contract to check vault's collateral Ratio" ;
                             FAILWITH }
                           {} ;
                         PUSH mutez 0 ;
                         DIG 4 ;
                         DUP ;
                         CAR ;
                         GET 6 ;
                         SWAP ;
                         DUP ;
                         DUG 6 ;
                         GET 5 ;
                         ADD ;
                         DUP 6 ;
                         GET 8 ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         GET 3 ;
                         GET 3 ;
                         CONTRACT unit ;
                         IF_NONE { PUSH int 356 ; FAILWITH } {} ;
                         PUSH mutez 1 ;
                         DIG 3 ;
                         MUL ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS } }
                   { IF_LEFT
                       { DROP ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GE ;
                         IF {} { PUSH string "WrongCondition: sp.amount >= sp.tez(0)" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         GET 3 ;
                         IF { PUSH mutez 1 ;
                              BALANCE ;
                              EDIV ;
                              IF_NONE
                                { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                                {} ;
                              CAR ;
                              UPDATE 8 ;
                              NIL operation }
                            { PUSH mutez 1 ;
                              AMOUNT ;
                              EDIV ;
                              IF_NONE
                                { PUSH string "unable to convert balance to nat value" ; FAILWITH }
                                {} ;
                              CAR ;
                              NIL operation ;
                              PUSH address "KT1ThVzAedWjt8BTbwjopfb8yw5qN28LrfWQ" ;
                              CONTRACT %mint (pair address nat) ;
                              IF_NONE { PUSH string "Reward Token could not be minted" ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              DUP 4 ;
                              MUL ;
                              DIG 3 ;
                              DUP 5 ;
                              GET 3 ;
                              GET 3 ;
                              PAIR ;
                              TRANSFER_TOKENS ;
                              CONS } }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Sender is not authorized to change vault's baker" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         IF {}
                            { DUP ;
                              NONE key_hash ;
                              COMPARE ;
                              NEQ ;
                              IF {} { PUSH string "None Value cannot be assigned" ; FAILWITH } } ;
                         SET_DELEGATE ;
                         NIL operation ;
                         SWAP ;
                         CONS } } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
