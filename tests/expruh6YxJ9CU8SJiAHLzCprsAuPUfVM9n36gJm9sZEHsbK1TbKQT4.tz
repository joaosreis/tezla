{ storage
    (pair (pair (big_map %credentials address string)
                (pair (string %modulus) (big_map %timestamps int timestamp)))
          (pair (pair (big_map %vote_commitments_1 address string)
                      (big_map %vote_commitments_2 address string))
                (pair (big_map %vote_commitments_3 address string)
                      (big_map %vote_openings address string)))) ;
  parameter
    (or (string %add_credential)
        (or (string %open_commitment) (pair %vote (int %index) (string %vote_commitment)))) ;
  code { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           { { NOW ;
               DIG 2 ;
               DUP ;
               DUG 3 ;
               CAR ;
               CDR ;
               CDR ;
               PUSH int 0 ;
               GET ;
               IF_NONE { { PUSH string "Get-item:36" ; FAILWITH } } {} ;
               COMPARE ;
               LT ;
               IF { {} }
                  { { PUSH string "WrongCondition: self.data.timestamps[0] < sp.now" ; FAILWITH } } ;
               NOW ;
               DIG 2 ;
               DUP ;
               DUG 3 ;
               CAR ;
               CDR ;
               CDR ;
               PUSH int 1 ;
               GET ;
               IF_NONE { { PUSH string "Get-item:37" ; FAILWITH } } {} ;
               COMPARE ;
               GT ;
               IF { {} }
                  { { PUSH string "WrongCondition: self.data.timestamps[1] > sp.now" ; FAILWITH } } ;
               SWAP ;
               DUP ;
               DUG 2 ;
               CAR ;
               CAR ;
               SENDER ;
               MEM ;
               IF { {} }
                  { { PUSH string "WrongCondition: self.data.credentials.contains(sp.sender)" ;
                      FAILWITH } } ;
               SWAP ;
               DUP ;
               DUG 2 ;
               DUP ;
               CDR ;
               SWAP ;
               CAR ;
               DUP ;
               CDR ;
               SWAP ;
               CAR ;
               DIG 3 ;
               DUP ;
               DUG 4 ;
               SOME ;
               SENDER ;
               UPDATE ;
               PAIR ;
               PAIR ;
               DUG 2 ;
               DROP 2 } }
           { IF_LEFT
               { { NOW ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CAR ;
                   CDR ;
                   CDR ;
                   PUSH int 2 ;
                   GET ;
                   IF_NONE { { PUSH string "Get-item:63" ; FAILWITH } } {} ;
                   COMPARE ;
                   LT ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.timestamps[2] < sp.now" ; FAILWITH } } ;
                   NOW ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CAR ;
                   CDR ;
                   CDR ;
                   PUSH int 3 ;
                   GET ;
                   IF_NONE { { PUSH string "Get-item:64" ; FAILWITH } } {} ;
                   COMPARE ;
                   GT ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.timestamps[3] > sp.now" ; FAILWITH } } ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CAR ;
                   CAR ;
                   SENDER ;
                   MEM ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.vote_commitments_1.contains(sp.sender)" ;
                          FAILWITH } } ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CAR ;
                   CDR ;
                   SENDER ;
                   MEM ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.vote_commitments_2.contains(sp.sender)" ;
                          FAILWITH } } ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CDR ;
                   CAR ;
                   SENDER ;
                   MEM ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.vote_commitments_3.contains(sp.sender)" ;
                          FAILWITH } } ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   DUP ;
                   CAR ;
                   SWAP ;
                   CDR ;
                   DUP ;
                   CAR ;
                   SWAP ;
                   CDR ;
                   DUP ;
                   CAR ;
                   SWAP ;
                   CDR ;
                   DIG 4 ;
                   DUP ;
                   DUG 5 ;
                   SOME ;
                   SENDER ;
                   UPDATE ;
                   SWAP ;
                   PAIR ;
                   SWAP ;
                   PAIR ;
                   SWAP ;
                   PAIR ;
                   DUG 2 ;
                   DROP 2 } }
               { { NOW ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CAR ;
                   CDR ;
                   CDR ;
                   PUSH int 1 ;
                   GET ;
                   IF_NONE { { PUSH string "Get-item:48" ; FAILWITH } } {} ;
                   COMPARE ;
                   LT ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.timestamps[1] < sp.now" ; FAILWITH } } ;
                   NOW ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CAR ;
                   CDR ;
                   CDR ;
                   PUSH int 2 ;
                   GET ;
                   IF_NONE { { PUSH string "Get-item:49" ; FAILWITH } } {} ;
                   COMPARE ;
                   GT ;
                   IF { {} }
                      { { PUSH string "WrongCondition: self.data.timestamps[2] > sp.now" ; FAILWITH } } ;
                   DUP ;
                   CAR ;
                   PUSH int 1 ;
                   COMPARE ;
                   EQ ;
                   IF { { SWAP ;
                          DUP ;
                          DUG 2 ;
                          DUP ;
                          CAR ;
                          SWAP ;
                          CDR ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          DIG 4 ;
                          DUP ;
                          DUG 5 ;
                          CDR ;
                          SOME ;
                          SENDER ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          DUG 2 ;
                          SWAP ;
                          DROP } }
                      { { DUP ;
                          CAR ;
                          PUSH int 2 ;
                          COMPARE ;
                          EQ ;
                          IF { { SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 DUP ;
                                 CAR ;
                                 SWAP ;
                                 CDR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 CAR ;
                                 DUP ;
                                 CAR ;
                                 SWAP ;
                                 CDR ;
                                 DIG 4 ;
                                 DUP ;
                                 DUG 5 ;
                                 CDR ;
                                 SOME ;
                                 SENDER ;
                                 UPDATE ;
                                 SWAP ;
                                 PAIR ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 DUG 2 ;
                                 SWAP ;
                                 DROP } }
                             { { SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 DUP ;
                                 CAR ;
                                 SWAP ;
                                 CDR ;
                                 DUP ;
                                 CAR ;
                                 SWAP ;
                                 CDR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 CAR ;
                                 DIG 4 ;
                                 DUP ;
                                 DUG 5 ;
                                 CDR ;
                                 SOME ;
                                 SENDER ;
                                 UPDATE ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 DUG 2 ;
                                 SWAP ;
                                 DROP } } } } ;
                   DROP } } } ;
         NIL operation ;
         PAIR } }
