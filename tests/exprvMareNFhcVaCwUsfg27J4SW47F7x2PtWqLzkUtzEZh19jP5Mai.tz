{ parameter
    (or (or (pair %completeBet (int %betId) (int %betType))
            (or (unit %depositFunds) (int %incrementCycle)))
        (or (pair %placeBet (int %betType) (nat %seed))
            (or (option %updateBaker key_hash) (nat %withdrawAdminFunds)))) ;
  storage
    (pair (pair (pair (address %admin) (mutez %adminBalance))
                (pair (map %betData
                         int
                         (map int (pair (bool %disbursed) (pair (nat %seed) (list %senderList address)))))
                      (map %betSize int nat)))
          (pair (pair (int %currentCycle) (nat %earnedAmount))
                (pair (nat %winnerIndex) (map %yields int nat)))) ;
  code { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 { CDR ; CAR ; CAR } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 ADD ;
                 COMPARE ;
                 LT ;
                 IF {} { PUSH string "Bet not yet mature" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 { CAR ; CDR ; CDR } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 MEM ;
                 IF {} { PUSH string "Invalid bet type" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 { CAR ; CDR ; CAR } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 CAR ;
                 IF { PUSH string
                           "WrongCondition: ~ self.data.betData[params.betType][params.betId].disbursed" ;
                      FAILWITH }
                    {} ;
                 SWAP ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DUP ;
                 DIG 5 ;
                 DUP ;
                 DUG 6 ;
                 CDR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                 DUP ;
                 DIG 7 ;
                 DUP ;
                 DUG 8 ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                 CDR ;
                 PUSH bool True ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 DUP ;
                 DUG 2 ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 { CDR ; CDR } ;
                 DIG 4 ;
                 DUP ;
                 DUG 5 ;
                 { CAR ; CDR ; CAR } ;
                 DIG 4 ;
                 DUP ;
                 DUG 5 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 DIG 4 ;
                 DUP ;
                 DUG 5 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 { CDR ; CDR } ;
                 SIZE ;
                 PUSH timestamp "0" ;
                 NOW ;
                 SUB ;
                 ABS ;
                 DIG 6 ;
                 { CAR ; CDR ; CAR } ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 { CDR ; CAR } ;
                 ADD ;
                 EDIV ;
                 { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CDR } } ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DUP ;
                 DUG 2 ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 { CAR ; CAR } ;
                 PUSH nat 10000 ;
                 DIG 5 ;
                 DUP ;
                 DUG 6 ;
                 { CDR ; CDR ; CDR } ;
                 DIG 5 ;
                 DUP ;
                 DUG 6 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 { CAR ; CDR ; CAR } ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 { CDR ; CDR } ;
                 SIZE ;
                 DIG 7 ;
                 { CAR ; CDR ; CDR } ;
                 DIG 7 ;
                 DUP ;
                 DUG 8 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 MUL ;
                 MUL ;
                 EDIV ;
                 { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CAR } } ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PUSH nat 0 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 { CAR ; CAR } ;
                 PUSH mutez 1 ;
                 PUSH nat 100 ;
                 PUSH nat 10 ;
                 DIG 8 ;
                 DUP ;
                 DUG 9 ;
                 { CDR ; CAR ; CDR } ;
                 MUL ;
                 EDIV ;
                 { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CAR } } ;
                 MUL ;
                 DIG 6 ;
                 { CAR ; CAR ; CDR } ;
                 ADD ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 PAIR ;
                 DUG 2 ;
                 NIL operation ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 { CAR ; CDR ; CAR } ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CDR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                 { CDR ; CDR } ;
                 ITER { DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        { CAR ; CDR ; CAR } ;
                        DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        CDR ;
                        GET ;
                        { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                        DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        CAR ;
                        GET ;
                        { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                        { CDR ; CDR } ;
                        SIZE ;
                        PUSH timestamp "0" ;
                        NOW ;
                        SUB ;
                        ABS ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        { CAR ; CDR ; CAR } ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        CDR ;
                        GET ;
                        { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        CAR ;
                        GET ;
                        { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                        { CDR ; CAR } ;
                        ADD ;
                        EDIV ;
                        { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CDR } } ;
                        DIG 3 ;
                        DUP ;
                        DUG 4 ;
                        COMPARE ;
                        EQ ;
                        IF { CONTRACT unit ;
                             { IF_NONE { UNIT ; FAILWITH } {} } ;
                             PUSH mutez 1 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             { CAR ; CDR ; CDR } ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             GET ;
                             { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                             PUSH nat 100 ;
                             PUSH nat 90 ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             { CDR ; CAR ; CDR } ;
                             MUL ;
                             EDIV ;
                             { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CAR } } ;
                             ADD ;
                             MUL ;
                             UNIT ;
                             TRANSFER_TOKENS ;
                             CONS }
                           { CONTRACT unit ;
                             { IF_NONE { UNIT ; FAILWITH } {} } ;
                             PUSH mutez 1 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             { CAR ; CDR ; CDR } ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             GET ;
                             { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                             MUL ;
                             UNIT ;
                             TRANSFER_TOKENS ;
                             CONS } ;
                        SWAP ;
                        PUSH nat 1 ;
                        ADD ;
                        SWAP } ;
                 SWAP ;
                 DROP ;
                 SWAP ;
                 DROP }
               { IF_LEFT
                   { DROP ;
                     DUP ;
                     { CAR ; CAR ; CAR } ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { DUP ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          { CAR ; CAR } ;
                          AMOUNT ;
                          DIG 4 ;
                          { CAR ; CAR ; CDR } ;
                          ADD ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR }
                        {} }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     { CAR ; CAR ; CAR } ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     DUP ;
                     CAR ;
                     SWAP ;
                     CDR ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     { CAR ; CDR } ;
                     DIG 3 ;
                     DIG 4 ;
                     { CDR ; CAR ; CAR } ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR } ;
                 NIL operation } }
           { IF_LEFT
               { PUSH mutez 1 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 { CAR ; CDR ; CDR } ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:30" ; FAILWITH } {} } ;
                 MUL ;
                 PACK ;
                 AMOUNT ;
                 PACK ;
                 COMPARE ;
                 EQ ;
                 IF {} { PUSH string "incorrect amount sent to the entry point" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 { CAR ; CDR ; CAR } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET ;
                 { IF_NONE { PUSH string "Get-item:30" ; FAILWITH } {} } ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 { CDR ; CAR ; CAR } ;
                 MEM ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                      DUP ;
                      DIG 8 ;
                      DUP ;
                      DUG 9 ;
                      { CDR ; CAR ; CAR } ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      { CDR ; CAR } ;
                      DIG 10 ;
                      DUP ;
                      DUG 11 ;
                      { CAR ; CDR ; CAR } ;
                      DIG 10 ;
                      DUP ;
                      DUG 11 ;
                      CAR ;
                      GET ;
                      { IF_NONE { PUSH string "Get-item:30" ; FAILWITH } {} } ;
                      DIG 11 ;
                      { CDR ; CAR ; CAR } ;
                      GET ;
                      { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                      { CDR ; CDR } ;
                      SENDER ;
                      CONS ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                      DUP ;
                      DIG 8 ;
                      DUP ;
                      DUG 9 ;
                      { CDR ; CAR ; CAR } ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      { CDR ; CDR } ;
                      PUSH nat 100000 ;
                      PUSH timestamp "0" ;
                      NOW ;
                      SUB ;
                      ABS ;
                      DIG 11 ;
                      DUP ;
                      DUG 12 ;
                      CDR ;
                      DIG 13 ;
                      DUP ;
                      DUG 14 ;
                      { CAR ; CDR ; CAR } ;
                      DIG 13 ;
                      CAR ;
                      GET ;
                      { IF_NONE { PUSH string "Get-item:30" ; FAILWITH } {} } ;
                      DIG 13 ;
                      { CDR ; CAR ; CAR } ;
                      GET ;
                      { IF_NONE { PUSH string "Get-item:40" ; FAILWITH } {} } ;
                      { CDR ; CAR } ;
                      ADD ;
                      ADD ;
                      EDIV ;
                      { IF_NONE { PUSH string "division by zero" ; FAILWITH } { CDR } } ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR }
                    { SWAP ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      { IF_NONE { PUSH string "set_in_top-any" ; FAILWITH } {} } ;
                      NIL address ;
                      SENDER ;
                      CONS ;
                      DIG 7 ;
                      CDR ;
                      PAIR %seed %senderList ;
                      PUSH bool False ;
                      PAIR %disbursed ;
                      SOME ;
                      DIG 7 ;
                      { CDR ; CAR ; CAR } ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR } ;
                 NIL operation }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     { CAR ; CAR ; CAR } ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SET_DELEGATE ;
                     NIL operation ;
                     SWAP ;
                     CONS }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     { CAR ; CAR ; CAR } ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     { CAR ; CAR ; CDR } ;
                     PUSH mutez 1 ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     MUL ;
                     COMPARE ;
                     LE ;
                     IF {}
                        { PUSH string "WrongCondition: sp.mutez(params) <= self.data.adminBalance" ;
                          FAILWITH } ;
                     NIL operation ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     { CAR ; CAR ; CAR } ;
                     CONTRACT unit ;
                     { IF_NONE { UNIT ; FAILWITH } {} } ;
                     PUSH mutez 1 ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     MUL ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     CAR ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     { CAR ; CAR } ;
                     PUSH mutez 1 ;
                     DIG 5 ;
                     MUL ;
                     DIG 5 ;
                     { CAR ; CAR ; CDR } ;
                     SUB ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     SWAP } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
