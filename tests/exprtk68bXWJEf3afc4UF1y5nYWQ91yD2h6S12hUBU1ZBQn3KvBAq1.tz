{ storage
    (pair (pair (pair (address %administrator)
                      (pair (pair %claims
                               (pair (pair (mutez %claim_pack_price) (nat %claim_pack_size))
                                     (pair (map %claimers address nat) (pair (mutez %claiming_price) (nat %cur_claim_key))))
                               (pair (pair (nat %max_claims_per_period)
                                           (pair (nat %max_free_claims_per_addr) (nat %max_paid_claims_per_addr)))
                                     (pair (map %patriots address nat) (pair (int %period_len) (timestamp %period_start)))))
                            (address %distributor)))
                (pair (pair (address %fa2) (big_map %metadata string bytes))
                      (pair (bool %paused)
                            (map %payouts
                               nat
                               (pair (address %address) (pair (mutez %payout) (timestamp %timestamp)))))))
          (pair (pair (map %series
                         nat
                         (pair (pair (bool %claimable)
                                     (map %levels
                                        nat
                                        (pair (pair (pair (nat %burned) (mutez %high)) (pair (mutez %last) (mutez %low)))
                                              (pair (pair (nat %minted) (nat %rarity))
                                                    (pair (nat %sales) (pair (map %token_info string bytes) (nat %trades)))))))
                               (pair (nat %packs) (nat %series_id))))
                      (pair (map %series_meta
                               nat
                               (pair (nat %cap) (pair (mutez %upgrade_cost) (nat %upgrade_req))))
                            (big_map %stats
                               address
                               (pair (pair (timestamp %lastActivity) (mutez %sales))
                                     (pair (mutez %spent) (nat %trades))))))
                (pair (pair (mutez %treasure) (nat %treasure_cnt))
                      (pair (nat %treasure_fee) (nat %treasure_payout))))) ;
  parameter
    (or (or (unit %claim)
            (or (list %create_series
                   (pair (pair (bool %claimable)
                               (map %levels
                                  nat
                                  (pair (pair (pair (nat %burned) (mutez %high)) (pair (mutez %last) (mutez %low)))
                                        (pair (pair (nat %minted) (nat %rarity))
                                              (pair (nat %sales) (pair (map %token_info string bytes) (nat %trades)))))))
                         (pair (nat %packs) (nat %series_id))))
                (pair %mint_in_series
                   (pair (address %address) (nat %amount))
                   (pair (nat %level_key) (nat %series_key)))))
        (or (list %record_trade_meta
               (pair (pair (address %maker) (mutez %price))
                     (pair (address %taker) (pair (nat %token_id) (bool %trade)))))
            (or (pair %update_metadata (nat %token_id) (map %token_info string bytes))
                (nat %upgrade)))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET 5 ;
                 IF { PUSH string "WrongCondition: ~ self.data.paused" ; FAILWITH } {} ;
                 PUSH int 0 ;
                 DIG 2 ;
                 DUP ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 GET 8 ;
                 SWAP ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 GET 7 ;
                 ADD ;
                 NOW ;
                 SUB ;
                 COMPARE ;
                 GT ;
                 IF { SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      SWAP ;
                      CAR ;
                      NOW ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      UNPAIR ;
                      SWAP ;
                      CDR ;
                      EMPTY_MAP address nat ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP }
                    {} ;
                 PUSH nat 0 ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 3 ;
                 ITER { CDR ; ADD } ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 COMPARE ;
                 LT ;
                 IF {}
                    { PUSH string
                           "WrongCondition: result.value < self.data.claims.max_claims_per_period" ;
                      FAILWITH } ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 3 ;
                 SENDER ;
                 MEM ;
                 IF { DIG 2 ;
                      DUP ;
                      CAR ;
                      CAR ;
                      GET 3 ;
                      GET 3 ;
                      GET 3 ;
                      SWAP ;
                      DUP ;
                      DUG 4 ;
                      CAR ;
                      CAR ;
                      GET 3 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 370 ; FAILWITH } {} ;
                      COMPARE ;
                      GE ;
                      IF { DIG 2 ;
                           DUP ;
                           CAR ;
                           CAR ;
                           GET 3 ;
                           GET 3 ;
                           GET 4 ;
                           SWAP ;
                           DUP ;
                           DUG 4 ;
                           CAR ;
                           CAR ;
                           GET 3 ;
                           GET 3 ;
                           GET 3 ;
                           ADD ;
                           DUP 4 ;
                           CAR ;
                           CAR ;
                           GET 3 ;
                           CAR ;
                           GET 3 ;
                           SENDER ;
                           GET ;
                           IF_NONE { PUSH int 373 ; FAILWITH } {} ;
                           COMPARE ;
                           LT ;
                           IF {}
                              { PUSH string
                                     "WrongCondition: self.data.claims.claimers[sp.sender] < (self.data.claims.max_free_claims_per_addr + self.data.claims.max_paid_claims_per_addr)" ;
                                FAILWITH } ;
                           DUP 3 ;
                           CAR ;
                           CAR ;
                           GET 3 ;
                           CAR ;
                           GET 5 ;
                           AMOUNT ;
                           COMPARE ;
                           EQ ;
                           IF {}
                              { PUSH string "WrongCondition: sp.amount == self.data.claims.claiming_price" ;
                                FAILWITH } }
                         { PUSH mutez 0 ;
                           AMOUNT ;
                           COMPARE ;
                           EQ ;
                           IF {} { PUSH string "WrongCondition: sp.amount == sp.tez(0)" ; FAILWITH } } }
                    { PUSH mutez 0 ;
                      AMOUNT ;
                      COMPARE ;
                      EQ ;
                      IF {} { PUSH string "WrongCondition: sp.amount == sp.tez(0)" ; FAILWITH } } ;
                 PUSH bool False ;
                 DUP 4 ;
                 GET 3 ;
                 CAR ;
                 SIZE ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 NOT ;
                 LOOP { DUP ;
                        PUSH nat 0 ;
                        COMPARE ;
                        EQ ;
                        IF { PUSH string "PP_CLAIMS_MAXED" ; FAILWITH } {} ;
                        DUP 5 ;
                        CAR ;
                        CAR ;
                        GET 3 ;
                        CAR ;
                        GET 6 ;
                        PUSH bool False ;
                        DUP 7 ;
                        GET 3 ;
                        CAR ;
                        ITER { CAR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               IF { SWAP ; DROP ; SWAP ; DROP ; DUP ; PUSH bool False ; SWAP } {} ;
                               DUP 8 ;
                               CAR ;
                               CAR ;
                               GET 3 ;
                               CAR ;
                               GET 6 ;
                               COMPARE ;
                               EQ ;
                               IF { DROP ; PUSH bool True } {} } ;
                        DUP 7 ;
                        CAR ;
                        CAR ;
                        GET 3 ;
                        CAR ;
                        GET 6 ;
                        DUP 3 ;
                        COMPARE ;
                        EQ ;
                        IF { DROP ;
                             PUSH bool True ;
                             DUP 7 ;
                             GET 3 ;
                             CAR ;
                             ITER { CAR ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    IF { SWAP ; DROP ; SWAP ; DROP ; PUSH bool False } { DROP } } }
                           {} ;
                        DIG 6 ;
                        UNPAIR ;
                        UNPAIR ;
                        UNPAIR ;
                        SWAP ;
                        UNPAIR ;
                        UNPAIR ;
                        UNPAIR ;
                        SWAP ;
                        UNPAIR ;
                        SWAP ;
                        CAR ;
                        DUP 10 ;
                        SWAP ;
                        PAIR ;
                        SWAP ;
                        PAIR ;
                        SWAP ;
                        PAIR ;
                        PAIR ;
                        PAIR ;
                        SWAP ;
                        PAIR ;
                        PAIR ;
                        PAIR ;
                        DUP ;
                        GET 3 ;
                        CAR ;
                        SWAP ;
                        DUP ;
                        DUG 8 ;
                        CAR ;
                        CAR ;
                        GET 3 ;
                        CAR ;
                        GET 6 ;
                        GET ;
                        IF_NONE { PUSH int 393 ; FAILWITH } {} ;
                        CAR ;
                        CAR ;
                        IF { DIG 3 ; DROP 3 ; PUSH bool True ; SWAP } { DROP 2 } ;
                        PUSH nat 1 ;
                        SWAP ;
                        SUB ;
                        ISNAT ;
                        IF_NONE { PUSH int 395 ; FAILWITH } {} ;
                        SWAP ;
                        DUP ;
                        DUG 2 ;
                        NOT } ;
                 DROP 4 ;
                 DUP ;
                 GET 3 ;
                 GET 3 ;
                 PUSH nat 1000 ;
                 GET ;
                 IF_NONE { PUSH int 401 ; FAILWITH } {} ;
                 CAR ;
                 PUSH nat 1 ;
                 DIG 2 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 CAR ;
                 CDR ;
                 DIG 3 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 5 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 GET ;
                 IF_NONE { PUSH int 399 ; FAILWITH } {} ;
                 GET 3 ;
                 CAR ;
                 ADD ;
                 COMPARE ;
                 LE ;
                 IF {}
                    { PUSH string
                           "WrongCondition: (self.data.series[self.data.claims.cur_claim_key].levels[1000 + self.data.series[self.data.claims.cur_claim_key].series_id].minted + 1) <= self.data.series_meta[1000].cap" ;
                      FAILWITH } ;
                 DUP ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 DUP ;
                 DUP 6 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 403 ; FAILWITH } {} ;
                 UNPAIR ;
                 UNPAIR ;
                 SWAP ;
                 DUP ;
                 DIG 9 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 403 ; FAILWITH } {} ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 PUSH nat 1 ;
                 ADD ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DUP ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 CONTRACT %mint
                   (pair (pair (address %address) (nat %amount))
                         (pair (map %metadata string bytes) (nat %token_id))) ;
                 IF_NONE { PUSH int 520 ; FAILWITH } {} ;
                 NIL operation ;
                 SWAP ;
                 PUSH mutez 0 ;
                 DIG 3 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 5 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 DIG 4 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 6 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 CAR ;
                 CDR ;
                 DIG 5 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 GET ;
                 IF_NONE { PUSH int 399 ; FAILWITH } {} ;
                 GET 3 ;
                 CDR ;
                 ADD ;
                 DIG 4 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 6 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 CAR ;
                 CDR ;
                 DIG 5 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 GET ;
                 IF_NONE { PUSH int 399 ; FAILWITH } {} ;
                 GET 7 ;
                 PAIR %metadata %token_id ;
                 PUSH nat 1 ;
                 SENDER ;
                 PAIR %address %amount ;
                 PAIR ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 PUSH mutez 0 ;
                 AMOUNT ;
                 COMPARE ;
                 GT ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      GET 3 ;
                      CAR ;
                      SIZE ;
                      DUP 3 ;
                      GET 5 ;
                      CDR ;
                      COMPARE ;
                      LT ;
                      IF { PUSH mutez 0 ;
                           PUSH nat 100 ;
                           AMOUNT ;
                           DUP 5 ;
                           GET 7 ;
                           PUSH nat 100 ;
                           SUB ;
                           ISNAT ;
                           IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                           CAR ;
                           COMPARE ;
                           GT ;
                           IF { SWAP ;
                                DUP ;
                                DUG 2 ;
                                CAR ;
                                CAR ;
                                GET 4 ;
                                CONTRACT %distribute unit ;
                                IF_NONE { PUSH int 109 ; FAILWITH } {} ;
                                PUSH nat 100 ;
                                AMOUNT ;
                                DUP 5 ;
                                GET 7 ;
                                PUSH nat 100 ;
                                SUB ;
                                ISNAT ;
                                IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                                MUL ;
                                EDIV ;
                                IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                                CAR ;
                                UNIT ;
                                TRANSFER_TOKENS ;
                                CONS }
                              {} ;
                           PUSH nat 100 ;
                           AMOUNT ;
                           DUP 4 ;
                           GET 7 ;
                           PUSH nat 100 ;
                           SUB ;
                           ISNAT ;
                           IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                           CAR ;
                           BALANCE ;
                           SUB ;
                           DIG 2 ;
                           UNPAIR ;
                           SWAP ;
                           UNPAIR ;
                           SWAP ;
                           UNPAIR ;
                           CDR ;
                           DIG 4 ;
                           PAIR ;
                           PAIR ;
                           SWAP ;
                           PAIR ;
                           SWAP ;
                           PAIR ;
                           SWAP }
                         { PUSH mutez 0 ;
                           AMOUNT ;
                           COMPARE ;
                           GT ;
                           IF { SWAP ;
                                DUP ;
                                DUG 2 ;
                                CAR ;
                                CAR ;
                                GET 4 ;
                                CONTRACT %distribute unit ;
                                IF_NONE { PUSH int 109 ; FAILWITH } {} ;
                                AMOUNT ;
                                UNIT ;
                                TRANSFER_TOKENS ;
                                CONS }
                              {} } }
                    {} ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 3 ;
                 GET 3 ;
                 PUSH nat 1000 ;
                 GET ;
                 IF_NONE { PUSH int 414 ; FAILWITH } {} ;
                 CAR ;
                 DIG 2 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 CAR ;
                 CDR ;
                 DIG 3 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 5 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 GET ;
                 IF_NONE { PUSH int 399 ; FAILWITH } {} ;
                 GET 3 ;
                 CAR ;
                 COMPARE ;
                 EQ ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      DUP ;
                      DIG 6 ;
                      CAR ;
                      CAR ;
                      GET 3 ;
                      CAR ;
                      GET 6 ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 415 ; FAILWITH } {} ;
                      UNPAIR ;
                      CDR ;
                      PUSH bool False ;
                      PAIR ;
                      PAIR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      SWAP }
                    {} ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 417 ; FAILWITH } {} ;
                 UNPAIR ;
                 UNPAIR ;
                 SWAP ;
                 DIG 9 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 11 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 CAR ;
                 CDR ;
                 DIG 10 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 12 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 GET ;
                 IF_NONE { PUSH int 399 ; FAILWITH } {} ;
                 SOME ;
                 DIG 10 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 GET 4 ;
                 PUSH nat 1000 ;
                 ADD ;
                 UPDATE ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DUP ;
                 DUG 2 ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 DIG 5 ;
                 DUP ;
                 GET 3 ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 GET ;
                 IF_NONE { PUSH int 397 ; FAILWITH } {} ;
                 SOME ;
                 DIG 6 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 6 ;
                 UPDATE ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 GET 3 ;
                 SENDER ;
                 MEM ;
                 IF { SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      DUP ;
                      SENDER ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 421 ; FAILWITH } {} ;
                      PUSH nat 1 ;
                      ADD ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP }
                    { SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      PUSH (option nat) (Some 1) ;
                      SENDER ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      SWAP } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                          FAILWITH } ;
                     DUP ;
                     ITER { DUP 3 ;
                            GET 3 ;
                            CAR ;
                            SWAP ;
                            DUP ;
                            DUG 2 ;
                            GET 4 ;
                            MEM ;
                            IF { PUSH string "PP_SERIES_UNDEFINED" ; FAILWITH } {} ;
                            DIG 2 ;
                            UNPAIR ;
                            SWAP ;
                            UNPAIR ;
                            UNPAIR ;
                            DIG 4 ;
                            DUP ;
                            SOME ;
                            SWAP ;
                            GET 4 ;
                            UPDATE ;
                            PAIR ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            SWAP } ;
                     DROP ;
                     NIL operation }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.series.contains(params.series_key)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 176 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     MEM ;
                     IF {}
                        { PUSH string
                               "WrongCondition: self.data.series[params.series_key].levels.contains(params.level_key)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 3 ;
                     GET 3 ;
                     CAR ;
                     DUP 3 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 3 ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     GET ;
                     IF_NONE { PUSH int 182 ; FAILWITH } {} ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     DUP 4 ;
                     GET 3 ;
                     CAR ;
                     DUP 4 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 4 ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                     GET 3 ;
                     CAR ;
                     ADD ;
                     COMPARE ;
                     LE ;
                     IF {}
                        { PUSH string
                               "WrongCondition: (self.data.series[params.series_key].levels[params.level_key].minted + params.amount) <= self.data.series_meta[self.data.series[params.series_key].levels[params.level_key].rarity].cap" ;
                          FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DUP 6 ;
                     GET 4 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 185 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DUP 10 ;
                     GET 3 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 185 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP 14 ;
                     CAR ;
                     CDR ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     NIL operation ;
                     DUP 3 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CONTRACT %mint
                       (pair (pair (address %address) (nat %amount))
                             (pair (map %metadata string bytes) (nat %token_id))) ;
                     IF_NONE { PUSH int 520 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DUP 5 ;
                     GET 3 ;
                     CAR ;
                     DUP 5 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     GET 4 ;
                     DUP 6 ;
                     GET 3 ;
                     CAR ;
                     DUP 6 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 6 ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     ADD ;
                     DUP 6 ;
                     GET 3 ;
                     CAR ;
                     DUP 6 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 6 ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                     GET 7 ;
                     PAIR %metadata %token_id ;
                     DIG 4 ;
                     DUP ;
                     CAR ;
                     CDR ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     CAR ;
                     PAIR %address %amount ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DUP 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DUP 7 ;
                     GET 4 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 191 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DIG 10 ;
                     GET 3 ;
                     CAR ;
                     DUP 11 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 11 ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                     SOME ;
                     DUP 11 ;
                     GET 3 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DIG 6 ;
                     GET 3 ;
                     CAR ;
                     DUP 7 ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 179 ; FAILWITH } {} ;
                     SOME ;
                     DIG 6 ;
                     GET 4 ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP } } }
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET 3 ;
                 CAR ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 IF {}
                    { PUSH string "WrongCondition: sp.sender == self.data.fa2" ; FAILWITH } ;
                 DUP ;
                 ITER { DUP 3 ;
                        GET 3 ;
                        GET 4 ;
                        SWAP ;
                        DUP ;
                        DUG 2 ;
                        CAR ;
                        CAR ;
                        MEM ;
                        IF {}
                           { DIG 2 ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             PUSH (pair (mutez %spent) (nat %trades)) (Pair 0 0) ;
                             PUSH mutez 0 ;
                             NOW ;
                             PAIR %lastActivity %sales ;
                             PAIR ;
                             SOME ;
                             DUP 7 ;
                             CAR ;
                             CAR ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             DUG 2 } ;
                        DUP 3 ;
                        GET 3 ;
                        GET 4 ;
                        SWAP ;
                        DUP ;
                        DUG 2 ;
                        GET 3 ;
                        MEM ;
                        IF {}
                           { DIG 2 ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             PUSH (pair (mutez %spent) (nat %trades)) (Pair 0 0) ;
                             PUSH mutez 0 ;
                             NOW ;
                             PAIR %lastActivity %sales ;
                             PAIR ;
                             SOME ;
                             DUP 7 ;
                             GET 3 ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             DUG 2 } ;
                        DUP ;
                        GET 6 ;
                        IF { DIG 2 ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             UNPAIR ;
                             DUP ;
                             PUSH nat 1000 ;
                             DUP 7 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             DUP ;
                             DUP 10 ;
                             GET 5 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             PUSH nat 1 ;
                             ADD ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             DUP ;
                             DUP 7 ;
                             CAR ;
                             CAR ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 280 ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             PUSH nat 1 ;
                             ADD ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DUP 7 ;
                             GET 3 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 281 ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             PUSH nat 1 ;
                             ADD ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DUP 7 ;
                             CAR ;
                             CAR ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 282 ; FAILWITH } {} ;
                             UNPAIR ;
                             CDR ;
                             NOW ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DIG 6 ;
                             GET 3 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 283 ; FAILWITH } {} ;
                             UNPAIR ;
                             CDR ;
                             NOW ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP }
                           { DIG 2 ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             UNPAIR ;
                             DUP ;
                             PUSH nat 1000 ;
                             DUP 7 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 285 ; FAILWITH } {} ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             DUP ;
                             DUP 10 ;
                             GET 5 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 285 ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             PUSH nat 1 ;
                             ADD ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             PUSH nat 1000 ;
                             DUP 7 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 286 ; FAILWITH } {} ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             DUP ;
                             DUP 10 ;
                             GET 5 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 286 ; FAILWITH } {} ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             CDR ;
                             DUP 13 ;
                             CAR ;
                             CDR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             PAIR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             DUP ;
                             DUG 3 ;
                             GET 3 ;
                             CAR ;
                             PUSH nat 1000 ;
                             DUP 3 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             GET ;
                             IF_NONE { PUSH int 287 ; FAILWITH } {} ;
                             CAR ;
                             CDR ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             GET 5 ;
                             GET ;
                             IF_NONE { PUSH int 287 ; FAILWITH } {} ;
                             CAR ;
                             CAR ;
                             CDR ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             COMPARE ;
                             GT ;
                             IF { DIG 2 ;
                                  UNPAIR ;
                                  SWAP ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  DUP ;
                                  PUSH nat 1000 ;
                                  DUP 7 ;
                                  GET 5 ;
                                  EDIV ;
                                  IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 288 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  SWAP ;
                                  DUP ;
                                  DUP 10 ;
                                  GET 5 ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 288 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  CAR ;
                                  DUP 13 ;
                                  CAR ;
                                  CDR ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  PAIR ;
                                  PAIR ;
                                  SWAP ;
                                  PAIR ;
                                  DUG 2 }
                                {} ;
                             PUSH mutez 0 ;
                             DUP 4 ;
                             GET 3 ;
                             CAR ;
                             PUSH nat 1000 ;
                             DUP 4 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             GET ;
                             IF_NONE { PUSH int 289 ; FAILWITH } {} ;
                             CAR ;
                             CDR ;
                             DUP 3 ;
                             GET 5 ;
                             GET ;
                             IF_NONE { PUSH int 289 ; FAILWITH } {} ;
                             CAR ;
                             GET 4 ;
                             COMPARE ;
                             EQ ;
                             IF { DIG 2 ;
                                  UNPAIR ;
                                  SWAP ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  DUP ;
                                  PUSH nat 1000 ;
                                  DUP 7 ;
                                  GET 5 ;
                                  EDIV ;
                                  IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 290 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  SWAP ;
                                  DUP ;
                                  DUP 10 ;
                                  GET 5 ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 290 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  SWAP ;
                                  CAR ;
                                  DUP 13 ;
                                  CAR ;
                                  CDR ;
                                  SWAP ;
                                  PAIR ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  PAIR ;
                                  PAIR ;
                                  SWAP ;
                                  PAIR ;
                                  DUG 2 }
                                {} ;
                             DUP 3 ;
                             GET 3 ;
                             CAR ;
                             PUSH nat 1000 ;
                             DUP 3 ;
                             GET 5 ;
                             EDIV ;
                             IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                             GET ;
                             IF_NONE { PUSH int 291 ; FAILWITH } {} ;
                             CAR ;
                             CDR ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             GET 5 ;
                             GET ;
                             IF_NONE { PUSH int 291 ; FAILWITH } {} ;
                             CAR ;
                             GET 4 ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             COMPARE ;
                             LT ;
                             IF { DIG 2 ;
                                  UNPAIR ;
                                  SWAP ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  DUP ;
                                  PUSH nat 1000 ;
                                  DUP 7 ;
                                  GET 5 ;
                                  EDIV ;
                                  IF_NONE { PUSH int 276 ; FAILWITH } { CDR } ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 292 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  SWAP ;
                                  DUP ;
                                  DUP 10 ;
                                  GET 5 ;
                                  DUP ;
                                  DUG 2 ;
                                  GET ;
                                  IF_NONE { PUSH int 292 ; FAILWITH } {} ;
                                  UNPAIR ;
                                  UNPAIR ;
                                  SWAP ;
                                  CAR ;
                                  DUP 13 ;
                                  CAR ;
                                  CDR ;
                                  SWAP ;
                                  PAIR ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  SWAP ;
                                  PAIR ;
                                  PAIR ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  PAIR ;
                                  PAIR ;
                                  SWAP ;
                                  PAIR ;
                                  DUG 2 }
                                {} ;
                             DIG 2 ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             DUP ;
                             DUP 7 ;
                             CAR ;
                             CAR ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 294 ; FAILWITH } {} ;
                             UNPAIR ;
                             UNPAIR ;
                             SWAP ;
                             DUP 10 ;
                             CAR ;
                             CDR ;
                             ADD ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DUP 7 ;
                             GET 3 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 295 ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             DUP 10 ;
                             CAR ;
                             CDR ;
                             ADD ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DUP 7 ;
                             CAR ;
                             CAR ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 296 ; FAILWITH } {} ;
                             UNPAIR ;
                             CDR ;
                             NOW ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP ;
                             DIG 6 ;
                             GET 3 ;
                             DUP ;
                             DUG 2 ;
                             GET ;
                             IF_NONE { PUSH int 297 ; FAILWITH } {} ;
                             UNPAIR ;
                             CDR ;
                             NOW ;
                             PAIR ;
                             PAIR ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP } } ;
                 DROP ;
                 NIL operation }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                          FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     PUSH nat 1000 ;
                     DUP 7 ;
                     CAR ;
                     EDIV ;
                     IF_NONE { PUSH int 239 ; FAILWITH } { CDR } ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DUP 10 ;
                     CAR ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     CDR ;
                     DUP 14 ;
                     CDR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     NIL operation ;
                     DUP 3 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CONTRACT %update_metadata (pair (map %metadata string bytes) (nat %token_id)) ;
                     IF_NONE { PUSH int 242 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DIG 3 ;
                     UNPAIR ;
                     SWAP ;
                     PAIR %metadata %token_id ;
                     TRANSFER_TOKENS ;
                     CONS }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 5 ;
                     IF { PUSH string "WrongCondition: ~ self.data.paused" ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 3 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     MEM ;
                     IF {} { PUSH string "PP_SERIES_UNDEFINED" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 3 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     PUSH nat 1000 ;
                     DUP 3 ;
                     ADD ;
                     MEM ;
                     IF {}
                        { PUSH string
                               "WrongCondition: self.data.series[params.token_id % 1000].levels.contains(params.token_id + 1000)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 3 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 4 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     PUSH nat 1000 ;
                     DUP 4 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 314 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     GET ;
                     IF_NONE { PUSH int 316 ; FAILWITH } {} ;
                     CAR ;
                     PUSH nat 1 ;
                     DUP 4 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 5 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     PUSH nat 1000 ;
                     DUP 5 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 314 ; FAILWITH } {} ;
                     GET 3 ;
                     CAR ;
                     ADD ;
                     COMPARE ;
                     LE ;
                     IF {} { PUSH string "PP_TOKEN_CAPPED" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 3 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 4 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 3 ;
                     GET ;
                     IF_NONE { PUSH int 311 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     GET ;
                     IF_NONE { PUSH int 319 ; FAILWITH } {} ;
                     GET 3 ;
                     AMOUNT ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "PP_INSUFFICIENT_AMOUNT" ; FAILWITH } ;
                     NIL operation ;
                     DUP 3 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CONTRACT %do_upgrade
                       (pair (pair (address %address) (nat %nt_id))
                             (pair (map %nt_md string bytes) (pair (nat %token_id) (nat %upgrade_req)))) ;
                     IF_NONE { PUSH int 323 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DIG 4 ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 7 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 6 ;
                     GET ;
                     IF_NONE { PUSH int 311 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     GET ;
                     IF_NONE { PUSH int 334 ; FAILWITH } {} ;
                     GET 4 ;
                     DUP 5 ;
                     PAIR %token_id %upgrade_req ;
                     DUP 6 ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 7 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     PUSH nat 1000 ;
                     DUP 7 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 314 ; FAILWITH } {} ;
                     GET 7 ;
                     PAIR %nt_md ;
                     PUSH nat 1000 ;
                     DUP 6 ;
                     ADD ;
                     SENDER ;
                     PAIR %address %nt_id ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DUP 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     PUSH nat 1000 ;
                     DUP 8 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 346 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DUP 11 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 346 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     DIG 15 ;
                     DUP ;
                     GET 3 ;
                     GET 3 ;
                     SWAP ;
                     GET 3 ;
                     CAR ;
                     PUSH nat 1000 ;
                     DUP 18 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     GET ;
                     IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                     CAR ;
                     CDR ;
                     DUP 17 ;
                     GET ;
                     IF_NONE { PUSH int 311 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     GET ;
                     IF_NONE { PUSH int 346 ; FAILWITH } {} ;
                     GET 4 ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     DUP ;
                     PUSH nat 1000 ;
                     DUP 8 ;
                     EDIV ;
                     IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 347 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     PUSH nat 1000 ;
                     DUP 12 ;
                     ADD ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 347 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     PUSH nat 1 ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 3 ;
                     GET 3 ;
                     CAR ;
                     SIZE ;
                     DUP 4 ;
                     GET 5 ;
                     CDR ;
                     COMPARE ;
                     LT ;
                     IF { PUSH mutez 0 ;
                          PUSH nat 100 ;
                          AMOUNT ;
                          DUP 6 ;
                          GET 7 ;
                          PUSH nat 100 ;
                          SUB ;
                          ISNAT ;
                          IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                          MUL ;
                          EDIV ;
                          IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                          CAR ;
                          COMPARE ;
                          GT ;
                          IF { DUP 3 ;
                               CAR ;
                               CAR ;
                               GET 4 ;
                               CONTRACT %distribute unit ;
                               IF_NONE { PUSH int 109 ; FAILWITH } {} ;
                               PUSH nat 100 ;
                               AMOUNT ;
                               DUP 6 ;
                               GET 7 ;
                               PUSH nat 100 ;
                               SUB ;
                               ISNAT ;
                               IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                               MUL ;
                               EDIV ;
                               IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                               CAR ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               CONS }
                             {} ;
                          PUSH nat 100 ;
                          AMOUNT ;
                          DUP 5 ;
                          GET 7 ;
                          PUSH nat 100 ;
                          SUB ;
                          ISNAT ;
                          IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                          MUL ;
                          EDIV ;
                          IF_NONE { PUSH int 545 ; FAILWITH } {} ;
                          CAR ;
                          BALANCE ;
                          SUB ;
                          PUSH nat 6000 ;
                          DUP 5 ;
                          GET 3 ;
                          CAR ;
                          PUSH nat 1000 ;
                          DUP 6 ;
                          EDIV ;
                          IF_NONE { PUSH int 307 ; FAILWITH } { CDR } ;
                          GET ;
                          IF_NONE { PUSH int 310 ; FAILWITH } {} ;
                          CAR ;
                          CDR ;
                          PUSH nat 1000 ;
                          DUP 6 ;
                          ADD ;
                          GET ;
                          IF_NONE { PUSH int 314 ; FAILWITH } {} ;
                          GET 3 ;
                          CDR ;
                          COMPARE ;
                          EQ ;
                          IF { DIG 3 ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               UNPAIR ;
                               SWAP ;
                               PUSH nat 1 ;
                               ADD ;
                               SWAP ;
                               PAIR ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               DUG 3 ;
                               DUP ;
                               DUP 5 ;
                               GET 3 ;
                               CAR ;
                               SIZE ;
                               DUP 6 ;
                               GET 5 ;
                               CDR ;
                               COMPARE ;
                               EQ ;
                               IF { SWAP ; DROP ; PUSH mutez 0 ; SWAP }
                                  { DROP ;
                                    DUP ;
                                    PUSH nat 100 ;
                                    SWAP ;
                                    DUP 6 ;
                                    GET 8 ;
                                    MUL ;
                                    EDIV ;
                                    IF_NONE { PUSH int 561 ; FAILWITH } {} ;
                                    CAR ;
                                    DUP ;
                                    DIG 2 ;
                                    SUB ;
                                    SWAP } ;
                               DIG 4 ;
                               UNPAIR ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               NOW ;
                               DUP 7 ;
                               PAIR %payout %timestamp ;
                               SENDER ;
                               PAIR %address ;
                               SOME ;
                               PUSH nat 1000 ;
                               DIG 10 ;
                               ADD ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               PAIR ;
                               DUG 3 ;
                               DIG 2 ;
                               SENDER ;
                               CONTRACT unit ;
                               IF_NONE { PUSH int 565 ; FAILWITH } {} ;
                               DIG 2 ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               CONS ;
                               SWAP }
                             { DIG 2 ; DROP } ;
                          DIG 2 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          CDR ;
                          DIG 4 ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP }
                        { SWAP ;
                          DROP ;
                          PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               GET 4 ;
                               CONTRACT %distribute unit ;
                               IF_NONE { PUSH int 109 ; FAILWITH } {} ;
                               AMOUNT ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               CONS }
                             {} } } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
