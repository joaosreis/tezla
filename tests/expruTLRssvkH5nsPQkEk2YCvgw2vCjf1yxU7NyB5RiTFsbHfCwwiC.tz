{ storage
    (pair (address %admin)
          (pair (set %operators address)
                (big_map %users
                   address
                   (pair (pair (nat %balance) (nat %balance_locked))
                         (pair (set %creditcard_charges bytes)
                               (pair (set %creditcard_refunds bytes) (option %prepay_account address))))))) ;
  parameter
    (or (or (or (pair %create_prepay (address %account) (address %receiver))
                (address %create_user))
            (or (pair %lock
                   (pair (address %account) (nat %amount))
                   (pair (bytes %data) (string %method)))
                (or (pair %pay
                       (pair (address %account) (nat %amount))
                       (pair (bytes %data) (string %method)))
                    (address %set_administrator))))
        (or (or (pair %unlock
                   (pair (address %account) (nat %amount))
                   (pair (bytes %data) (string %method)))
                (pair %unlock_pay
                   (pair (address %account) (nat %amount))
                   (pair (bytes %data) (string %method))))
            (or (pair %update_balance (address %account) (pair (nat %amount) (bool %increase)))
                (or (list %update_operator (pair (address %operator) (bool %valid)))
                    (pair %withdraw_prepay (address %account) (pair (address %address) (nat %amount))))))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.users.contains(params.account)" ;
                          FAILWITH } ;
                     DUP ;
                     CDR ;
                     PUSH nat 0 ;
                     PAIR %locked %receiver ;
                     SELF_ADDRESS ;
                     DUP 3 ;
                     CAR ;
                     PAIR %account %admin ;
                     PAIR ;
                     PUSH mutez 0 ;
                     NONE key_hash ;
                     CREATE_CONTRACT
                       { parameter
                           (or (or (nat %consume) (pair %lock (nat %amount) (bool %lock)))
                               (or (unit %ping) (pair %withdraw (address %address) (nat %amount)))) ;
                         storage
                           (pair (pair (address %account) (address %admin))
                                 (pair (nat %locked) (address %receiver))) ;
                         code { UNPAIR ;
                                IF_LEFT
                                  { IF_LEFT
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CDR ;
                                        SENDER ;
                                        COMPARE ;
                                        EQ ;
                                        IF {}
                                           { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                        BALANCE ;
                                        PUSH mutez 1 ;
                                        DUP 4 ;
                                        GET 3 ;
                                        DUP 4 ;
                                        ADD ;
                                        MUL ;
                                        COMPARE ;
                                        LE ;
                                        IF {}
                                           { PUSH string
                                                  "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                             FAILWITH } ;
                                        NIL operation ;
                                        DUP 3 ;
                                        GET 4 ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH int 604 ; FAILWITH } {} ;
                                        PUSH mutez 1 ;
                                        DIG 3 ;
                                        MUL ;
                                        UNIT ;
                                        TRANSFER_TOKENS ;
                                        CONS }
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CDR ;
                                        SENDER ;
                                        COMPARE ;
                                        EQ ;
                                        IF {}
                                           { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                        DUP ;
                                        CDR ;
                                        IF { BALANCE ;
                                             PUSH mutez 1 ;
                                             DUP 4 ;
                                             GET 3 ;
                                             DUP 4 ;
                                             CAR ;
                                             ADD ;
                                             MUL ;
                                             COMPARE ;
                                             LE ;
                                             IF {}
                                                { PUSH string
                                                       "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                                  FAILWITH } ;
                                             SWAP ;
                                             UNPAIR ;
                                             SWAP ;
                                             UNPAIR ;
                                             DIG 3 ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR }
                                           { SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             GET 3 ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CAR ;
                                             COMPARE ;
                                             LE ;
                                             IF {}
                                                { PUSH string "WrongCondition: params.amount <= self.data.locked" ; FAILWITH } ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             UNPAIR ;
                                             SWAP ;
                                             CDR ;
                                             DIG 2 ;
                                             CAR ;
                                             DIG 3 ;
                                             GET 3 ;
                                             SUB ;
                                             ISNAT ;
                                             IF_NONE { PUSH int 590 ; FAILWITH } {} ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR } ;
                                        NIL operation } }
                                  { IF_LEFT
                                      { DROP ; NIL operation }
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CDR ;
                                        SENDER ;
                                        COMPARE ;
                                        EQ ;
                                        IF {}
                                           { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                        BALANCE ;
                                        PUSH mutez 1 ;
                                        DUP 4 ;
                                        GET 3 ;
                                        DUP 4 ;
                                        CDR ;
                                        ADD ;
                                        MUL ;
                                        COMPARE ;
                                        LE ;
                                        IF {}
                                           { PUSH string
                                                  "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                             FAILWITH } ;
                                        DUP ;
                                        CAR ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH int 597 ; FAILWITH } {} ;
                                        NIL operation ;
                                        SWAP ;
                                        PUSH mutez 1 ;
                                        DIG 3 ;
                                        CDR ;
                                        MUL ;
                                        UNIT ;
                                        TRANSFER_TOKENS ;
                                        CONS } } ;
                                PAIR } } ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     NIL operation ;
                     SWAP ;
                     CONS ;
                     DIG 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DIG 6 ;
                     CAR ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 694 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     CAR ;
                     DIG 8 ;
                     CDR ;
                     SOME ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     MEM ;
                     IF { PUSH string "WrongCondition: ~ (self.data.users.contains(params))" ;
                          FAILWITH }
                        {} ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     PUSH (option
                             (pair (pair (nat %balance) (nat %balance_locked))
                                   (pair (set %creditcard_charges bytes)
                                         (pair (set %creditcard_refunds bytes) (option %prepay_account address)))))
                          (Some (Pair (Pair 0 0) (Pair {} (Pair {} None)))) ;
                     DIG 4 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     NIL operation } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     MEM ;
                     IF { DUP ;
                          GET 4 ;
                          PUSH string "balance" ;
                          COMPARE ;
                          EQ ;
                          IF { SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 727 ; FAILWITH } {} ;
                               CAR ;
                               CAR ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 727 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               DUP 3 ;
                               CAR ;
                               CDR ;
                               ADD ;
                               COMPARE ;
                               LE ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: (params.amount + self.data.users[params.account].balance_locked) <= self.data.users[params.account].balance" ;
                                    FAILWITH } ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 730 ; FAILWITH } {} ;
                               UNPAIR ;
                               UNPAIR ;
                               SWAP ;
                               DUP 8 ;
                               CAR ;
                               CDR ;
                               ADD ;
                               SWAP ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             {} ;
                          DUP ;
                          GET 4 ;
                          PUSH string "prepay" ;
                          COMPARE ;
                          EQ ;
                          IF { NIL operation ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 727 ; FAILWITH } {} ;
                               GET 6 ;
                               IF_NONE { PUSH int 734 ; FAILWITH } {} ;
                               CONTRACT %lock (pair (nat %amount) (bool %lock)) ;
                               IF_NONE { PUSH int 734 ; FAILWITH } {} ;
                               PUSH mutez 0 ;
                               PUSH bool True ;
                               DIG 4 ;
                               DUP ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 6 ;
                               GET 3 ;
                               UNPACK nat ;
                               IF_NONE { PUSH int 732 ; FAILWITH } {} ;
                               MUL ;
                               PAIR %amount %lock ;
                               TRANSFER_TOKENS ;
                               CONS }
                             { NIL operation } ;
                          PUSH string "balance" ;
                          DUP 3 ;
                          GET 4 ;
                          COMPARE ;
                          EQ ;
                          IF { PUSH bool False }
                             { PUSH string "prepay" ; DUP 3 ; GET 4 ; COMPARE ; NEQ } ;
                          IF { PUSH string "creditcard" ; DUP 3 ; GET 4 ; COMPARE ; NEQ }
                             { PUSH bool False } ;
                          IF { PUSH string "WrongCondition: False" ; FAILWITH } {} ;
                          DUP 3 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          DIG 5 ;
                          GET 4 ;
                          DUP 6 ;
                          CAR ;
                          CAR ;
                          GET ;
                          IF_NONE { PUSH int 727 ; FAILWITH } {} ;
                          SOME ;
                          DIG 5 ;
                          CAR ;
                          CAR ;
                          UPDATE ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP }
                        { DROP ; NIL operation } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         SENDER ;
                         MEM ;
                         IF {}
                            { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         MEM ;
                         IF { DUP ;
                              GET 4 ;
                              PUSH string "balance" ;
                              COMPARE ;
                              EQ ;
                              IF { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   GET 4 ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CAR ;
                                   CAR ;
                                   GET ;
                                   IF_NONE { PUSH int 791 ; FAILWITH } {} ;
                                   CAR ;
                                   CAR ;
                                   DUP 3 ;
                                   GET 4 ;
                                   DUP 3 ;
                                   CAR ;
                                   CAR ;
                                   GET ;
                                   IF_NONE { PUSH int 791 ; FAILWITH } {} ;
                                   CAR ;
                                   CDR ;
                                   DUP 3 ;
                                   CAR ;
                                   CDR ;
                                   ADD ;
                                   COMPARE ;
                                   LE ;
                                   IF {}
                                      { PUSH string
                                             "WrongCondition: (params.amount + self.data.users[params.account].balance_locked) <= self.data.users[params.account].balance" ;
                                        FAILWITH } ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   UNPAIR ;
                                   SWAP ;
                                   UNPAIR ;
                                   SWAP ;
                                   DUP ;
                                   DUP 5 ;
                                   CAR ;
                                   CAR ;
                                   DUP ;
                                   DUG 2 ;
                                   GET ;
                                   IF_NONE { PUSH int 773 ; FAILWITH } {} ;
                                   UNPAIR ;
                                   CDR ;
                                   DUP 7 ;
                                   CAR ;
                                   CDR ;
                                   DIG 8 ;
                                   GET 4 ;
                                   DUP 9 ;
                                   CAR ;
                                   CAR ;
                                   GET ;
                                   IF_NONE { PUSH int 791 ; FAILWITH } {} ;
                                   CAR ;
                                   CAR ;
                                   SUB ;
                                   ISNAT ;
                                   IF_NONE { PUSH int 773 ; FAILWITH } {} ;
                                   PAIR ;
                                   PAIR ;
                                   SOME ;
                                   SWAP ;
                                   UPDATE ;
                                   SWAP ;
                                   PAIR ;
                                   SWAP ;
                                   PAIR ;
                                   SWAP }
                                 {} ;
                              DUP ;
                              GET 4 ;
                              PUSH string "creditcard" ;
                              COMPARE ;
                              EQ ;
                              IF { SWAP ;
                                   UNPAIR ;
                                   SWAP ;
                                   UNPAIR ;
                                   SWAP ;
                                   DUP ;
                                   DUP 5 ;
                                   CAR ;
                                   CAR ;
                                   DUP ;
                                   DUG 2 ;
                                   GET ;
                                   IF_NONE { PUSH int 776 ; FAILWITH } {} ;
                                   UNPAIR ;
                                   SWAP ;
                                   UNPAIR ;
                                   PUSH bool True ;
                                   DUP 9 ;
                                   GET 3 ;
                                   UPDATE ;
                                   PAIR ;
                                   SWAP ;
                                   PAIR ;
                                   SOME ;
                                   SWAP ;
                                   UPDATE ;
                                   SWAP ;
                                   PAIR ;
                                   SWAP ;
                                   PAIR ;
                                   SWAP }
                                 {} ;
                              DUP ;
                              GET 4 ;
                              PUSH string "prepay" ;
                              COMPARE ;
                              EQ ;
                              IF { NIL operation ;
                                   DUP 3 ;
                                   GET 4 ;
                                   DUP 3 ;
                                   CAR ;
                                   CAR ;
                                   GET ;
                                   IF_NONE { PUSH int 791 ; FAILWITH } {} ;
                                   GET 6 ;
                                   IF_NONE { PUSH int 781 ; FAILWITH } {} ;
                                   CONTRACT %consume nat ;
                                   IF_NONE { PUSH int 781 ; FAILWITH } {} ;
                                   PUSH mutez 0 ;
                                   DIG 3 ;
                                   DUP ;
                                   CAR ;
                                   CDR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 5 ;
                                   GET 3 ;
                                   UNPACK nat ;
                                   IF_NONE { PUSH int 779 ; FAILWITH } {} ;
                                   MUL ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { NIL operation } ;
                              PUSH string "balance" ;
                              DUP 3 ;
                              GET 4 ;
                              COMPARE ;
                              EQ ;
                              IF { PUSH bool False }
                                 { PUSH string "prepay" ; DUP 3 ; GET 4 ; COMPARE ; NEQ } ;
                              IF { PUSH string "creditcard" ; DUP 3 ; GET 4 ; COMPARE ; NEQ }
                                 { PUSH bool False } ;
                              IF { PUSH string "WrongCondition: False" ; FAILWITH } {} ;
                              DUP 3 ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              DIG 5 ;
                              GET 4 ;
                              DUP 6 ;
                              CAR ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 791 ; FAILWITH } {} ;
                              SOME ;
                              DIG 5 ;
                              CAR ;
                              CAR ;
                              UPDATE ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP }
                            { DROP ; NIL operation } }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                         SWAP ;
                         CDR ;
                         SWAP ;
                         PAIR ;
                         NIL operation } } } }
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     MEM ;
                     IF { DUP ;
                          GET 4 ;
                          PUSH string "balance" ;
                          COMPARE ;
                          EQ ;
                          IF { SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 760 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CDR ;
                               COMPARE ;
                               LE ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: params.amount <= self.data.users[params.account].balance_locked" ;
                                    FAILWITH } ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 742 ; FAILWITH } {} ;
                               UNPAIR ;
                               CAR ;
                               DUP 7 ;
                               CAR ;
                               CDR ;
                               DIG 8 ;
                               GET 4 ;
                               DUP 9 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 760 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               SUB ;
                               ISNAT ;
                               IF_NONE { PUSH int 742 ; FAILWITH } {} ;
                               SWAP ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             {} ;
                          DUP ;
                          GET 4 ;
                          PUSH string "creditcard" ;
                          COMPARE ;
                          EQ ;
                          IF { SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 745 ; FAILWITH } {} ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               PUSH bool True ;
                               DUP 10 ;
                               GET 3 ;
                               UPDATE ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             {} ;
                          DUP ;
                          GET 4 ;
                          PUSH string "prepay" ;
                          COMPARE ;
                          EQ ;
                          IF { NIL operation ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 760 ; FAILWITH } {} ;
                               GET 6 ;
                               IF_NONE { PUSH int 750 ; FAILWITH } {} ;
                               CONTRACT %lock (pair (nat %amount) (bool %lock)) ;
                               IF_NONE { PUSH int 750 ; FAILWITH } {} ;
                               PUSH mutez 0 ;
                               PUSH bool False ;
                               DIG 4 ;
                               DUP ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 6 ;
                               GET 3 ;
                               UNPACK nat ;
                               IF_NONE { PUSH int 748 ; FAILWITH } {} ;
                               MUL ;
                               PAIR %amount %lock ;
                               TRANSFER_TOKENS ;
                               CONS }
                             { NIL operation } ;
                          PUSH string "balance" ;
                          DUP 3 ;
                          GET 4 ;
                          COMPARE ;
                          EQ ;
                          IF { PUSH bool False }
                             { PUSH string "prepay" ; DUP 3 ; GET 4 ; COMPARE ; NEQ } ;
                          IF { PUSH string "creditcard" ; DUP 3 ; GET 4 ; COMPARE ; NEQ }
                             { PUSH bool False } ;
                          IF { PUSH string "WrongCondition: False" ; FAILWITH } {} ;
                          DUP 3 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          DIG 5 ;
                          GET 4 ;
                          DUP 6 ;
                          CAR ;
                          CAR ;
                          GET ;
                          IF_NONE { PUSH int 760 ; FAILWITH } {} ;
                          SOME ;
                          DIG 5 ;
                          CAR ;
                          CAR ;
                          UPDATE ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP }
                        { DROP ; NIL operation } }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     MEM ;
                     IF { DUP ;
                          GET 4 ;
                          PUSH string "balance" ;
                          COMPARE ;
                          EQ ;
                          IF { SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CDR ;
                               COMPARE ;
                               LE ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: params.amount <= self.data.users[params.account].balance_locked" ;
                                    FAILWITH } ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 742 ; FAILWITH } {} ;
                               UNPAIR ;
                               CAR ;
                               DUP 7 ;
                               CAR ;
                               CDR ;
                               DIG 8 ;
                               GET 4 ;
                               DUP 9 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               SUB ;
                               ISNAT ;
                               IF_NONE { PUSH int 742 ; FAILWITH } {} ;
                               SWAP ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               CAR ;
                               CAR ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               DUP 3 ;
                               CAR ;
                               CDR ;
                               ADD ;
                               COMPARE ;
                               LE ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: (params.amount + self.data.users[params.account].balance_locked) <= self.data.users[params.account].balance" ;
                                    FAILWITH } ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 773 ; FAILWITH } {} ;
                               UNPAIR ;
                               CDR ;
                               DUP 7 ;
                               CAR ;
                               CDR ;
                               DIG 8 ;
                               GET 4 ;
                               DUP 9 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               CAR ;
                               CAR ;
                               SUB ;
                               ISNAT ;
                               IF_NONE { PUSH int 773 ; FAILWITH } {} ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             {} ;
                          DUP ;
                          GET 4 ;
                          PUSH string "creditcard" ;
                          COMPARE ;
                          EQ ;
                          IF { SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 776 ; FAILWITH } {} ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               PUSH bool True ;
                               DUP 9 ;
                               GET 3 ;
                               UPDATE ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             {} ;
                          DUP ;
                          GET 4 ;
                          PUSH string "prepay" ;
                          COMPARE ;
                          EQ ;
                          IF { NIL operation ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               GET 6 ;
                               IF_NONE { PUSH int 750 ; FAILWITH } {} ;
                               CONTRACT %lock (pair (nat %amount) (bool %lock)) ;
                               IF_NONE { PUSH int 750 ; FAILWITH } {} ;
                               PUSH mutez 0 ;
                               PUSH bool False ;
                               DIG 4 ;
                               DUP ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 6 ;
                               GET 3 ;
                               UNPACK nat ;
                               IF_NONE { PUSH int 748 ; FAILWITH } {} ;
                               MUL ;
                               PAIR %amount %lock ;
                               TRANSFER_TOKENS ;
                               CONS ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                               GET 6 ;
                               IF_NONE { PUSH int 750 ; FAILWITH } {} ;
                               CONTRACT %consume nat ;
                               IF_NONE { PUSH int 781 ; FAILWITH } {} ;
                               PUSH mutez 0 ;
                               DIG 3 ;
                               DUP ;
                               CAR ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 5 ;
                               GET 3 ;
                               UNPACK nat ;
                               IF_NONE { PUSH int 779 ; FAILWITH } {} ;
                               MUL ;
                               TRANSFER_TOKENS ;
                               CONS }
                             { NIL operation } ;
                          PUSH string "balance" ;
                          DUP 3 ;
                          GET 4 ;
                          COMPARE ;
                          EQ ;
                          IF { PUSH bool False }
                             { PUSH string "prepay" ; DUP 3 ; GET 4 ; COMPARE ; NEQ } ;
                          IF { PUSH string "creditcard" ; DUP 3 ; GET 4 ; COMPARE ; NEQ }
                             { PUSH bool False } ;
                          IF { PUSH string "WrongCondition: False" ; FAILWITH } {} ;
                          DUP 3 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          DIG 5 ;
                          GET 4 ;
                          DUP 6 ;
                          CAR ;
                          CAR ;
                          GET ;
                          IF_NONE { PUSH int 809 ; FAILWITH } {} ;
                          SOME ;
                          DIG 5 ;
                          CAR ;
                          CAR ;
                          UPDATE ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP }
                        { DROP ; NIL operation } } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     MEM ;
                     IF { DUP ;
                          GET 4 ;
                          IF { SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 705 ; FAILWITH } {} ;
                               UNPAIR ;
                               UNPAIR ;
                               DUP 8 ;
                               GET 3 ;
                               ADD ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP }
                             { SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 703 ; FAILWITH } {} ;
                               CAR ;
                               CAR ;
                               DUP 3 ;
                               GET 4 ;
                               DUP 3 ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 703 ; FAILWITH } {} ;
                               CAR ;
                               CDR ;
                               DUP 3 ;
                               GET 3 ;
                               ADD ;
                               COMPARE ;
                               LE ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: (params.amount + self.data.users[params.account].balance_locked) <= self.data.users[params.account].balance" ;
                                    FAILWITH } ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DUP 5 ;
                               CAR ;
                               DUP ;
                               DUG 2 ;
                               GET ;
                               IF_NONE { PUSH int 708 ; FAILWITH } {} ;
                               UNPAIR ;
                               CDR ;
                               DUP 7 ;
                               GET 3 ;
                               DIG 8 ;
                               GET 4 ;
                               DUP 9 ;
                               CAR ;
                               GET ;
                               IF_NONE { PUSH int 703 ; FAILWITH } {} ;
                               CAR ;
                               CAR ;
                               SUB ;
                               ISNAT ;
                               IF_NONE { PUSH int 708 ; FAILWITH } {} ;
                               PAIR ;
                               PAIR ;
                               SOME ;
                               SWAP ;
                               UPDATE ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP } ;
                          SWAP ;
                          DUP ;
                          DUG 2 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          DIG 4 ;
                          GET 4 ;
                          DUP 5 ;
                          CAR ;
                          GET ;
                          IF_NONE { PUSH int 703 ; FAILWITH } {} ;
                          SOME ;
                          DIG 4 ;
                          CAR ;
                          UPDATE ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR }
                        { DROP } ;
                     NIL operation }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                         DUP ;
                         ITER { DUP ;
                                CDR ;
                                IF { DIG 2 ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     PUSH bool True ;
                                     DIG 4 ;
                                     CAR ;
                                     UPDATE ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP }
                                   { DIG 2 ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     PUSH bool False ;
                                     DIG 4 ;
                                     CAR ;
                                     UPDATE ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP } } ;
                         DROP ;
                         NIL operation }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         SENDER ;
                         MEM ;
                         IF {}
                            { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         MEM ;
                         IF {}
                            { PUSH string "WrongCondition: self.data.users.contains(params.account)" ;
                              FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         GET 4 ;
                         DUP 3 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 717 ; FAILWITH } {} ;
                         GET 6 ;
                         IF_NONE { PUSH int 717 ; FAILWITH } {} ;
                         CONTRACT %withdraw (pair (address %address) (nat %amount)) ;
                         IF_NONE { PUSH int 717 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         DUP ;
                         GET 4 ;
                         SWAP ;
                         GET 3 ;
                         PAIR %address %amount ;
                         TRANSFER_TOKENS ;
                         CONS } } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
