{ parameter
    (or (unit %abortCreated)
        (or (unit %abortFunded) (or (unit %abort) (or (unit %fund) (unit %complete))))) ;
  storage
    (pair (address %seller)
          (pair (address %buyer)
                (pair (address %taxcollector) (pair (mutez %price) (nat %_state))))) ;
  code { NIL operation ;
         DIG 1 ;
         UNPAIR ;
         DIP 1 { UNPAIR ; SWAP ; UNPAIR ; SWAP ; UNPAIR ; SWAP ; UNPAIR ; SWAP } ;
         IF_LEFT
           { DROP 1 ;
             DIG 3 ;
             DUP ;
             DUG 4 ;
             SENDER ;
             COMPARE ;
             EQ ;
             NOT ;
             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
             DUP ;
             DUP ;
             PUSH nat 0 ;
             COMPARE ;
             EQ ;
             IF { PUSH nat 1 ; DIP 1 { DIG 1 ; DROP 1 } ; DUG 1 }
                { PUSH string "InvalidState" ; FAILWITH } ;
             DROP 1 ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             DIG 1 ;
             PAIR }
           { IF_LEFT
               { DROP 1 ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 NOT ;
                 IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                 DUP ;
                 DUP ;
                 PUSH nat 2 ;
                 COMPARE ;
                 EQ ;
                 IF { PUSH nat 1 ; DIP 1 { DIG 1 ; DROP 1 } ; DUG 1 }
                    { PUSH string "InvalidState" ; FAILWITH } ;
                 DROP 1 ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DIG 1 ;
                 PAIR }
               { IF_LEFT
                   { DROP 1 ;
                     PUSH timestamp 1615465045 ;
                     NOW ;
                     COMPARE ;
                     GT ;
                     IF { PUSH nat 1 ; SWAP ; DROP 1 } {} ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DIG 1 ;
                     PAIR }
                   { IF_LEFT
                       { DROP 1 ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         NOT ;
                         IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                         DUP ;
                         DUP ;
                         PUSH nat 0 ;
                         COMPARE ;
                         EQ ;
                         IF { DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              UNIT ;
                              LEFT unit ;
                              PUSH nat 10 ;
                              PUSH int 11 ;
                              PAIR ;
                              UNIT ;
                              LEFT unit ;
                              PUSH nat 5 ;
                              PUSH int 1 ;
                              PAIR ;
                              PUSH nat 1 ;
                              PUSH int 1 ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              DIP 1 { UNPAIR ; SWAP ; DUP } ;
                              UNPAIR ;
                              SWAP ;
                              DUP ;
                              DIG 3 ;
                              MUL ;
                              DUG 4 ;
                              DIG 3 ;
                              MUL ;
                              DIP 1 { MUL } ;
                              DIG 3 ;
                              IF_LEFT { DROP 1 ; ADD } { DROP 1 ; SWAP ; SUB } ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              DIP 1 { UNPAIR ; SWAP ; DUP } ;
                              UNPAIR ;
                              SWAP ;
                              DUP ;
                              DIG 3 ;
                              MUL ;
                              DUG 4 ;
                              DIG 3 ;
                              MUL ;
                              DIP 1 { MUL } ;
                              DIG 3 ;
                              IF_LEFT { DROP 1 ; ADD } { DROP 1 ; SWAP ; SUB } ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              ABS ;
                              DIG 2 ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                              CAR ;
                              AMOUNT ;
                              COMPARE ;
                              GE ;
                              IF { PUSH nat 2 ; DIP 1 { DIG 1 ; DROP 1 } ; DUG 1 } {} }
                            { PUSH string "InvalidState" ; FAILWITH } ;
                         DROP 1 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DIG 1 ;
                         PAIR }
                       { DROP 1 ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         NOT ;
                         IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                         DUP ;
                         DUP ;
                         PUSH nat 2 ;
                         COMPARE ;
                         EQ ;
                         IF { DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIP 1 { DIG 6 ; DROP 1 } ;
                              DUG 6 ;
                              DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              PUSH nat 5 ;
                              PUSH int 1 ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              ABS ;
                              DIG 2 ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                              CAR ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIP 1 { DIG 6 ; DROP 1 } ;
                              DUG 6 ;
                              DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              PUSH nat 10 ;
                              PUSH int 11 ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              UNPAIR ;
                              ABS ;
                              DIG 2 ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                              CAR ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIP 1 { DIG 6 ; DROP 1 } ;
                              DUG 6 ;
                              PUSH nat 4 ;
                              DIP 1 { DIG 1 ; DROP 1 } ;
                              DUG 1 }
                            { PUSH string "InvalidState" ; FAILWITH } ;
                         DROP 1 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DIG 1 ;
                         PAIR } } } } } }
