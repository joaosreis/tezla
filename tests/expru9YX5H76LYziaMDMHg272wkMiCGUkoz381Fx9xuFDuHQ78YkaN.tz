{ storage
    (pair (pair (pair (address %administrator)
                      (pair (pair %claims
                               (pair (pair (map %claimers address nat) (mutez %claiming_price))
                                     (pair (nat %cur_claim_key) (nat %max_claims_per_period)))
                               (pair (pair (nat %max_free_claims_per_addr) (nat %max_paid_claims_per_addr))
                                     (pair (int %period_len) (timestamp %period_start))))
                            (address %distributor)))
                (pair (address %fa2) (pair (big_map %metadata string bytes) (bool %paused))))
          (pair (pair (map %series
                         nat
                         (pair (bool %claimable)
                               (pair (map %levels
                                        nat
                                        (pair (pair (pair (nat %burned) (mutez %high)) (pair (mutez %last) (mutez %low)))
                                              (pair (pair (nat %minted) (nat %rarity))
                                                    (pair (nat %sales) (pair (map %token_info string bytes) (nat %trades))))))
                                     (nat %series_id))))
                      (pair (map %series_meta
                               nat
                               (pair (nat %cap) (pair (mutez %upgrade_cost) (nat %upgrade_req))))
                            (mutez %treasure)))
                (pair (nat %treasure_cnt) (pair (nat %treasure_fee) (nat %treasure_payout))))) ;
  parameter
    (or (or (or (unit %claim)
                (or (list %create_series
                       (pair (bool %claimable)
                             (pair (map %levels
                                      nat
                                      (pair (pair (pair (nat %burned) (mutez %high)) (pair (mutez %last) (mutez %low)))
                                            (pair (pair (nat %minted) (nat %rarity))
                                                  (pair (nat %sales) (pair (map %token_info string bytes) (nat %trades))))))
                                   (nat %series_id))))
                    (pair %mutez_transfer (mutez %amount) (address %destination))))
            (or (or (list %record_trade_meta (pair (mutez %price) (pair (nat %token_id) (bool %trade))))
                    (address %set_administrator))
                (or (pair %set_claim_meta
                       (pair (mutez %claiming_price) (nat %max_claims_per_period))
                       (pair (nat %max_free_claims_per_addr)
                             (pair (nat %max_paid_claims_per_addr) (int %period_len))))
                    (address %set_distributor))))
        (or (or (address %set_fa2)
                (or (bool %set_pause)
                    (map %set_series_meta
                       nat
                       (pair (nat %cap) (pair (mutez %upgrade_cost) (nat %upgrade_req))))))
            (or (or (pair %set_treasure_params (nat %treasure_fee) (nat %treasure_payout))
                    (pair %update_series_claimable (bool %claimable) (nat %series_id)))
                (or (pair %update_token_info (nat %token_id) (map %token_info string bytes))
                    (nat %upgrade))))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 6 ;
                     IF { PUSH string "WrongCondition: ~ self.data.paused" ; FAILWITH } {} ;
                     PUSH int 0 ;
                     DIG 2 ;
                     DUP ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     GET 6 ;
                     SWAP ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     GET 5 ;
                     ADD ;
                     NOW ;
                     SUB ;
                     COMPARE ;
                     GT ;
                     IF { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          CAR ;
                          NOW ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          UNPAIR ;
                          CDR ;
                          EMPTY_MAP address nat ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP }
                        {} ;
                     PUSH nat 0 ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     ITER { CDR ; ADD } ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     COMPARE ;
                     LT ;
                     IF {}
                        { PUSH string
                               "WrongCondition: result.value < self.data.claims.max_claims_per_period" ;
                          FAILWITH } ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     MEM ;
                     IF { DIG 2 ;
                          DUP ;
                          CAR ;
                          CAR ;
                          GET 3 ;
                          GET 3 ;
                          CAR ;
                          SWAP ;
                          DUP ;
                          DUG 4 ;
                          CAR ;
                          CAR ;
                          GET 3 ;
                          CAR ;
                          CAR ;
                          CAR ;
                          SENDER ;
                          GET ;
                          IF_NONE { PUSH int 340 ; FAILWITH } {} ;
                          COMPARE ;
                          GE ;
                          IF { DIG 2 ;
                               DUP ;
                               CAR ;
                               CAR ;
                               GET 3 ;
                               GET 3 ;
                               CDR ;
                               SWAP ;
                               DUP ;
                               DUG 4 ;
                               CAR ;
                               CAR ;
                               GET 3 ;
                               GET 3 ;
                               CAR ;
                               ADD ;
                               DUP 4 ;
                               CAR ;
                               CAR ;
                               GET 3 ;
                               CAR ;
                               CAR ;
                               CAR ;
                               SENDER ;
                               GET ;
                               IF_NONE { PUSH int 343 ; FAILWITH } {} ;
                               COMPARE ;
                               LT ;
                               IF {}
                                  { PUSH string
                                         "WrongCondition: self.data.claims.claimers[sp.sender] < (self.data.claims.max_free_claims_per_addr + self.data.claims.max_paid_claims_per_addr)" ;
                                    FAILWITH } ;
                               DUP 3 ;
                               CAR ;
                               CAR ;
                               GET 3 ;
                               CAR ;
                               CAR ;
                               CDR ;
                               AMOUNT ;
                               COMPARE ;
                               EQ ;
                               IF {}
                                  { PUSH string "WrongCondition: sp.amount == self.data.claims.claiming_price" ;
                                    FAILWITH } ;
                               PUSH mutez 0 ;
                               AMOUNT ;
                               COMPARE ;
                               GT ;
                               IF { NIL operation ;
                                    DUP 4 ;
                                    CAR ;
                                    CAR ;
                                    GET 4 ;
                                    CONTRACT %distribute unit ;
                                    IF_NONE { PUSH int 80 ; FAILWITH } {} ;
                                    AMOUNT ;
                                    UNIT ;
                                    TRANSFER_TOKENS ;
                                    CONS }
                                  { NIL operation } }
                             { PUSH mutez 0 ;
                               AMOUNT ;
                               COMPARE ;
                               GT ;
                               IF { NIL operation ;
                                    SENDER ;
                                    CONTRACT unit ;
                                    IF_NONE { PUSH int 348 ; FAILWITH } {} ;
                                    AMOUNT ;
                                    UNIT ;
                                    TRANSFER_TOKENS ;
                                    CONS }
                                  { NIL operation } } }
                        { PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { NIL operation ;
                               SENDER ;
                               CONTRACT unit ;
                               IF_NONE { PUSH int 351 ; FAILWITH } {} ;
                               AMOUNT ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               CONS }
                             { NIL operation } } ;
                     PUSH bool False ;
                     DUP 5 ;
                     GET 3 ;
                     CAR ;
                     SIZE ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     NOT ;
                     LOOP { DUP ;
                            PUSH nat 0 ;
                            COMPARE ;
                            EQ ;
                            IF { PUSH string "PP_CLAIMS_MAXED" ; FAILWITH } {} ;
                            DUP 6 ;
                            CAR ;
                            CAR ;
                            GET 3 ;
                            CAR ;
                            GET 3 ;
                            PUSH bool False ;
                            DUP 8 ;
                            GET 3 ;
                            CAR ;
                            ITER { CAR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   IF { SWAP ; DROP ; SWAP ; DROP ; DUP ; PUSH bool False ; SWAP } {} ;
                                   DUP 3 ;
                                   COMPARE ;
                                   EQ ;
                                   IF { DROP ; PUSH bool True } {} } ;
                            DUP 8 ;
                            CAR ;
                            CAR ;
                            GET 3 ;
                            CAR ;
                            GET 3 ;
                            DUP 3 ;
                            COMPARE ;
                            EQ ;
                            IF { DROP ;
                                 PUSH bool True ;
                                 DUP 8 ;
                                 GET 3 ;
                                 CAR ;
                                 ITER { CAR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        IF { SWAP ; DROP ; SWAP ; DROP ; PUSH bool False } { DROP } } }
                               {} ;
                            DIG 7 ;
                            UNPAIR ;
                            UNPAIR ;
                            UNPAIR ;
                            SWAP ;
                            UNPAIR ;
                            UNPAIR ;
                            UNPAIR ;
                            SWAP ;
                            CDR ;
                            DUP 9 ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            PAIR ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            PAIR ;
                            PAIR ;
                            DUP ;
                            GET 3 ;
                            CAR ;
                            SWAP ;
                            DUP ;
                            DUG 9 ;
                            CAR ;
                            CAR ;
                            GET 3 ;
                            CAR ;
                            GET 3 ;
                            GET ;
                            IF_NONE { PUSH int 361 ; FAILWITH } {} ;
                            CAR ;
                            IF { DIG 3 ; DROP 3 ; PUSH bool True ; SWAP } { DROP 2 } ;
                            PUSH nat 1 ;
                            SWAP ;
                            SUB ;
                            ISNAT ;
                            IF_NONE { PUSH int 363 ; FAILWITH } {} ;
                            SWAP ;
                            DUP ;
                            DUG 2 ;
                            NOT } ;
                     DROP 2 ;
                     SWAP ;
                     DROP ;
                     SWAP ;
                     DROP ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     GET 3 ;
                     PUSH nat 1000 ;
                     GET ;
                     IF_NONE { PUSH int 369 ; FAILWITH } {} ;
                     CAR ;
                     PUSH nat 1 ;
                     DIG 3 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 5 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 3 ;
                     DIG 4 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 367 ; FAILWITH } {} ;
                     GET 3 ;
                     CAR ;
                     ADD ;
                     COMPARE ;
                     LE ;
                     IF {}
                        { PUSH string
                               "WrongCondition: (self.data.series[self.data.claims.cur_claim_key].levels[1000 + self.data.series[self.data.claims.cur_claim_key].series_id].minted + 1) <= self.data.series_meta[1000].cap" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DUP 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 371 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     DUP ;
                     DIG 10 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 371 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     PUSH nat 1 ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     CONTRACT %mint
                       (pair (pair (address %address) (nat %amount))
                             (pair (map %metadata string bytes) (nat %token_id))) ;
                     IF_NONE { PUSH int 452 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DIG 3 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 5 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     DIG 4 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 3 ;
                     DIG 5 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 367 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     ADD ;
                     DIG 4 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 3 ;
                     DIG 5 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 367 ; FAILWITH } {} ;
                     GET 7 ;
                     PAIR %metadata %token_id ;
                     PUSH nat 1 ;
                     SENDER ;
                     PAIR %address %amount ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     GET 3 ;
                     PUSH nat 1000 ;
                     GET ;
                     IF_NONE { PUSH int 379 ; FAILWITH } {} ;
                     CAR ;
                     DIG 2 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 4 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 3 ;
                     DIG 3 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 5 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 367 ; FAILWITH } {} ;
                     GET 3 ;
                     CAR ;
                     COMPARE ;
                     EQ ;
                     IF { SWAP ;
                          DUP ;
                          DUG 2 ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          DUP ;
                          DIG 6 ;
                          CAR ;
                          CAR ;
                          GET 3 ;
                          CAR ;
                          GET 3 ;
                          DUP ;
                          DUG 2 ;
                          GET ;
                          IF_NONE { PUSH int 380 ; FAILWITH } {} ;
                          CDR ;
                          PUSH bool False ;
                          PAIR ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP }
                        {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DUP 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 382 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     DIG 9 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 11 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 3 ;
                     DIG 10 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 12 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     GET ;
                     IF_NONE { PUSH int 367 ; FAILWITH } {} ;
                     SOME ;
                     DIG 10 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     GET 4 ;
                     PUSH nat 1000 ;
                     ADD ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DIG 5 ;
                     DUP ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     GET ;
                     IF_NONE { PUSH int 365 ; FAILWITH } {} ;
                     SOME ;
                     DIG 6 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     GET 3 ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     MEM ;
                     IF { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          DUP ;
                          SENDER ;
                          DUP ;
                          DUG 2 ;
                          GET ;
                          IF_NONE { PUSH int 386 ; FAILWITH } {} ;
                          PUSH nat 1 ;
                          ADD ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP }
                        { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          PUSH (option nat) (Some 1) ;
                          SENDER ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         DUP ;
                         ITER { DUP 3 ;
                                GET 3 ;
                                CAR ;
                                SWAP ;
                                DUP ;
                                DUG 2 ;
                                GET 4 ;
                                MEM ;
                                IF { PUSH string "PP_SERIES_UNDEFINED" ; FAILWITH } {} ;
                                DIG 2 ;
                                UNPAIR ;
                                SWAP ;
                                UNPAIR ;
                                UNPAIR ;
                                DIG 4 ;
                                DUP ;
                                SOME ;
                                SWAP ;
                                GET 4 ;
                                UPDATE ;
                                PAIR ;
                                PAIR ;
                                SWAP ;
                                PAIR ;
                                SWAP } ;
                         DROP ;
                         NIL operation }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         DUP ;
                         CDR ;
                         CONTRACT unit ;
                         IF_NONE { PUSH int 342 ; FAILWITH } {} ;
                         NIL operation ;
                         SWAP ;
                         DIG 2 ;
                         CAR ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.fa2" ; FAILWITH } ;
                         DUP ;
                         ITER { DUP ;
                                GET 4 ;
                                IF { DIG 2 ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     UNPAIR ;
                                     DUP ;
                                     PUSH nat 1000 ;
                                     DUP 7 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 232 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     DUP ;
                                     DIG 9 ;
                                     GET 3 ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 232 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     SWAP ;
                                     PUSH nat 1 ;
                                     ADD ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     PAIR ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP }
                                   { DIG 2 ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     UNPAIR ;
                                     DUP ;
                                     PUSH nat 1000 ;
                                     DUP 7 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 234 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     DUP ;
                                     DUP 10 ;
                                     GET 3 ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 234 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     PUSH nat 1 ;
                                     ADD ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     DUP ;
                                     PUSH nat 1000 ;
                                     DUP 7 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     SWAP ;
                                     UNPAIR ;
                                     DUP ;
                                     DUP 10 ;
                                     GET 3 ;
                                     DUP ;
                                     DUG 2 ;
                                     GET ;
                                     IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                                     UNPAIR ;
                                     UNPAIR ;
                                     SWAP ;
                                     CDR ;
                                     DUP 13 ;
                                     CAR ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SOME ;
                                     SWAP ;
                                     UPDATE ;
                                     PAIR ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     DUP ;
                                     DUG 3 ;
                                     GET 3 ;
                                     CAR ;
                                     PUSH nat 1000 ;
                                     DUP 3 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     GET ;
                                     IF_NONE { PUSH int 236 ; FAILWITH } {} ;
                                     GET 3 ;
                                     SWAP ;
                                     DUP ;
                                     DUG 2 ;
                                     GET 3 ;
                                     GET ;
                                     IF_NONE { PUSH int 236 ; FAILWITH } {} ;
                                     CAR ;
                                     CAR ;
                                     CDR ;
                                     SWAP ;
                                     DUP ;
                                     DUG 2 ;
                                     CAR ;
                                     COMPARE ;
                                     GT ;
                                     IF { DIG 2 ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          DUP ;
                                          PUSH nat 1000 ;
                                          DUP 7 ;
                                          GET 3 ;
                                          EDIV ;
                                          IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 237 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          DUP ;
                                          DUP 10 ;
                                          GET 3 ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 237 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          CAR ;
                                          DUP 13 ;
                                          CAR ;
                                          SWAP ;
                                          PAIR ;
                                          PAIR ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          DUG 2 }
                                        {} ;
                                     PUSH mutez 0 ;
                                     DUP 4 ;
                                     GET 3 ;
                                     CAR ;
                                     PUSH nat 1000 ;
                                     DUP 4 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     GET ;
                                     IF_NONE { PUSH int 238 ; FAILWITH } {} ;
                                     GET 3 ;
                                     DUP 3 ;
                                     GET 3 ;
                                     GET ;
                                     IF_NONE { PUSH int 238 ; FAILWITH } {} ;
                                     CAR ;
                                     GET 4 ;
                                     COMPARE ;
                                     EQ ;
                                     IF { DIG 2 ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          DUP ;
                                          PUSH nat 1000 ;
                                          DUP 7 ;
                                          GET 3 ;
                                          EDIV ;
                                          IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 239 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          DUP ;
                                          DUP 10 ;
                                          GET 3 ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 239 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          SWAP ;
                                          CAR ;
                                          DUP 13 ;
                                          CAR ;
                                          SWAP ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          DUG 2 }
                                        {} ;
                                     DUP 3 ;
                                     GET 3 ;
                                     CAR ;
                                     PUSH nat 1000 ;
                                     DUP 3 ;
                                     GET 3 ;
                                     EDIV ;
                                     IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                     GET ;
                                     IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                                     GET 3 ;
                                     SWAP ;
                                     DUP ;
                                     DUG 2 ;
                                     GET 3 ;
                                     GET ;
                                     IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                                     CAR ;
                                     GET 4 ;
                                     SWAP ;
                                     DUP ;
                                     DUG 2 ;
                                     CAR ;
                                     COMPARE ;
                                     LT ;
                                     IF { DIG 2 ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          DUP ;
                                          PUSH nat 1000 ;
                                          DUP 7 ;
                                          GET 3 ;
                                          EDIV ;
                                          IF_NONE { PUSH int 230 ; FAILWITH } { CDR } ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 241 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          SWAP ;
                                          UNPAIR ;
                                          DUP ;
                                          DUP 10 ;
                                          GET 3 ;
                                          DUP ;
                                          DUG 2 ;
                                          GET ;
                                          IF_NONE { PUSH int 241 ; FAILWITH } {} ;
                                          UNPAIR ;
                                          UNPAIR ;
                                          SWAP ;
                                          CAR ;
                                          DIG 12 ;
                                          CAR ;
                                          SWAP ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          SOME ;
                                          SWAP ;
                                          UPDATE ;
                                          PAIR ;
                                          PAIR ;
                                          SWAP ;
                                          PAIR ;
                                          SWAP }
                                        { DROP } } } ;
                         DROP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         PAIR ;
                         PAIR } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DUP 8 ;
                         GET 6 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DUP 8 ;
                         CAR ;
                         CDR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         CDR ;
                         DUP 7 ;
                         GET 3 ;
                         DUP 8 ;
                         GET 5 ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         CAR ;
                         DIG 7 ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR } } ;
                 NIL operation } }
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                          FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     CDR ;
                     DIG 3 ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 4 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR } } ;
                 NIL operation }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DUP 4 ;
                         CAR ;
                         DIG 4 ;
                         CDR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         MEM ;
                         IF {}
                            { PUSH string "WrongCondition: self.data.series.contains(params.series_id)" ;
                              FAILWITH } ;
                         DUP ;
                         CAR ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              GET 3 ;
                              GET 3 ;
                              PUSH nat 1000 ;
                              GET ;
                              IF_NONE { PUSH int 167 ; FAILWITH } {} ;
                              CAR ;
                              DUP 3 ;
                              GET 3 ;
                              CAR ;
                              DUP 3 ;
                              CDR ;
                              GET ;
                              IF_NONE { PUSH int 165 ; FAILWITH } {} ;
                              GET 3 ;
                              DUP 3 ;
                              CDR ;
                              PUSH nat 1000 ;
                              ADD ;
                              GET ;
                              IF_NONE { PUSH int 165 ; FAILWITH } {} ;
                              GET 3 ;
                              CAR ;
                              COMPARE ;
                              LT ;
                              IF {}
                                 { PUSH string
                                        "WrongCondition: self.data.series[params.series_id].levels[1000 + params.series_id].minted < self.data.series_meta[1000].cap" ;
                                   FAILWITH } }
                            {} ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DUP ;
                         DUP 6 ;
                         CDR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 169 ; FAILWITH } {} ;
                         CDR ;
                         DUP 7 ;
                         CAR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DIG 5 ;
                         GET 3 ;
                         CAR ;
                         DUP 6 ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 163 ; FAILWITH } {} ;
                         SOME ;
                         DIG 5 ;
                         CDR ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR } ;
                     NIL operation }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.administrator" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DUP ;
                         PUSH nat 1000 ;
                         DUP 7 ;
                         CAR ;
                         EDIV ;
                         IF_NONE { PUSH int 200 ; FAILWITH } { CDR } ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 201 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 10 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 201 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DUP 14 ;
                         CDR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         NIL operation ;
                         DUP 3 ;
                         CAR ;
                         GET 3 ;
                         CONTRACT %update_token_info (pair (map %metadata string bytes) (nat %token_id)) ;
                         IF_NONE { PUSH int 203 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         UNPAIR ;
                         SWAP ;
                         PAIR %metadata %token_id ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 6 ;
                         IF { PUSH string "WrongCondition: ~ self.data.paused" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 3 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         MEM ;
                         IF {} { PUSH string "PP_SERIES_UNDEFINED" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 3 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         PUSH nat 1000 ;
                         DUP 3 ;
                         ADD ;
                         MEM ;
                         IF {}
                            { PUSH string
                                   "WrongCondition: self.data.series[params.token_id % 1000].levels.contains(params.token_id + 1000)" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SWAP ;
                         DUP ;
                         DUG 3 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 4 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         PUSH nat 1000 ;
                         DUP 4 ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 258 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 260 ; FAILWITH } {} ;
                         CAR ;
                         PUSH nat 1 ;
                         DUP 4 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 5 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         PUSH nat 1000 ;
                         DUP 5 ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 258 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         ADD ;
                         COMPARE ;
                         LE ;
                         IF {} { PUSH string "PP_TOKEN_CAPPED" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SWAP ;
                         DUP ;
                         DUG 3 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 4 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 255 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 263 ; FAILWITH } {} ;
                         GET 3 ;
                         AMOUNT ;
                         COMPARE ;
                         GE ;
                         IF {} { PUSH string "PP_INSUFFICIENT_AMOUNT" ; FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         CAR ;
                         GET 3 ;
                         CONTRACT %do_upgrade
                           (pair (pair (address %address) (nat %nt_id))
                                 (pair (map %nt_md string bytes) (pair (nat %token_id) (nat %upgrade_req)))) ;
                         IF_NONE { PUSH int 267 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DIG 4 ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SWAP ;
                         DUP ;
                         DUG 6 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 7 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 255 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                         GET 4 ;
                         DUP 5 ;
                         PAIR %token_id %upgrade_req ;
                         DUP 6 ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 7 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         PUSH nat 1000 ;
                         DUP 7 ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 258 ; FAILWITH } {} ;
                         GET 7 ;
                         PAIR %nt_md ;
                         PUSH nat 1000 ;
                         DUP 6 ;
                         ADD ;
                         SENDER ;
                         PAIR %address %nt_id ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DUP ;
                         PUSH nat 1000 ;
                         DUP 8 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 290 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 11 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 290 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         DIG 15 ;
                         DUP ;
                         GET 3 ;
                         GET 3 ;
                         SWAP ;
                         GET 3 ;
                         CAR ;
                         PUSH nat 1000 ;
                         DUP 18 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         GET ;
                         IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                         GET 3 ;
                         DUP 17 ;
                         GET ;
                         IF_NONE { PUSH int 255 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 290 ; FAILWITH } {} ;
                         GET 4 ;
                         ADD ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         PUSH nat 1000 ;
                         DUP 8 ;
                         EDIV ;
                         IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 291 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         PUSH nat 1000 ;
                         DUP 12 ;
                         ADD ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 291 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         PUSH nat 1 ;
                         ADD ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DUP ;
                         DUG 3 ;
                         GET 3 ;
                         CAR ;
                         SIZE ;
                         DUP 4 ;
                         GET 5 ;
                         COMPARE ;
                         LT ;
                         IF { DUP 3 ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              PUSH nat 100 ;
                              AMOUNT ;
                              DIG 9 ;
                              GET 7 ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH int 295 ; FAILWITH } {} ;
                              CAR ;
                              ADD ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              DUG 2 ;
                              PUSH nat 6000 ;
                              DUP 4 ;
                              GET 3 ;
                              CAR ;
                              PUSH nat 1000 ;
                              DUP 5 ;
                              EDIV ;
                              IF_NONE { PUSH int 251 ; FAILWITH } { CDR } ;
                              GET ;
                              IF_NONE { PUSH int 254 ; FAILWITH } {} ;
                              GET 3 ;
                              PUSH nat 1000 ;
                              DIG 4 ;
                              ADD ;
                              GET ;
                              IF_NONE { PUSH int 258 ; FAILWITH } {} ;
                              GET 3 ;
                              CDR ;
                              COMPARE ;
                              EQ ;
                              IF { SWAP ;
                                   UNPAIR ;
                                   SWAP ;
                                   UNPAIR ;
                                   SWAP ;
                                   UNPAIR ;
                                   PUSH nat 1 ;
                                   ADD ;
                                   PAIR ;
                                   SWAP ;
                                   PAIR ;
                                   SWAP ;
                                   PAIR ;
                                   DUP ;
                                   DUG 2 ;
                                   GET 3 ;
                                   CAR ;
                                   SIZE ;
                                   DUP 3 ;
                                   GET 5 ;
                                   COMPARE ;
                                   EQ ;
                                   IF { SENDER ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH int 309 ; FAILWITH } {} ;
                                        DUP 3 ;
                                        GET 3 ;
                                        GET 4 ;
                                        UNIT ;
                                        TRANSFER_TOKENS ;
                                        CONS ;
                                        SWAP ;
                                        UNPAIR ;
                                        SWAP ;
                                        UNPAIR ;
                                        UNPAIR ;
                                        SWAP ;
                                        CAR ;
                                        PUSH mutez 0 ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP ;
                                        PAIR ;
                                        PAIR ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP }
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        UNPAIR ;
                                        SWAP ;
                                        UNPAIR ;
                                        UNPAIR ;
                                        SWAP ;
                                        UNPAIR ;
                                        SWAP ;
                                        PUSH nat 100 ;
                                        DIG 7 ;
                                        DUP ;
                                        GET 3 ;
                                        GET 4 ;
                                        SWAP ;
                                        GET 8 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH int 312 ; FAILWITH } {} ;
                                        CAR ;
                                        SWAP ;
                                        SUB ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP ;
                                        PAIR ;
                                        PAIR ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP ;
                                        SENDER ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH int 314 ; FAILWITH } {} ;
                                        PUSH nat 100 ;
                                        DIG 3 ;
                                        DUP ;
                                        GET 3 ;
                                        GET 4 ;
                                        SWAP ;
                                        DUP ;
                                        DUG 5 ;
                                        GET 8 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH int 312 ; FAILWITH } {} ;
                                        CAR ;
                                        UNIT ;
                                        TRANSFER_TOKENS ;
                                        CONS } }
                                 {} ;
                              PUSH mutez 0 ;
                              PUSH nat 100 ;
                              AMOUNT ;
                              DUP 5 ;
                              GET 7 ;
                              MUL ;
                              EDIV ;
                              IF_NONE { PUSH int 295 ; FAILWITH } {} ;
                              CAR ;
                              AMOUNT ;
                              SUB ;
                              COMPARE ;
                              GT ;
                              IF { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CAR ;
                                   CAR ;
                                   GET 4 ;
                                   CONTRACT %distribute unit ;
                                   IF_NONE { PUSH int 80 ; FAILWITH } {} ;
                                   PUSH nat 100 ;
                                   AMOUNT ;
                                   DUP 5 ;
                                   GET 7 ;
                                   MUL ;
                                   EDIV ;
                                   IF_NONE { PUSH int 295 ; FAILWITH } {} ;
                                   CAR ;
                                   AMOUNT ;
                                   SUB ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 {} }
                            { SWAP ;
                              DROP ;
                              PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CAR ;
                                   CAR ;
                                   GET 4 ;
                                   CONTRACT %distribute unit ;
                                   IF_NONE { PUSH int 80 ; FAILWITH } {} ;
                                   AMOUNT ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 {} } } } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
