{ storage
    (pair (pair (pair (address %akaProtocol) (pair (nat %auction_id) (address %auction_oracle)))
                (pair (bool %auction_pause)
                      (pair (big_map %auctions
                               nat
                               (pair (pair (pair (nat %akaOBJ_id) (pair (mutez %current_bid_price) (address %current_bidder)))
                                           (pair (mutez %current_store_price) (pair (mutez %direct_price) (timestamp %due_time))))
                                     (pair (pair (address %issuer)
                                                 (pair (string %metadata)
                                                       (map %price_history nat (pair (mutez %bid_price) (address %bidder)))))
                                           (pair (nat %price_history_id) (pair (nat %raise_percentage) (mutez %start_price))))))
                            (nat %bid_violation_limit))))
          (pair (pair (int %extension_minute) (pair (bool %locked) (mutez %lowest_price)))
                (pair (pair (address %manager) (big_map %metadata string bytes))
                      (pair (big_map %raise_percentage_list nat unit)
                            (big_map %violation_list address nat))))) ;
  parameter
    (or (or (or (or (nat %bid_all) (pair %bid_ten_percent (nat %auction_id) (mutez %bid_price)))
                (or (nat %cancel_auction) (nat %close_auction)))
            (or (or (address %configure) (nat %direct_purchase))
                (or (nat %fail_close_auction) (nat %fill_bid))))
        (or (or (or (pair %make_auction
                       (pair (nat %akaOBJ_id) (pair (int %auction_duration) (mutez %direct_price)))
                       (pair (string %metadata) (pair (nat %raise_percentage) (mutez %start_price))))
                    (bool %protocol_set_auction_pause))
                (or (mutez %protocol_set_lowest_price) (nat %set_bid_violation_limit)))
            (or (or (pair %set_metadata (string %k) (bytes %v)) (address %update_auction_oracle))
                (or (address %update_manager)
                    (or (list %update_raise_percentage_list
                           (or (nat %add_percentage) (nat %remove_percentage)))
                        (list %update_violation_list (pair (address %address) (nat %violation_count)))))))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 95 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         NOW ;
                         COMPARE ;
                         LT ;
                         IF {} { PUSH string "Bid failed, over the due time." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 97 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF {}
                            { PUSH string "Bid failed, cannot bid for your own auction." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 99 ; FAILWITH } {} ;
                         GET 8 ;
                         AMOUNT ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Bid failed, bid price smaller than start_price" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 100 ; FAILWITH } {} ;
                         CAR ;
                         GET 5 ;
                         AMOUNT ;
                         COMPARE ;
                         LT ;
                         IF {}
                            { PUSH string "Bid failed, bid price need to be smaller than direct_price" ;
                              FAILWITH } ;
                         PUSH mutez 1 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 102 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         PUSH nat 100 ;
                         DUP 4 ;
                         CAR ;
                         GET 5 ;
                         DUP 4 ;
                         GET ;
                         IF_NONE { PUSH int 102 ; FAILWITH } {} ;
                         GET 7 ;
                         ADD ;
                         MUL ;
                         PUSH nat 100 ;
                         PUSH mutez 1 ;
                         AMOUNT ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         MUL ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Bid failed, need bid more than the raise_percentage." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 8 ;
                         SENDER ;
                         MEM ;
                         IF { SWAP ;
                              DUP ;
                              CAR ;
                              GET 6 ;
                              SWAP ;
                              DUP ;
                              DUG 3 ;
                              GET 8 ;
                              SENDER ;
                              GET ;
                              IF_NONE { PUSH int 108 ; FAILWITH } {} ;
                              COMPARE ;
                              LT ;
                              IF {}
                                 { PUSH string
                                        "WrongCondition: self.data.violation_list[sp.sender] < self.data.bid_violation_limit" ;
                                   FAILWITH } }
                            {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 111 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         PUSH int 60 ;
                         DUP 4 ;
                         GET 3 ;
                         CAR ;
                         NEG ;
                         MUL ;
                         ADD ;
                         NOW ;
                         COMPARE ;
                         GE ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              DUP ;
                              DUP 7 ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 112 ; FAILWITH } {} ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              DUP 12 ;
                              CAR ;
                              GET 5 ;
                              DUP 12 ;
                              GET ;
                              IF_NONE { PUSH int 112 ; FAILWITH } {} ;
                              CAR ;
                              GET 6 ;
                              PUSH int 60 ;
                              DIG 13 ;
                              GET 3 ;
                              CAR ;
                              MUL ;
                              ADD ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP }
                            {} ;
                         PUSH mutez 0 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 115 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF { NIL operation ;
                              DUP 3 ;
                              CAR ;
                              GET 5 ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH int 116 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 116 ; FAILWITH } {} ;
                              DUP 4 ;
                              CAR ;
                              GET 5 ;
                              DUP 4 ;
                              GET ;
                              IF_NONE { PUSH int 116 ; FAILWITH } {} ;
                              CAR ;
                              GET 3 ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { NIL operation } ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 8 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 119 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         AMOUNT ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DUP 8 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 120 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         AMOUNT ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DUP 8 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 121 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         SENDER ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         DUG 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 8 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 122 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         SENDER ;
                         AMOUNT ;
                         PAIR ;
                         SOME ;
                         DIG 14 ;
                         CAR ;
                         GET 5 ;
                         DUP 15 ;
                         GET ;
                         IF_NONE { PUSH int 122 ; FAILWITH } {} ;
                         GET 5 ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DIG 7 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 123 ; FAILWITH } {} ;
                         DUP ;
                         GET 5 ;
                         PUSH nat 1 ;
                         ADD ;
                         UPDATE 5 ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 128 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         NOW ;
                         COMPARE ;
                         LT ;
                         IF {} { PUSH string "Bid failed, over the due time." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 130 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF {}
                            { PUSH string "Bid failed, cannot bid for your own auction." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 132 ; FAILWITH } {} ;
                         GET 8 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Bid failed, bid price smaller than start_price" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 133 ; FAILWITH } {} ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         COMPARE ;
                         LT ;
                         IF {}
                            { PUSH string "Bid failed, bid price need to be smaller than direct_price" ;
                              FAILWITH } ;
                         PUSH nat 10 ;
                         PUSH mutez 1 ;
                         DUP 3 ;
                         CDR ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         EDIV ;
                         IF_NONE { PUSH int 134 ; FAILWITH } { CAR } ;
                         PUSH mutez 1 ;
                         AMOUNT ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Bid failed, transaction amount need equal to 10% of bid price" ;
                              FAILWITH } ;
                         PUSH mutez 1 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 136 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         PUSH nat 100 ;
                         DUP 4 ;
                         CAR ;
                         GET 5 ;
                         DUP 4 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 136 ; FAILWITH } {} ;
                         GET 7 ;
                         ADD ;
                         MUL ;
                         PUSH nat 100 ;
                         PUSH mutez 1 ;
                         DUP 4 ;
                         CDR ;
                         EDIV ;
                         IF_NONE { UNIT ; FAILWITH } {} ;
                         CAR ;
                         MUL ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Bid failed, need bid more than the raise_percentage." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 8 ;
                         SENDER ;
                         MEM ;
                         IF { SWAP ;
                              DUP ;
                              CAR ;
                              GET 6 ;
                              SWAP ;
                              DUP ;
                              DUG 3 ;
                              GET 8 ;
                              SENDER ;
                              GET ;
                              IF_NONE { PUSH int 142 ; FAILWITH } {} ;
                              COMPARE ;
                              LT ;
                              IF {}
                                 { PUSH string
                                        "WrongCondition: self.data.violation_list[sp.sender] < self.data.bid_violation_limit" ;
                                   FAILWITH } }
                            {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 145 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         PUSH int 60 ;
                         DUP 4 ;
                         GET 3 ;
                         CAR ;
                         NEG ;
                         MUL ;
                         ADD ;
                         NOW ;
                         COMPARE ;
                         GE ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              DUP ;
                              DUP 7 ;
                              CAR ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 146 ; FAILWITH } {} ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              DUP 12 ;
                              CAR ;
                              GET 5 ;
                              DUP 12 ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 146 ; FAILWITH } {} ;
                              CAR ;
                              GET 6 ;
                              PUSH int 60 ;
                              DIG 13 ;
                              GET 3 ;
                              CAR ;
                              MUL ;
                              ADD ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP }
                            {} ;
                         PUSH mutez 0 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 149 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF { NIL operation ;
                              DUP 3 ;
                              CAR ;
                              GET 5 ;
                              DUP 3 ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 150 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 150 ; FAILWITH } {} ;
                              DUP 4 ;
                              CAR ;
                              GET 5 ;
                              DUP 4 ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 150 ; FAILWITH } {} ;
                              CAR ;
                              GET 3 ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { NIL operation } ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 8 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 153 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         AMOUNT ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DUP 8 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 154 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DUP 12 ;
                         CDR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DUP 8 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 155 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         SENDER ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         DUG 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 8 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 156 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         SENDER ;
                         DUP 14 ;
                         CDR ;
                         PAIR ;
                         SOME ;
                         DIG 14 ;
                         CAR ;
                         GET 5 ;
                         DUP 15 ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 156 ; FAILWITH } {} ;
                         GET 5 ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         DUP ;
                         DIG 7 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 157 ; FAILWITH } {} ;
                         DUP ;
                         GET 5 ;
                         PUSH nat 1 ;
                         ADD ;
                         UPDATE 5 ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 84 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "You can only cancel your own auction" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 85 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "You can only cancel when nobody bid" ; FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %auction_transfer (pair nat address) ;
                         IF_NONE { PUSH int 87 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         SENDER ;
                         DUP 6 ;
                         CAR ;
                         GET 5 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 88 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         NONE (pair (pair (pair nat (pair mutez address)) (pair mutez (pair mutez timestamp)))
                                    (pair (pair address (pair string (map nat (pair mutez address))))
                                          (pair nat (pair nat mutez)))) ;
                         DIG 7 ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 196 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         NOW ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Close auction failed, still in the due time." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 198 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH bool True }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              GET 5 ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 198 ; FAILWITH } {} ;
                              GET 3 ;
                              CAR ;
                              SENDER ;
                              COMPARE ;
                              EQ } ;
                         IF { PUSH bool True }
                            { SWAP ; DUP ; DUG 2 ; GET 5 ; CAR ; SENDER ; COMPARE ; EQ } ;
                         IF { PUSH bool True }
                            { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 4 ; SENDER ; COMPARE ; EQ } ;
                         IF {}
                            { PUSH string "Only oracle, manager, bidder or issuer can close the auction" ;
                              FAILWITH } ;
                         PUSH mutez 0 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 204 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string
                                   "Close auction failed, auction ended with nobody bid, need to cancel, not close." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 207 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 207 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Close auction failed, bidder still not fill the price yet." ;
                              FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %collect_auction_fee (pair nat (pair address address)) ;
                         IF_NONE { PUSH int 210 ; FAILWITH } {} ;
                         DUP 4 ;
                         CAR ;
                         GET 5 ;
                         DUP 4 ;
                         GET ;
                         IF_NONE { PUSH int 211 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         DUP 5 ;
                         CAR ;
                         GET 5 ;
                         DUP 5 ;
                         GET ;
                         IF_NONE { PUSH int 211 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         DUP 6 ;
                         CAR ;
                         GET 5 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 211 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         DUP 7 ;
                         CAR ;
                         GET 5 ;
                         DUP 7 ;
                         GET ;
                         IF_NONE { PUSH int 211 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR 3 ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %auction_transfer (pair nat address) ;
                         IF_NONE { PUSH int 214 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DUP 5 ;
                         CAR ;
                         GET 5 ;
                         DUP 5 ;
                         GET ;
                         IF_NONE { PUSH int 215 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         DUP 6 ;
                         CAR ;
                         GET 5 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 215 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         NONE (pair (pair (pair nat (pair mutez address)) (pair mutez (pair mutez timestamp)))
                                    (pair (pair address (pair string (map nat (pair mutez address))))
                                          (pair nat (pair nat mutez)))) ;
                         DIG 7 ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { SWAP ; DUP ; DUG 2 ; GET 3 ; GET 3 ; NOT } { PUSH bool False } ;
                         IF {}
                            { PUSH string
                                   "WrongCondition: (sp.sender == self.data.manager) & (~ self.data.locked)" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         PUSH bool True ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         NIL operation }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 174 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         NOW ;
                         COMPARE ;
                         LT ;
                         IF {} { PUSH string "Purchase failed, over the due time." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 176 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF {}
                            { PUSH string "Purchase failed, cannot purchase for your own auction." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 178 ; FAILWITH } {} ;
                         CAR ;
                         GET 5 ;
                         AMOUNT ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Purchase failed, Purchase price <> the amount in transaction" ;
                              FAILWITH } ;
                         PUSH mutez 0 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 180 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF { NIL operation ;
                              DUP 3 ;
                              CAR ;
                              GET 5 ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH int 181 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 181 ; FAILWITH } {} ;
                              DUP 4 ;
                              CAR ;
                              GET 5 ;
                              DUP 4 ;
                              GET ;
                              IF_NONE { PUSH int 181 ; FAILWITH } {} ;
                              CAR ;
                              GET 3 ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { NIL operation } ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %collect_auction_fee (pair nat (pair address address)) ;
                         IF_NONE { PUSH int 184 ; FAILWITH } {} ;
                         AMOUNT ;
                         DUP 5 ;
                         CAR ;
                         GET 5 ;
                         DUP 5 ;
                         GET ;
                         IF_NONE { PUSH int 185 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         DUP 7 ;
                         CAR ;
                         GET 5 ;
                         DUP 7 ;
                         GET ;
                         IF_NONE { PUSH int 185 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR 3 ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %auction_transfer (pair nat address) ;
                         IF_NONE { PUSH int 188 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         SENDER ;
                         DUP 6 ;
                         CAR ;
                         GET 5 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 189 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         NONE (pair (pair (pair nat (pair mutez address)) (pair mutez (pair mutez timestamp)))
                                    (pair (pair address (pair string (map nat (pair mutez address))))
                                          (pair nat (pair nat mutez)))) ;
                         DIG 7 ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 222 ; FAILWITH } {} ;
                         CAR ;
                         GET 6 ;
                         PUSH int 86400 ;
                         ADD ;
                         NOW ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "Fail-Close auction failed, still in the due time + 24hr." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 224 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH bool True }
                            { SWAP ; DUP ; DUG 2 ; GET 5 ; CAR ; SENDER ; COMPARE ; EQ } ;
                         IF { PUSH bool True }
                            { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 4 ; SENDER ; COMPARE ; EQ } ;
                         IF {}
                            { PUSH string "Only oracle, manager or issuer can Fail-Close the auction" ;
                              FAILWITH } ;
                         PUSH mutez 0 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 229 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string
                                   "Fail-Close auction failed, auction ended with nobody bid, need to cancel, not Fail-Close." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 232 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 232 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string
                                   "Fail-Close auction failed, bidder already fill the price. Need to close auction." ;
                              FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         GET 5 ;
                         CAR ;
                         CONTRACT unit ;
                         IF_NONE { PUSH int 238 ; FAILWITH } {} ;
                         PUSH mutez 1 ;
                         PUSH nat 100 ;
                         PUSH nat 25 ;
                         PUSH mutez 1 ;
                         DUP 8 ;
                         CAR ;
                         GET 5 ;
                         DUP 8 ;
                         GET ;
                         IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         EDIV ;
                         IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                         CAR ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 235 ; FAILWITH } { CAR } ;
                         MUL ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         CAR ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         CONTRACT unit ;
                         IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                         PUSH mutez 1 ;
                         PUSH nat 100 ;
                         PUSH nat 25 ;
                         PUSH mutez 1 ;
                         DUP 8 ;
                         CAR ;
                         GET 5 ;
                         DUP 8 ;
                         GET ;
                         IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         EDIV ;
                         IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                         CAR ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH int 235 ; FAILWITH } { CAR } ;
                         MUL ;
                         DUP 5 ;
                         CAR ;
                         GET 5 ;
                         DUP 5 ;
                         GET ;
                         IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         SUB ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIG 2 ;
                         DUP ;
                         GET 8 ;
                         SWAP ;
                         DUP ;
                         DUG 4 ;
                         CAR ;
                         GET 5 ;
                         DUP 4 ;
                         GET ;
                         IF_NONE { PUSH int 243 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         MEM ;
                         IF { DUP 3 ;
                              DUP ;
                              GET 8 ;
                              DUP ;
                              DIG 5 ;
                              CAR ;
                              GET 5 ;
                              DUP 6 ;
                              GET ;
                              IF_NONE { PUSH int 244 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 244 ; FAILWITH } {} ;
                              PUSH nat 1 ;
                              ADD ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              UPDATE 8 ;
                              DUG 2 }
                            { DUP 3 ;
                              DUP ;
                              GET 8 ;
                              PUSH (option nat) (Some 1) ;
                              DIG 5 ;
                              CAR ;
                              GET 5 ;
                              DUP 6 ;
                              GET ;
                              IF_NONE { PUSH int 246 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              GET 4 ;
                              UPDATE ;
                              UPDATE 8 ;
                              DUG 2 } ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %auction_transfer (pair nat address) ;
                         IF_NONE { PUSH int 249 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DUP 5 ;
                         CAR ;
                         GET 5 ;
                         DUP 5 ;
                         GET ;
                         IF_NONE { PUSH int 250 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         DUP 6 ;
                         CAR ;
                         GET 5 ;
                         DUP 6 ;
                         GET ;
                         IF_NONE { PUSH int 250 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         NONE (pair (pair (pair nat (pair mutez address)) (pair mutez (pair mutez timestamp)))
                                    (pair (pair address (pair string (map nat (pair mutez address))))
                                          (pair nat (pair nat mutez)))) ;
                         DIG 7 ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 162 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF {}
                            { PUSH string "Fill bid failed, cannot bid for your own auction." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 164 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 4 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Fill bid failed, only the bidder can fill the bid." ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 166 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         AMOUNT ;
                         DUP 4 ;
                         CAR ;
                         GET 5 ;
                         DUP 4 ;
                         GET ;
                         IF_NONE { PUSH int 166 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         ADD ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "Fill bid failed, transaction amount need equal to 90% of bid price" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         DUP 7 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 169 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 10 ;
                         CAR ;
                         GET 5 ;
                         DIG 10 ;
                         GET ;
                         IF_NONE { PUSH int 169 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         NIL operation } } } }
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 6 ;
                         COMPARE ;
                         GE ;
                         IF {} { PUSH string "start_price is too low" ; FAILWITH } ;
                         PUSH nat 2 ;
                         SWAP ;
                         DUP ;
                         GET 6 ;
                         SWAP ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         GET 4 ;
                         EDIV ;
                         IF_NONE { PUSH int 70 ; FAILWITH } {} ;
                         CAR ;
                         COMPARE ;
                         GE ;
                         IF {}
                            { PUSH string "direct_price should at least twice higher than start_price" ;
                              FAILWITH } ;
                         DUP ;
                         CAR ;
                         GET 3 ;
                         PUSH int 1 ;
                         SWAP ;
                         COMPARE ;
                         GE ;
                         IF { DUP ; CAR ; GET 3 ; PUSH int 14 ; SWAP ; COMPARE ; LE }
                            { PUSH bool False } ;
                         IF {}
                            { PUSH string "auction_duration should between 1 and 14 (inclusive)" ;
                              FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         MEM ;
                         IF {}
                            { PUSH string "raise_percentage should be in the raise_percentage_list" ;
                              FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CONTRACT %make_auction_transfer (pair nat address) ;
                         IF_NONE { PUSH int 76 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         SENDER ;
                         DUP 5 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DIG 6 ;
                         DUP ;
                         GET 6 ;
                         SWAP ;
                         DUP ;
                         DUG 8 ;
                         GET 5 ;
                         PAIR ;
                         PUSH nat 0 ;
                         PAIR ;
                         EMPTY_MAP nat (pair mutez address) ;
                         DUP 9 ;
                         GET 3 ;
                         PAIR ;
                         SENDER ;
                         PAIR ;
                         PAIR ;
                         NOW ;
                         PUSH int 60 ;
                         DUP ;
                         PUSH int 24 ;
                         DUP 12 ;
                         CAR ;
                         GET 3 ;
                         MUL ;
                         MUL ;
                         MUL ;
                         ADD ;
                         DUP 9 ;
                         CAR ;
                         GET 4 ;
                         PAIR ;
                         PUSH mutez 0 ;
                         PAIR ;
                         SENDER ;
                         PUSH mutez 0 ;
                         PAIR ;
                         DIG 9 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         DIG 7 ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         PUSH nat 1 ;
                         ADD ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.akaProtocol" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         NIL operation } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.akaProtocol" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.manager" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR } ;
                     NIL operation } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.manager" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         DUP 6 ;
                         CDR ;
                         SOME ;
                         DIG 6 ;
                         CAR ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH bool True }
                            { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 4 ; SENDER ; COMPARE ; EQ } ;
                         IF {}
                            { PUSH string
                                   "WrongCondition: (sp.sender == self.data.manager) | (sp.sender == self.data.auction_oracle)" ;
                              FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.manager" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         CDR ;
                         DIG 4 ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { IF_LEFT
                           { SWAP ;
                             DUP ;
                             DUG 2 ;
                             GET 5 ;
                             CAR ;
                             SENDER ;
                             COMPARE ;
                             EQ ;
                             IF {}
                                { PUSH string "WrongCondition: sp.sender == self.data.manager" ; FAILWITH } ;
                             DUP ;
                             ITER { IF_LEFT
                                      { DIG 2 ;
                                        DUP ;
                                        GET 7 ;
                                        PUSH (option unit) (Some Unit) ;
                                        DIG 3 ;
                                        UPDATE ;
                                        UPDATE 7 ;
                                        SWAP }
                                      { DIG 2 ; DUP ; GET 7 ; NONE unit ; DIG 3 ; UPDATE ; UPDATE 7 ; SWAP } } ;
                             DROP }
                           { SWAP ;
                             DUP ;
                             DUG 2 ;
                             GET 5 ;
                             CAR ;
                             SENDER ;
                             COMPARE ;
                             EQ ;
                             IF {}
                                { PUSH string "WrongCondition: sp.sender == self.data.manager" ; FAILWITH } ;
                             DUP ;
                             ITER { DUP 3 ;
                                    GET 8 ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CAR ;
                                    MEM ;
                                    IF { DUP ;
                                         CDR ;
                                         PUSH nat 0 ;
                                         COMPARE ;
                                         EQ ;
                                         IF { DIG 2 ; DUP ; GET 8 ; NONE nat ; DIG 3 ; CAR ; UPDATE ; UPDATE 8 ; SWAP }
                                            { DIG 2 ;
                                              DUP ;
                                              GET 8 ;
                                              DUP 3 ;
                                              CDR ;
                                              SOME ;
                                              DIG 3 ;
                                              CAR ;
                                              UPDATE ;
                                              UPDATE 8 ;
                                              SWAP } }
                                       { DUP ;
                                         CDR ;
                                         PUSH nat 0 ;
                                         COMPARE ;
                                         LT ;
                                         IF { DIG 2 ;
                                              DUP ;
                                              GET 8 ;
                                              DUP 3 ;
                                              CDR ;
                                              SOME ;
                                              DIG 3 ;
                                              CAR ;
                                              UPDATE ;
                                              UPDATE 8 ;
                                              SWAP }
                                            { DROP } } } ;
                             DROP } } } ;
                 NIL operation } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
