{ storage
    (pair (pair (address %collector) (pair (nat %id) (nat %limit)))
          (pair (list %previousWinners address)
                (pair (address %t_addr) (map %ticketToAddress nat address)))) ;
  parameter (nat %buyTicket) ;
  code { UNPAIR ;
         AMOUNT ;
         PUSH mutez 1000000 ;
         DUP 3 ;
         MUL ;
         COMPARE ;
         EQ ;
         IF {}
            { PUSH string "WrongCondition: sp.tez(params) == sp.amount" ; FAILWITH } ;
         PUSH mutez 0 ;
         SWAP ;
         DUP ;
         DUG 2 ;
         DIG 3 ;
         DUP ;
         CAR ;
         GET 3 ;
         SWAP ;
         DUP ;
         DUG 5 ;
         CAR ;
         GET 4 ;
         SUB ;
         ISNAT ;
         IF_NONE { PUSH int 176 ; FAILWITH } {} ;
         DUP 4 ;
         COMPARE ;
         GT ;
         IF { DROP 2 ;
              SWAP ;
              DUP ;
              CAR ;
              GET 3 ;
              SWAP ;
              DUP ;
              DUG 3 ;
              CAR ;
              GET 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 176 ; FAILWITH } {} ;
              PUSH mutez 1000000 ;
              DIG 3 ;
              DUP ;
              CAR ;
              GET 3 ;
              SWAP ;
              DUP ;
              DUG 5 ;
              CAR ;
              GET 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 176 ; FAILWITH } {} ;
              DUP 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 179 ; FAILWITH } {} ;
              MUL ;
              SWAP }
            {} ;
         DUP ;
         PUSH nat 1 ;
         ADD ;
         PUSH nat 1 ;
         DUP ;
         DUP 3 ;
         COMPARE ;
         GT ;
         LOOP { DUP 6 ;
                DUP ;
                GET 6 ;
                SENDER ;
                SOME ;
                DIG 8 ;
                CAR ;
                GET 3 ;
                UPDATE ;
                UPDATE 6 ;
                UNPAIR ;
                UNPAIR ;
                SWAP ;
                UNPAIR ;
                PUSH nat 1 ;
                ADD ;
                PAIR ;
                SWAP ;
                PAIR ;
                PAIR ;
                DUG 5 ;
                PUSH nat 1 ;
                ADD ;
                DUP ;
                DUP 3 ;
                COMPARE ;
                GT } ;
         DROP 2 ;
         PUSH mutez 0 ;
         DUP 3 ;
         COMPARE ;
         GT ;
         IF { NIL operation ;
              SENDER ;
              CONTRACT unit ;
              IF_NONE { PUSH int 187 ; FAILWITH } {} ;
              DUP 4 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS }
            { NIL operation } ;
         DUP 5 ;
         GET 5 ;
         CONTRACT %transfer (pair address (pair address nat)) ;
         IF_NONE { PUSH int 190 ; FAILWITH } {} ;
         PUSH mutez 0 ;
         PUSH nat 1000 ;
         DUP 5 ;
         MUL ;
         SENDER ;
         SELF_ADDRESS ;
         PAIR 3 ;
         TRANSFER_TOKENS ;
         CONS ;
         PUSH nat 5 ;
         DUP 6 ;
         CAR ;
         GET 3 ;
         COMPARE ;
         EQ ;
         IF { DUP 5 ;
              GET 5 ;
              CONTRACT %transfer (pair address (pair address nat)) ;
              IF_NONE { PUSH int 216 ; FAILWITH } {} ;
              PUSH mutez 0 ;
              PUSH nat 2000 ;
              DUP 8 ;
              GET 6 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-05-04T07:50:17Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 212 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 225 ; FAILWITH } {} ;
              SELF_ADDRESS ;
              PAIR 3 ;
              TRANSFER_TOKENS ;
              CONS ;
              DUP 5 ;
              CAR ;
              CAR ;
              CONTRACT unit ;
              IF_NONE { PUSH int 231 ; FAILWITH } {} ;
              PUSH mutez 5000000 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS ;
              DIG 4 ;
              DUP ;
              DUP ;
              GET 3 ;
              SWAP ;
              GET 6 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-05-04T07:50:17Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 212 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 232 ; FAILWITH } {} ;
              CONS ;
              UPDATE 3 ;
              UNPAIR ;
              UNPAIR ;
              SWAP ;
              CDR ;
              PUSH nat 0 ;
              PAIR ;
              SWAP ;
              PAIR ;
              PAIR ;
              DUP ;
              DUG 5 ;
              CAR ;
              GET 4 ;
              PUSH nat 0 ;
              DUP ;
              DUP 3 ;
              COMPARE ;
              GT ;
              LOOP { DIG 6 ;
                     DUP ;
                     GET 6 ;
                     NONE address ;
                     DUP 4 ;
                     UPDATE ;
                     UPDATE 6 ;
                     DUG 6 ;
                     PUSH nat 1 ;
                     ADD ;
                     DUP ;
                     DUP 3 ;
                     COMPARE ;
                     GT } ;
              DROP 2 ;
              SWAP ;
              DROP ;
              SWAP ;
              DROP ;
              SWAP ;
              DROP }
            { SWAP ; DROP ; SWAP ; DROP ; SWAP ; DROP } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
