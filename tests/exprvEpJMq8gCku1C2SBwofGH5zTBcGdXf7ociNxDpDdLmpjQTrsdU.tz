{ storage
    (pair (pair (address %admin) (pair (nat %all_artworks) (nat %all_auctions)))
          (pair (pair (big_map %artworks
                         nat
                         (pair (pair (nat %edition_cur) (pair (nat %edition_max) (timestamp %end_timestamp)))
                               (pair (pair (address %nft_address) (nat %price))
                                     (pair (timestamp %start_timestamp) (map %token_metadata string bytes)))))
                      (big_map %auctions
                         nat
                         (pair (pair (pair (address %bidder) (timestamp %end_timestamp))
                                     (pair (address %nft_address) (pair (nat %nft_id) (address %payer))))
                               (pair (pair (bytes %payment_data) (string %payment_method))
                                     (pair (nat %price) (pair (address %seller) (timestamp %start_timestamp)))))))
                (pair (set %operators address) (set %users address)))) ;
  parameter
    (or (or (pair %bid
               (pair (nat %auction_id) (address %bidder))
               (pair (bytes %payment_data) (pair (string %payment_method) (nat %price))))
            (or (pair %create_artwork
                   (pair (timestamp %end_timestamp) (pair (nat %max_num) (address %nft_address)))
                   (pair (nat %price)
                         (pair (timestamp %start_timestamp) (map %token_metadata string bytes))))
                (pair %create_auction
                   (pair (timestamp %end_timestamp) (pair (address %nft_address) (nat %nft_id)))
                   (pair (nat %price) (pair (address %seller) (timestamp %start_timestamp))))))
        (or (or (pair %create_user (address %account) (address %admin))
                (pair %print
                   (pair (nat %artwork_id) (address %owner))
                   (pair (bytes %payment_data) (string %payment_method))))
            (or (pair %update_operator (address %operator) (bool %valid)) (nat %withdraw)))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 6 ;
                 SENDER ;
                 MEM ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.users.contains(sp.sender)" ;
                      FAILWITH } ;
                 DUP ;
                 CAR ;
                 CDR ;
                 PUSH address "tz3jfebmewtfXYD1Xef34TwrfMg2rrrw6oum" ;
                 SWAP ;
                 COMPARE ;
                 LE ;
                 IF {} { PUSH string "AUC_INVALID_ADDRESS" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 3 ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 GET 7 ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CDR ;
                 COMPARE ;
                 NEQ ;
                 IF {} { PUSH string "AUC_SELLER_CANNOT_BID" ; FAILWITH } ;
                 PUSH nat 10 ;
                 DUP 3 ;
                 GET 3 ;
                 CDR ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 GET 5 ;
                 ADD ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 6 ;
                 COMPARE ;
                 GE ;
                 IF {} { PUSH string "AUC_BID_PRICE_TOO_LOW" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 3 ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 GET 8 ;
                 NOW ;
                 COMPARE ;
                 GE ;
                 IF {} { PUSH string "AUC_AUCTION_NOT_START" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 3 ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 CAR ;
                 CAR ;
                 CDR ;
                 NOW ;
                 COMPARE ;
                 LT ;
                 IF {} { PUSH string "AUC_AUCTION_IS_OVER" ; FAILWITH } ;
                 NIL operation ;
                 SENDER ;
                 CONTRACT %lock (pair (nat %amount) (pair (bytes %data) (string %method))) ;
                 IF_NONE { PUSH int 990 ; FAILWITH } {} ;
                 PUSH mutez 0 ;
                 DIG 3 ;
                 DUP ;
                 GET 5 ;
                 SWAP ;
                 DUP ;
                 DUG 5 ;
                 GET 3 ;
                 PAIR %data %method ;
                 DUP 5 ;
                 GET 6 ;
                 PAIR %amount ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 DUP 3 ;
                 GET 3 ;
                 CDR ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 GET 7 ;
                 DUP 4 ;
                 GET 3 ;
                 CDR ;
                 DUP 4 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 CAR ;
                 CAR ;
                 CAR ;
                 COMPARE ;
                 NEQ ;
                 IF { DUP 3 ;
                      GET 3 ;
                      CDR ;
                      DUP 3 ;
                      CAR ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                      CAR ;
                      GET 6 ;
                      CONTRACT %unlock (pair (nat %amount) (pair (bytes %data) (string %method))) ;
                      IF_NONE { PUSH int 994 ; FAILWITH } {} ;
                      PUSH mutez 0 ;
                      DUP 5 ;
                      GET 3 ;
                      CDR ;
                      DUP 5 ;
                      CAR ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                      GET 3 ;
                      CDR ;
                      DUP 6 ;
                      GET 3 ;
                      CDR ;
                      DUP 6 ;
                      CAR ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                      GET 3 ;
                      CAR ;
                      PAIR %data %method ;
                      DUP 6 ;
                      GET 3 ;
                      CDR ;
                      DUP 6 ;
                      CAR ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                      GET 5 ;
                      PAIR %amount ;
                      TRANSFER_TOKENS ;
                      CONS }
                    {} ;
                 DIG 2 ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 SWAP ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 997 ; FAILWITH } {} ;
                 UNPAIR ;
                 UNPAIR ;
                 CDR ;
                 DUP 10 ;
                 CAR ;
                 CDR ;
                 PAIR ;
                 PAIR ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 998 ; FAILWITH } {} ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 SWAP ;
                 CDR ;
                 DUP 10 ;
                 GET 6 ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 999 ; FAILWITH } {} ;
                 UNPAIR ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 SWAP ;
                 CAR ;
                 SENDER ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 1000 ; FAILWITH } {} ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 CAR ;
                 DUP 10 ;
                 GET 5 ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 DUP ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 1001 ; FAILWITH } {} ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 CDR ;
                 DUP 10 ;
                 GET 3 ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DUP ;
                 DUG 3 ;
                 UNPAIR ;
                 SWAP ;
                 UNPAIR ;
                 UNPAIR ;
                 SWAP ;
                 DIG 6 ;
                 GET 3 ;
                 CDR ;
                 DUP 7 ;
                 CAR ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 983 ; FAILWITH } {} ;
                 SOME ;
                 DIG 6 ;
                 CAR ;
                 CAR ;
                 UPDATE ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 5 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     NOW ;
                     PUSH int 60 ;
                     DUP ;
                     PUSH int 1 ;
                     MUL ;
                     MUL ;
                     ADD ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "END_DATE_TOO_SOON" ; FAILWITH } ;
                     DUP ;
                     GET 5 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     GT ;
                     IF {} { PUSH string "END_DATE_TOO_SOON" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DIG 4 ;
                     DUP ;
                     GET 6 ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     GET 5 ;
                     PAIR %start_timestamp %token_metadata ;
                     DIG 5 ;
                     DUP ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 7 ;
                     CAR ;
                     GET 4 ;
                     PAIR %nft_address %price ;
                     PAIR ;
                     DIG 5 ;
                     DUP ;
                     CAR ;
                     CAR ;
                     SWAP ;
                     CAR ;
                     GET 3 ;
                     PAIR %edition_max %end_timestamp ;
                     PUSH nat 0 ;
                     PAIR %edition_cur ;
                     PAIR ;
                     SOME ;
                     DIG 5 ;
                     CAR ;
                     GET 3 ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     PUSH nat 1 ;
                     ADD ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     NIL operation }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 5 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.operators.contains(sp.sender)" ;
                          FAILWITH } ;
                     NOW ;
                     PUSH int 60 ;
                     DUP ;
                     PUSH int 1 ;
                     MUL ;
                     MUL ;
                     ADD ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "AUC_END_DATE_TOO_SOON" ; FAILWITH } ;
                     DUP ;
                     GET 6 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "AUC_END_DATE_TOO_SOON" ; FAILWITH } ;
                     NOW ;
                     PUSH int 60 ;
                     DUP ;
                     PUSH int 168 ;
                     MUL ;
                     MUL ;
                     ADD ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     LE ;
                     IF {} { PUSH string "AUC_END_DATE_TOO_LATE" ; FAILWITH } ;
                     DUP ;
                     GET 3 ;
                     PUSH nat 100 ;
                     SWAP ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "AUC_BID_PRICE_TOO_LOW" ; FAILWITH } ;
                     DUP ;
                     CAR ;
                     GET 3 ;
                     CONTRACT %transfer
                       (list (pair (address %from_)
                                   (list %txs (pair (nat %amount) (pair (address %to_) (nat %token_id)))))) ;
                     IF_NONE { PUSH int 959 ; FAILWITH } {} ;
                     NIL operation ;
                     SWAP ;
                     PUSH mutez 0 ;
                     NIL (pair (address %from_)
                               (list %txs (pair (nat %amount) (pair (address %to_) (nat %token_id))))) ;
                     NIL (pair (nat %amount) (pair (address %to_) (nat %token_id))) ;
                     DUP 6 ;
                     CAR ;
                     GET 4 ;
                     SELF_ADDRESS ;
                     PAIR %to_ %token_id ;
                     PUSH nat 1 ;
                     PAIR %amount ;
                     CONS ;
                     DUP 6 ;
                     GET 5 ;
                     PAIR %from_ %txs ;
                     CONS ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DUP 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DIG 5 ;
                     DUP ;
                     GET 6 ;
                     SWAP ;
                     DUP ;
                     DUG 7 ;
                     GET 5 ;
                     PAIR %seller %start_timestamp ;
                     DUP 7 ;
                     GET 3 ;
                     PAIR %price ;
                     PUSH (pair (bytes %payment_data) (string %payment_method)) (Pair 0x "") ;
                     PAIR ;
                     DIG 6 ;
                     DUP ;
                     GET 5 ;
                     SWAP ;
                     DUP ;
                     DUG 8 ;
                     CAR ;
                     GET 4 ;
                     PAIR %nft_id %payer ;
                     DUP 8 ;
                     CAR ;
                     GET 3 ;
                     PAIR %nft_address ;
                     DIG 7 ;
                     DUP ;
                     CAR ;
                     CAR ;
                     SWAP ;
                     GET 5 ;
                     PAIR %bidder %end_timestamp ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     DIG 6 ;
                     CAR ;
                     GET 4 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     PUSH nat 1 ;
                     ADD ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP } } }
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     NONE address ;
                     SELF_ADDRESS ;
                     PAIR %platform %prepay_account ;
                     EMPTY_SET address ;
                     PAIR %operators ;
                     PUSH (pair (set %creditcard_charges bytes) (set %creditcard_refunds bytes))
                          (Pair {} {}) ;
                     PAIR ;
                     PUSH (pair (nat %balance) (nat %balance_locked)) (Pair 0 0) ;
                     DIG 2 ;
                     PAIR ;
                     PAIR ;
                     PUSH mutez 0 ;
                     NONE key_hash ;
                     CREATE_CONTRACT
                       { parameter
                           (or (or (or (pair %bid (pair (nat %amount) (bytes %data)) (pair (string %method) (nat %target_id)))
                                       (address %create_prepay))
                                   (or (pair %lock (nat %amount) (pair (bytes %data) (string %method)))
                                       (pair %pay (nat %amount) (pair (bytes %data) (string %method)))))
                               (or (or (pair %print (bytes %data) (pair (string %method) (nat %target_id)))
                                       (pair %unlock (nat %amount) (pair (bytes %data) (string %method))))
                                   (or (pair %update_action_operator (address %operator) (bool %valid))
                                       (or (pair %update_asset_operator
                                              (address %address)
                                              (pair (address %operator) (bool %valid)))
                                           (pair %update_balance (nat %amount) (bool %increase)))))) ;
                         storage
                           (pair (pair (pair (address %account) (address %admin))
                                       (pair (nat %balance) (nat %balance_locked)))
                                 (pair (pair (set %creditcard_charges bytes) (set %creditcard_refunds bytes))
                                       (pair (set %operators address)
                                             (pair (address %platform) (option %prepay_account address))))) ;
                         code { UNPAIR ;
                                IF_LEFT
                                  { IF_LEFT
                                      { IF_LEFT
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF { PUSH bool True } { SWAP ; DUP ; DUG 2 ; GET 5 ; SENDER ; MEM } ;
                                            IF {}
                                               { PUSH string
                                                      "WrongCondition: (sp.sender == self.data.account) | (self.data.operators.contains(sp.sender))" ;
                                                 FAILWITH } ;
                                            NIL operation ;
                                            DUP 3 ;
                                            GET 7 ;
                                            CONTRACT %bid
                                              (pair (pair (nat %auction_id) (address %bidder))
                                                    (pair (bytes %payment_data) (pair (string %payment_method) (nat %price)))) ;
                                            IF_NONE { PUSH int 676 ; FAILWITH } {} ;
                                            PUSH mutez 0 ;
                                            DIG 3 ;
                                            DUP ;
                                            CAR ;
                                            CAR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 5 ;
                                            GET 3 ;
                                            PAIR %payment_method %price ;
                                            DUP 5 ;
                                            CAR ;
                                            CDR ;
                                            PAIR %payment_data ;
                                            DUP 6 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            DIG 5 ;
                                            GET 4 ;
                                            PAIR %auction_id %bidder ;
                                            PAIR ;
                                            TRANSFER_TOKENS ;
                                            CONS }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF {}
                                               { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                            PUSH nat 0 ;
                                            PAIR %locked %reciever ;
                                            SELF_ADDRESS ;
                                            DUP 3 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR %account %admin ;
                                            PAIR ;
                                            PUSH mutez 0 ;
                                            NONE key_hash ;
                                            CREATE_CONTRACT
                                              { parameter
                                                  (or (or (nat %consume) (pair %lock (nat %amount) (bool %lock)))
                                                      (or (unit %ping) (pair %withdraw (address %address) (nat %amount)))) ;
                                                storage
                                                  (pair (pair (address %account) (address %admin))
                                                        (pair (nat %locked) (address %reciever))) ;
                                                code { UNPAIR ;
                                                       IF_LEFT
                                                         { IF_LEFT
                                                             { SWAP ;
                                                               DUP ;
                                                               DUG 2 ;
                                                               CAR ;
                                                               CDR ;
                                                               SENDER ;
                                                               COMPARE ;
                                                               EQ ;
                                                               IF {}
                                                                  { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                                               BALANCE ;
                                                               PUSH mutez 1 ;
                                                               DUP 4 ;
                                                               GET 3 ;
                                                               DUP 4 ;
                                                               ADD ;
                                                               MUL ;
                                                               COMPARE ;
                                                               LE ;
                                                               IF {}
                                                                  { PUSH string
                                                                         "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                                                    FAILWITH } ;
                                                               NIL operation ;
                                                               DUP 3 ;
                                                               GET 4 ;
                                                               CONTRACT unit ;
                                                               IF_NONE { PUSH int 554 ; FAILWITH } {} ;
                                                               PUSH mutez 1 ;
                                                               DIG 3 ;
                                                               MUL ;
                                                               UNIT ;
                                                               TRANSFER_TOKENS ;
                                                               CONS }
                                                             { SWAP ;
                                                               DUP ;
                                                               DUG 2 ;
                                                               CAR ;
                                                               CDR ;
                                                               SENDER ;
                                                               COMPARE ;
                                                               EQ ;
                                                               IF {}
                                                                  { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                                               DUP ;
                                                               CDR ;
                                                               IF { BALANCE ;
                                                                    PUSH mutez 1 ;
                                                                    DUP 4 ;
                                                                    GET 3 ;
                                                                    DUP 4 ;
                                                                    CAR ;
                                                                    ADD ;
                                                                    MUL ;
                                                                    COMPARE ;
                                                                    LE ;
                                                                    IF {}
                                                                       { PUSH string
                                                                              "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                                                         FAILWITH } ;
                                                                    SWAP ;
                                                                    UNPAIR ;
                                                                    SWAP ;
                                                                    UNPAIR ;
                                                                    DIG 3 ;
                                                                    CAR ;
                                                                    ADD ;
                                                                    PAIR ;
                                                                    SWAP ;
                                                                    PAIR }
                                                                  { SWAP ;
                                                                    DUP ;
                                                                    DUG 2 ;
                                                                    GET 3 ;
                                                                    SWAP ;
                                                                    DUP ;
                                                                    DUG 2 ;
                                                                    CAR ;
                                                                    COMPARE ;
                                                                    LE ;
                                                                    IF {}
                                                                       { PUSH string "WrongCondition: params.amount <= self.data.locked" ; FAILWITH } ;
                                                                    SWAP ;
                                                                    DUP ;
                                                                    DUG 2 ;
                                                                    UNPAIR ;
                                                                    SWAP ;
                                                                    CDR ;
                                                                    DIG 2 ;
                                                                    CAR ;
                                                                    DIG 3 ;
                                                                    GET 3 ;
                                                                    SUB ;
                                                                    ISNAT ;
                                                                    IF_NONE { PUSH int 540 ; FAILWITH } {} ;
                                                                    PAIR ;
                                                                    SWAP ;
                                                                    PAIR } ;
                                                               NIL operation } }
                                                         { IF_LEFT
                                                             { DROP ; NIL operation }
                                                             { SWAP ;
                                                               DUP ;
                                                               DUG 2 ;
                                                               CAR ;
                                                               CDR ;
                                                               SENDER ;
                                                               COMPARE ;
                                                               EQ ;
                                                               IF { PUSH bool True }
                                                                  { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; SENDER ; COMPARE ; EQ } ;
                                                               IF {}
                                                                  { PUSH string
                                                                         "WrongCondition: (sp.sender == self.data.admin) | (sp.sender == self.data.account)" ;
                                                                    FAILWITH } ;
                                                               BALANCE ;
                                                               PUSH mutez 1 ;
                                                               DUP 4 ;
                                                               GET 3 ;
                                                               DUP 4 ;
                                                               CDR ;
                                                               ADD ;
                                                               MUL ;
                                                               COMPARE ;
                                                               LE ;
                                                               IF {}
                                                                  { PUSH string
                                                                         "WrongCondition: sp.mutez(params.amount + self.data.locked) <= sp.balance" ;
                                                                    FAILWITH } ;
                                                               DUP ;
                                                               CAR ;
                                                               CONTRACT unit ;
                                                               IF_NONE { PUSH int 547 ; FAILWITH } {} ;
                                                               NIL operation ;
                                                               SWAP ;
                                                               PUSH mutez 1 ;
                                                               DIG 3 ;
                                                               CDR ;
                                                               MUL ;
                                                               UNIT ;
                                                               TRANSFER_TOKENS ;
                                                               CONS } } ;
                                                       PAIR } } ;
                                            PAIR ;
                                            DUP ;
                                            CAR ;
                                            NIL operation ;
                                            SWAP ;
                                            CONS ;
                                            DIG 2 ;
                                            UNPAIR ;
                                            SWAP ;
                                            UNPAIR ;
                                            SWAP ;
                                            UNPAIR ;
                                            SWAP ;
                                            CAR ;
                                            DIG 5 ;
                                            CDR ;
                                            SOME ;
                                            SWAP ;
                                            PAIR ;
                                            SWAP ;
                                            PAIR ;
                                            SWAP ;
                                            PAIR ;
                                            SWAP ;
                                            PAIR ;
                                            SWAP } }
                                      { IF_LEFT
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            GET 7 ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF {}
                                               { PUSH string "WrongCondition: sp.sender == self.data.platform" ; FAILWITH } ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "balance" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { SWAP ;
                                                 DUP ;
                                                 CAR ;
                                                 GET 3 ;
                                                 SWAP ;
                                                 DUP ;
                                                 DUG 3 ;
                                                 CAR ;
                                                 GET 4 ;
                                                 DUP 3 ;
                                                 CAR ;
                                                 ADD ;
                                                 COMPARE ;
                                                 LE ;
                                                 IF {}
                                                    { PUSH string
                                                           "WrongCondition: (params.amount + self.data.balance_locked) <= self.data.balance" ;
                                                      FAILWITH } ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 DUP 5 ;
                                                 CAR ;
                                                 ADD ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 PAIR ;
                                                 SWAP }
                                               {} ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "prepay" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { NIL operation ;
                                                 DUP 3 ;
                                                 GET 8 ;
                                                 IF_NONE { PUSH int 696 ; FAILWITH } {} ;
                                                 CONTRACT %lock (pair (nat %amount) (bool %lock)) ;
                                                 IF_NONE { PUSH int 696 ; FAILWITH } {} ;
                                                 PUSH mutez 0 ;
                                                 PUSH bool True ;
                                                 DIG 4 ;
                                                 DUP ;
                                                 CAR ;
                                                 SWAP ;
                                                 GET 3 ;
                                                 UNPACK nat ;
                                                 IF_NONE { PUSH int 694 ; FAILWITH } {} ;
                                                 MUL ;
                                                 PAIR %amount %lock ;
                                                 TRANSFER_TOKENS ;
                                                 CONS }
                                               { DROP ; NIL operation } }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            GET 7 ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF {}
                                               { PUSH string "WrongCondition: sp.sender == self.data.platform" ; FAILWITH } ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "balance" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { SWAP ;
                                                 DUP ;
                                                 CAR ;
                                                 GET 3 ;
                                                 SWAP ;
                                                 DUP ;
                                                 DUG 3 ;
                                                 CAR ;
                                                 GET 4 ;
                                                 DUP 3 ;
                                                 CAR ;
                                                 ADD ;
                                                 COMPARE ;
                                                 LE ;
                                                 IF {}
                                                    { PUSH string
                                                           "WrongCondition: (params.amount + self.data.balance_locked) <= self.data.balance" ;
                                                      FAILWITH } ;
                                                 SWAP ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 UNPAIR ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 CDR ;
                                                 DUP 4 ;
                                                 CAR ;
                                                 DIG 5 ;
                                                 CAR ;
                                                 GET 3 ;
                                                 SUB ;
                                                 ISNAT ;
                                                 IF_NONE { PUSH int 720 ; FAILWITH } {} ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 PAIR ;
                                                 SWAP }
                                               {} ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "creditcard" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 UNPAIR ;
                                                 PUSH bool True ;
                                                 DUP 6 ;
                                                 GET 3 ;
                                                 UPDATE ;
                                                 PAIR ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP }
                                               {} ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "prepay" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { NIL operation ;
                                                 DUP 3 ;
                                                 GET 8 ;
                                                 IF_NONE { PUSH int 696 ; FAILWITH } {} ;
                                                 CONTRACT %consume nat ;
                                                 IF_NONE { PUSH int 726 ; FAILWITH } {} ;
                                                 PUSH mutez 0 ;
                                                 DIG 3 ;
                                                 DUP ;
                                                 CAR ;
                                                 SWAP ;
                                                 GET 3 ;
                                                 UNPACK nat ;
                                                 IF_NONE { PUSH int 724 ; FAILWITH } {} ;
                                                 MUL ;
                                                 TRANSFER_TOKENS ;
                                                 CONS }
                                               { DROP ; NIL operation } } } }
                                  { IF_LEFT
                                      { IF_LEFT
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF { PUSH bool True } { SWAP ; DUP ; DUG 2 ; GET 5 ; SENDER ; MEM } ;
                                            IF {}
                                               { PUSH string
                                                      "WrongCondition: (sp.sender == self.data.account) | (self.data.operators.contains(sp.sender))" ;
                                                 FAILWITH } ;
                                            NIL operation ;
                                            DUP 3 ;
                                            GET 7 ;
                                            CONTRACT %print
                                              (pair (pair (nat %artwork_id) (address %owner))
                                                    (pair (bytes %payment_data) (string %payment_method))) ;
                                            IF_NONE { PUSH int 683 ; FAILWITH } {} ;
                                            PUSH mutez 0 ;
                                            DIG 3 ;
                                            DUP ;
                                            GET 3 ;
                                            SWAP ;
                                            DUP ;
                                            DUG 5 ;
                                            CAR ;
                                            PAIR %payment_data %payment_method ;
                                            DUP 6 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            DIG 5 ;
                                            GET 4 ;
                                            PAIR %artwork_id %owner ;
                                            PAIR ;
                                            TRANSFER_TOKENS ;
                                            CONS }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            GET 7 ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF {}
                                               { PUSH string "WrongCondition: sp.sender == self.data.platform" ; FAILWITH } ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "balance" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { SWAP ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 CAR ;
                                                 GET 4 ;
                                                 SWAP ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 CAR ;
                                                 COMPARE ;
                                                 LE ;
                                                 IF {}
                                                    { PUSH string "WrongCondition: params.amount <= self.data.balance_locked" ;
                                                      FAILWITH } ;
                                                 SWAP ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 UNPAIR ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 CAR ;
                                                 DUP 4 ;
                                                 CAR ;
                                                 DIG 5 ;
                                                 CAR ;
                                                 GET 4 ;
                                                 SUB ;
                                                 ISNAT ;
                                                 IF_NONE { PUSH int 705 ; FAILWITH } {} ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 PAIR ;
                                                 SWAP }
                                               {} ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "creditcard" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 PUSH bool True ;
                                                 DUP 6 ;
                                                 GET 3 ;
                                                 UPDATE ;
                                                 SWAP ;
                                                 PAIR ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP }
                                               {} ;
                                            DUP ;
                                            GET 4 ;
                                            PUSH string "prepay" ;
                                            COMPARE ;
                                            EQ ;
                                            IF { NIL operation ;
                                                 DUP 3 ;
                                                 GET 8 ;
                                                 IF_NONE { PUSH int 696 ; FAILWITH } {} ;
                                                 CONTRACT %lock (pair (nat %amount) (bool %lock)) ;
                                                 IF_NONE { PUSH int 711 ; FAILWITH } {} ;
                                                 PUSH mutez 0 ;
                                                 PUSH bool False ;
                                                 DIG 4 ;
                                                 DUP ;
                                                 CAR ;
                                                 SWAP ;
                                                 GET 3 ;
                                                 UNPACK nat ;
                                                 IF_NONE { PUSH int 709 ; FAILWITH } {} ;
                                                 MUL ;
                                                 PAIR %amount %lock ;
                                                 TRANSFER_TOKENS ;
                                                 CONS }
                                               { DROP ; NIL operation } } }
                                      { IF_LEFT
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            SENDER ;
                                            COMPARE ;
                                            EQ ;
                                            IF {}
                                               { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                            DUP ;
                                            CDR ;
                                            IF { SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 PUSH bool True ;
                                                 DIG 5 ;
                                                 CAR ;
                                                 UPDATE ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR }
                                               { SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 SWAP ;
                                                 UNPAIR ;
                                                 PUSH bool False ;
                                                 DIG 5 ;
                                                 CAR ;
                                                 UPDATE ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR } ;
                                            NIL operation }
                                          { IF_LEFT
                                              { SWAP ;
                                                DUP ;
                                                DUG 2 ;
                                                CAR ;
                                                CAR ;
                                                CDR ;
                                                SENDER ;
                                                COMPARE ;
                                                EQ ;
                                                IF {}
                                                   { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                                DUP ;
                                                GET 4 ;
                                                IF { DUP ;
                                                     CAR ;
                                                     CONTRACT %update_operators
                                                       (list (or (pair %add_operator (address %operator) (address %owner))
                                                                 (pair %remove_operator (address %operator) (address %owner)))) ;
                                                     IF_NONE { PUSH int 666 ; FAILWITH } {} ;
                                                     NIL operation ;
                                                     SWAP ;
                                                     PUSH mutez 0 ;
                                                     NIL (or (pair %add_operator (address %operator) (address %owner))
                                                             (pair %remove_operator (address %operator) (address %owner))) ;
                                                     SELF_ADDRESS ;
                                                     DIG 5 ;
                                                     GET 3 ;
                                                     PAIR %operator %owner ;
                                                     LEFT %add_operator %remove_operator (pair (address %operator) (address %owner)) ;
                                                     CONS ;
                                                     TRANSFER_TOKENS ;
                                                     CONS }
                                                   { DUP ;
                                                     CAR ;
                                                     CONTRACT %update_operators
                                                       (list (or (pair %add_operator (address %operator) (address %owner))
                                                                 (pair %remove_operator (address %operator) (address %owner)))) ;
                                                     IF_NONE { PUSH int 666 ; FAILWITH } {} ;
                                                     NIL operation ;
                                                     SWAP ;
                                                     PUSH mutez 0 ;
                                                     NIL (or (pair %add_operator (address %operator) (address %owner))
                                                             (pair %remove_operator (address %operator) (address %owner))) ;
                                                     SELF_ADDRESS ;
                                                     DIG 5 ;
                                                     GET 3 ;
                                                     PAIR %operator %owner ;
                                                     RIGHT %add_operator %remove_operator (pair (address %operator) (address %owner)) ;
                                                     CONS ;
                                                     TRANSFER_TOKENS ;
                                                     CONS } }
                                              { SWAP ;
                                                DUP ;
                                                DUG 2 ;
                                                CAR ;
                                                CAR ;
                                                CDR ;
                                                SENDER ;
                                                COMPARE ;
                                                EQ ;
                                                IF {}
                                                   { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                                                DUP ;
                                                CDR ;
                                                IF { SWAP ;
                                                     UNPAIR ;
                                                     UNPAIR ;
                                                     SWAP ;
                                                     UNPAIR ;
                                                     DIG 4 ;
                                                     CAR ;
                                                     ADD ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     PAIR }
                                                   { SWAP ;
                                                     DUP ;
                                                     CAR ;
                                                     GET 3 ;
                                                     SWAP ;
                                                     DUP ;
                                                     DUG 3 ;
                                                     CAR ;
                                                     GET 4 ;
                                                     DUP 3 ;
                                                     CAR ;
                                                     ADD ;
                                                     COMPARE ;
                                                     LE ;
                                                     IF {}
                                                        { PUSH string
                                                               "WrongCondition: (params.amount + self.data.balance_locked) <= self.data.balance" ;
                                                          FAILWITH } ;
                                                     SWAP ;
                                                     DUP ;
                                                     DUG 2 ;
                                                     UNPAIR ;
                                                     UNPAIR ;
                                                     SWAP ;
                                                     CDR ;
                                                     DIG 3 ;
                                                     CAR ;
                                                     DIG 4 ;
                                                     CAR ;
                                                     GET 3 ;
                                                     SUB ;
                                                     ISNAT ;
                                                     IF_NONE { PUSH int 650 ; FAILWITH } {} ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     PAIR } ;
                                                NIL operation } } } } ;
                                PAIR } } ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     NIL operation ;
                     SWAP ;
                     CONS ;
                     DIG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     PUSH bool True ;
                     DIG 6 ;
                     CDR ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 6 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { PUSH string "WrongCondition: self.data.users.contains(sp.sender)" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     CAR ;
                     GET 4 ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF {}
                        { PUSH string
                               "WrongCondition: sp.now < self.data.artworks[params.artwork_id].end_timestamp" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     GET 5 ;
                     NOW ;
                     COMPARE ;
                     GE ;
                     IF {}
                        { PUSH string
                               "WrongCondition: sp.now >= self.data.artworks[params.artwork_id].start_timestamp" ;
                          FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     CAR ;
                     GET 3 ;
                     DUP 3 ;
                     GET 3 ;
                     CAR ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     LT ;
                     IF {}
                        { PUSH string
                               "WrongCondition: self.data.artworks[params.artwork_id].edition_cur < self.data.artworks[params.artwork_id].edition_max" ;
                          FAILWITH } ;
                     NIL operation ;
                     SENDER ;
                     CONTRACT %pay (pair (nat %amount) (pair (bytes %data) (string %method))) ;
                     IF_NONE { PUSH int 933 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DIG 3 ;
                     DUP ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 5 ;
                     GET 3 ;
                     PAIR %data %method ;
                     DUP 6 ;
                     GET 3 ;
                     CAR ;
                     DUP 6 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     GET 3 ;
                     CDR ;
                     PAIR %amount ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DUP 3 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DUP 7 ;
                     CAR ;
                     CAR ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 937 ; FAILWITH } {} ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DIG 11 ;
                     GET 3 ;
                     CAR ;
                     DUP 12 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     CAR ;
                     CAR ;
                     PACK ;
                     SOME ;
                     PUSH string "edition" ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DUP ;
                     DUG 3 ;
                     GET 3 ;
                     CAR ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     GET 3 ;
                     CAR ;
                     CONTRACT %mint (pair (address %address) (map %metadata string bytes)) ;
                     IF_NONE { PUSH int 938 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     DUP 5 ;
                     GET 3 ;
                     CAR ;
                     DUP 5 ;
                     CAR ;
                     CAR ;
                     GET ;
                     IF_NONE { PUSH int 928 ; FAILWITH } {} ;
                     GET 6 ;
                     DUP 5 ;
                     CAR ;
                     CDR ;
                     PAIR %address %metadata ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DIG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     DUP ;
                     DIG 6 ;
                     CAR ;
                     CAR ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 941 ; FAILWITH } {} ;
                     UNPAIR ;
                     UNPAIR ;
                     PUSH nat 1 ;
                     ADD ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     DUP ;
                     CDR ;
                     IF { SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          PUSH bool True ;
                          DIG 5 ;
                          CAR ;
                          UPDATE ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR }
                        { SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          PUSH bool False ;
                          DIG 5 ;
                          CAR ;
                          UPDATE ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR } ;
                     NIL operation }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CDR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     CAR ;
                     CAR ;
                     CDR ;
                     NOW ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "AUC_AUCTION_IS_ONGOING" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CDR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     GET 7 ;
                     DUP 3 ;
                     GET 3 ;
                     CDR ;
                     DUP 3 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     CAR ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     NEQ ;
                     IF { NIL operation ;
                          DUP 3 ;
                          GET 3 ;
                          CDR ;
                          DUP 3 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          CAR ;
                          GET 6 ;
                          CONTRACT %unlock (pair (nat %amount) (pair (bytes %data) (string %method))) ;
                          IF_NONE { PUSH int 1015 ; FAILWITH } {} ;
                          PUSH mutez 0 ;
                          DUP 5 ;
                          GET 3 ;
                          CDR ;
                          DUP 5 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 3 ;
                          CAR ;
                          PAIR %data %method ;
                          DUP 6 ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 5 ;
                          PAIR %amount ;
                          TRANSFER_TOKENS ;
                          CONS ;
                          DUP 3 ;
                          GET 3 ;
                          CDR ;
                          DUP 3 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          CAR ;
                          GET 6 ;
                          CONTRACT %pay (pair (nat %amount) (pair (bytes %data) (string %method))) ;
                          IF_NONE { PUSH int 1017 ; FAILWITH } {} ;
                          PUSH mutez 0 ;
                          DUP 5 ;
                          GET 3 ;
                          CDR ;
                          DUP 5 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 3 ;
                          CAR ;
                          PAIR %data %method ;
                          DUP 6 ;
                          GET 3 ;
                          CDR ;
                          DUP 6 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 5 ;
                          PAIR %amount ;
                          TRANSFER_TOKENS ;
                          CONS ;
                          DUP 3 ;
                          GET 3 ;
                          CDR ;
                          DUP 3 ;
                          GET ;
                          IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                          GET 7 ;
                          CONTRACT %update_balance (pair (nat %amount) (bool %increase)) ;
                          IF_NONE
                            {}
                            { DROP ;
                              DUP 3 ;
                              GET 3 ;
                              CDR ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                              GET 7 ;
                              CONTRACT %update_balance (pair (nat %amount) (bool %increase)) ;
                              IF_NONE { PUSH int 1021 ; FAILWITH } {} ;
                              PUSH mutez 0 ;
                              PUSH bool True ;
                              DUP 6 ;
                              GET 3 ;
                              CDR ;
                              DUP 6 ;
                              GET ;
                              IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                              GET 5 ;
                              PAIR %amount %increase ;
                              TRANSFER_TOKENS ;
                              CONS } }
                        { NIL operation } ;
                     DUP 3 ;
                     GET 3 ;
                     CDR ;
                     DUP 3 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     CAR ;
                     GET 3 ;
                     CONTRACT %transfer
                       (list (pair (address %from_)
                                   (list %txs (pair (nat %amount) (pair (address %to_) (nat %token_id)))))) ;
                     IF_NONE { PUSH int 1023 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     NIL (pair (address %from_)
                               (list %txs (pair (nat %amount) (pair (address %to_) (nat %token_id))))) ;
                     NIL (pair (nat %amount) (pair (address %to_) (nat %token_id))) ;
                     DUP 7 ;
                     GET 3 ;
                     CDR ;
                     DUP 7 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     CAR ;
                     GET 5 ;
                     DUP 8 ;
                     GET 3 ;
                     CDR ;
                     DUP 8 ;
                     GET ;
                     IF_NONE { PUSH int 1010 ; FAILWITH } {} ;
                     CAR ;
                     CAR ;
                     CAR ;
                     PAIR %to_ %token_id ;
                     PUSH nat 1 ;
                     PAIR %amount ;
                     CONS ;
                     SELF_ADDRESS ;
                     PAIR %from_ %txs ;
                     CONS ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DIG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     NONE (pair (pair (pair (address %bidder) (timestamp %end_timestamp))
                                      (pair (address %nft_address) (pair (nat %nft_id) (address %payer))))
                                (pair (pair (bytes %payment_data) (string %payment_method))
                                      (pair (nat %price) (pair (address %seller) (timestamp %start_timestamp))))) ;
                     DIG 6 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
