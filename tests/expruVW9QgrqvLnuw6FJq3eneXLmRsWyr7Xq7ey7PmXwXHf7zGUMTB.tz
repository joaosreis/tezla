{ parameter (or :action (bytes %Nigiri) (bytes %Open)) ;
  storage
    (pair :storage
       (pair (pair (address %white) (option %wnigiri bytes))
             (pair (option %wnonce bytes) (option %w01 (int :zero_one))))
       (pair (pair (address %black) (option %bnigiri bytes))
             (pair (option %bnonce bytes)
                   (pair (option %b01 (int :zero_one)) (option %winner address))))) ;
  code { DUP ;
         CDR ;
         PUSH unit Unit ;
         DROP ;
         SENDER ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CAR ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CAR ;
         CAR ;
         CAR ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         COMPARE ;
         EQ ;
         IF { PUSH (int :wb) 0 }
            { DIG 2 ;
              DUP ;
              DUG 3 ;
              CDR ;
              CAR ;
              CAR ;
              DIG 2 ;
              DUP ;
              DUG 3 ;
              COMPARE ;
              EQ ;
              IF { PUSH (int :wb) 1 } { PUSH (int :wb) 2 } } ;
         PAIR ;
         DUP ;
         CAR ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         CDR ;
         PUSH (int :wb) 0 ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         COMPARE ;
         EQ ;
         IF { DUP ;
              IF_LEFT
                { DIG 5 ;
                  DUP ;
                  DUG 6 ;
                  CAR ;
                  CAR ;
                  CDR ;
                  IF_NONE
                    { DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CDR ;
                      DIG 6 ;
                      DUP ;
                      DUG 7 ;
                      CAR ;
                      CDR ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      SOME ;
                      DIG 8 ;
                      DUP ;
                      DUG 9 ;
                      CAR ;
                      CAR ;
                      CAR ;
                      PAIR ;
                      PAIR ;
                      PAIR }
                    { UNIT ; FAILWITH } ;
                  DIP { DROP } }
                { DIG 5 ;
                  DUP ;
                  DUG 6 ;
                  CAR ;
                  CDR ;
                  CAR ;
                  DIG 6 ;
                  DUP ;
                  DUG 7 ;
                  CDR ;
                  CAR ;
                  CDR ;
                  PAIR ;
                  DIG 6 ;
                  DUP ;
                  DUG 7 ;
                  CAR ;
                  CAR ;
                  CDR ;
                  PAIR ;
                  DUP ;
                  CDR ;
                  DIG 1 ;
                  DUP ;
                  DUG 2 ;
                  CAR ;
                  IF_NONE
                    { UNIT ; FAILWITH }
                    { DIG 1 ;
                      DUP ;
                      DUG 2 ;
                      CAR ;
                      IF_NONE
                        { UNIT ; FAILWITH }
                        { DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          CDR ;
                          IF_NONE
                            { DIG 9 ;
                              DUP ;
                              DUG 10 ;
                              CDR ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              PUSH bytes 0x00 ;
                              CONCAT ;
                              SHA256 ;
                              DIG 3 ;
                              DUP ;
                              DUG 4 ;
                              COMPARE ;
                              EQ ;
                              IF { PUSH (option (int :zero_one)) (Some 0) }
                                 { DIG 5 ;
                                   DUP ;
                                   DUG 6 ;
                                   PUSH bytes 0x01 ;
                                   CONCAT ;
                                   SHA256 ;
                                   DIG 3 ;
                                   DUP ;
                                   DUG 4 ;
                                   COMPARE ;
                                   EQ ;
                                   IF { PUSH (option (int :zero_one)) (Some 1) } { UNIT ; FAILWITH } } ;
                              DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              SOME ;
                              PAIR ;
                              DIG 11 ;
                              DUP ;
                              DUG 12 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              DIG 1 ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              PAIR ;
                              DUP ;
                              CAR ;
                              IF_NONE
                                { DIG 1 ; DUP ; DUG 2 }
                                { DIG 1 ;
                                  DUP ;
                                  DUG 2 ;
                                  CDR ;
                                  IF_NONE
                                    { DIG 2 ; DUP ; DUG 3 }
                                    { DUP ;
                                      DIG 2 ;
                                      DUP ;
                                      DUG 3 ;
                                      COMPARE ;
                                      EQ ;
                                      IF { DIG 3 ;
                                           DUP ;
                                           DUG 4 ;
                                           CDR ;
                                           CAR ;
                                           CAR ;
                                           SOME ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CDR ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CAR ;
                                           PAIR }
                                         { DIG 3 ;
                                           DUP ;
                                           DUG 4 ;
                                           CAR ;
                                           CAR ;
                                           CAR ;
                                           SOME ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CDR ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CDR ;
                                           CAR ;
                                           PAIR ;
                                           DIG 4 ;
                                           DUP ;
                                           DUG 5 ;
                                           CAR ;
                                           PAIR } ;
                                      DIP { DROP } } ;
                                  DIP { DROP } } ;
                              DIP { DROP 2 } }
                            { UNIT ; FAILWITH } ;
                          DIP { DROP } } ;
                      DIP { DROP } } ;
                  DIP { DROP 3 } } }
            { PUSH (int :wb) 1 ;
              DIG 2 ;
              DUP ;
              DUG 3 ;
              COMPARE ;
              EQ ;
              IF { DUP ;
                   IF_LEFT
                     { DIG 5 ;
                       DUP ;
                       DUG 6 ;
                       CDR ;
                       CAR ;
                       CDR ;
                       IF_NONE
                         { DIG 5 ;
                           DUP ;
                           DUG 6 ;
                           CDR ;
                           CDR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           SOME ;
                           DIG 7 ;
                           DUP ;
                           DUG 8 ;
                           CDR ;
                           CAR ;
                           CAR ;
                           PAIR ;
                           PAIR ;
                           DIG 6 ;
                           DUP ;
                           DUG 7 ;
                           CAR ;
                           PAIR }
                         { UNIT ; FAILWITH } ;
                       DIP { DROP } }
                     { DIG 5 ;
                       DUP ;
                       DUG 6 ;
                       CDR ;
                       CDR ;
                       CAR ;
                       DIG 6 ;
                       DUP ;
                       DUG 7 ;
                       CDR ;
                       CAR ;
                       CDR ;
                       PAIR ;
                       DIG 6 ;
                       DUP ;
                       DUG 7 ;
                       CAR ;
                       CAR ;
                       CDR ;
                       PAIR ;
                       DUP ;
                       CDR ;
                       DIG 1 ;
                       DUP ;
                       DUG 2 ;
                       CAR ;
                       IF_NONE
                         { UNIT ; FAILWITH }
                         { DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CAR ;
                           IF_NONE
                             { UNIT ; FAILWITH }
                             { DIG 2 ;
                               DUP ;
                               DUG 3 ;
                               CDR ;
                               IF_NONE
                                 { DIG 9 ;
                                   DUP ;
                                   DUG 10 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   DIG 5 ;
                                   DUP ;
                                   DUG 6 ;
                                   PUSH bytes 0x00 ;
                                   CONCAT ;
                                   SHA256 ;
                                   DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   COMPARE ;
                                   EQ ;
                                   IF { PUSH (option (int :zero_one)) (Some 0) }
                                      { DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        PUSH bytes 0x01 ;
                                        CONCAT ;
                                        SHA256 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        COMPARE ;
                                        EQ ;
                                        IF { PUSH (option (int :zero_one)) (Some 1) } { UNIT ; FAILWITH } } ;
                                   PAIR ;
                                   DIG 10 ;
                                   DUP ;
                                   DUG 11 ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   PAIR ;
                                   DIG 10 ;
                                   DUP ;
                                   DUG 11 ;
                                   CDR ;
                                   CAR ;
                                   PAIR ;
                                   DIG 10 ;
                                   DUP ;
                                   DUG 11 ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   SOME ;
                                   PAIR ;
                                   DIG 11 ;
                                   DUP ;
                                   DUG 12 ;
                                   CAR ;
                                   CAR ;
                                   PAIR ;
                                   PAIR ;
                                   DUP ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   DIG 1 ;
                                   DUP ;
                                   DUG 2 ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   PAIR ;
                                   DUP ;
                                   CAR ;
                                   IF_NONE
                                     { DIG 1 ; DUP ; DUG 2 }
                                     { DIG 1 ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       IF_NONE
                                         { DIG 2 ; DUP ; DUG 3 }
                                         { DUP ;
                                           DIG 2 ;
                                           DUP ;
                                           DUG 3 ;
                                           COMPARE ;
                                           EQ ;
                                           IF { DIG 3 ;
                                                DUP ;
                                                DUG 4 ;
                                                CDR ;
                                                CAR ;
                                                CAR ;
                                                SOME ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CDR ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CAR ;
                                                PAIR }
                                              { DIG 3 ;
                                                DUP ;
                                                DUG 4 ;
                                                CAR ;
                                                CAR ;
                                                CAR ;
                                                SOME ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CDR ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CDR ;
                                                CAR ;
                                                PAIR ;
                                                DIG 4 ;
                                                DUP ;
                                                DUG 5 ;
                                                CAR ;
                                                PAIR } ;
                                           DIP { DROP } } ;
                                       DIP { DROP } } ;
                                   DIP { DROP 2 } }
                                 { UNIT ; FAILWITH } ;
                               DIP { DROP } } ;
                           DIP { DROP } } ;
                       DIP { DROP 3 } } }
                 { UNIT ; FAILWITH } } ;
         NIL operation ;
         PAIR ;
         DIP { DROP 6 } } }
