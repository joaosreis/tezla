{ parameter
    (or (unit %confirm) (or (pair %submit (address %ckey) (int %pscore)) (unit %decide))) ;
  storage
    (pair (address %organizer)
          (pair (timestamp %startdate)
                (pair (timestamp %deadline)
                      (pair (mutez %prize)
                            (pair (address %oracle)
                                  (pair (nat %_state)
                                        (map %submission address (pair (int %score) (timestamp %timestamp))))))))) ;
  code { NIL operation ;
         DIG 1 ;
         UNPAIR ;
         DIP 1
             { UNPAIR ;
               SWAP ;
               UNPAIR ;
               SWAP ;
               UNPAIR ;
               SWAP ;
               UNPAIR ;
               SWAP ;
               UNPAIR ;
               SWAP ;
               UNPAIR ;
               SWAP } ;
         IF_LEFT
           { DROP 1 ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             DUP ;
             PUSH nat 0 ;
             COMPARE ;
             EQ ;
             IF { DIG 6 ;
                  DUP ;
                  DUG 7 ;
                  NOW ;
                  COMPARE ;
                  GT ;
                  IF { PUSH nat 1 ; DIP 1 { DIG 2 ; DROP 1 } ; DUG 2 } {} }
                { PUSH string "InvalidState" ; FAILWITH } ;
             DROP 1 ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             DIG 1 ;
             PAIR }
           { IF_LEFT
               { UNPAIR ;
                 SWAP ;
                 PUSH nat 1 ;
                 DIG 4 ;
                 DUP ;
                 DUG 5 ;
                 COMPARE ;
                 EQ ;
                 NOT ;
                 IF { PUSH string "InvalidCondition: c1" ; FAILWITH } {} ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 MEM ;
                 IF { PUSH string "KeyAlreadyExists" ; FAILWITH }
                    { DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      NOW ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      PAIR ;
                      SOME ;
                      DIG 3 ;
                      DUP ;
                      DUG 4 ;
                      UPDATE ;
                      DIP 1 { DIG 2 ; DROP 1 } ;
                      DUG 2 } ;
                 DROP 2 ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DIG 1 ;
                 PAIR }
               { DROP 1 ;
                 DIG 4 ;
                 DUP ;
                 DUG 5 ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 NOT ;
                 IF { PUSH string "InvalidCondition: c2" ; FAILWITH } {} ;
                 DIG 1 ;
                 DUP ;
                 DUG 2 ;
                 DUP ;
                 PUSH nat 1 ;
                 COMPARE ;
                 EQ ;
                 IF { NIL address ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      ITER { UNPAIR ;
                             NIL address ;
                             DIG 1 ;
                             DUP ;
                             DUG 2 ;
                             SOME ;
                             PAIR ;
                             DIG 3 ;
                             DUP ;
                             DUG 4 ;
                             ITER { DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    CAR ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    CDR ;
                                    DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    IF_NONE
                                      { DUP ; DIG 3 ; DUP ; DUG 4 ; CONS ; DIG 2 ; DUP ; DUG 3 ; PAIR }
                                      { PUSH int 0 ;
                                        DIG 10 ;
                                        DUP ;
                                        DUG 11 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        GET ;
                                        IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                                        DIG 8 ;
                                        DUP ;
                                        DUG 9 ;
                                        CAR ;
                                        DIG 1 ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        COMPARE ;
                                        LT ;
                                        IF { PUSH int 1 }
                                           { DIG 8 ;
                                             DUP ;
                                             DUG 9 ;
                                             CDR ;
                                             DIG 1 ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             COMPARE ;
                                             GT ;
                                             IF { PUSH int 1 } { PUSH int 0 } } ;
                                        DIP 1 { DROP 1 } ;
                                        COMPARE ;
                                        GT ;
                                        IF { DIG 1 ;
                                             DUP ;
                                             DUG 2 ;
                                             DIG 6 ;
                                             DUP ;
                                             DUG 7 ;
                                             CONS ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CONS ;
                                             NONE address ;
                                             PAIR }
                                           { DIG 1 ;
                                             DUP ;
                                             DUG 2 ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CONS ;
                                             DIG 3 ;
                                             DUP ;
                                             DUG 4 ;
                                             PAIR } ;
                                        SWAP ;
                                        DROP 1 } ;
                                    DIP 1 { DROP 1 } ;
                                    DIP 1 { DROP 1 } ;
                                    DIP 1 { DIG 1 ; DROP 1 } ;
                                    DUG 1 ;
                                    DROP 1 } ;
                             DUP ;
                             CAR ;
                             DIG 1 ;
                             DUP ;
                             DUG 2 ;
                             CDR ;
                             NIL address ;
                             DIG 2 ;
                             DUP ;
                             DUG 3 ;
                             IF_NONE
                               { DIG 1 ; DUP ; DUG 2 }
                               { DIG 2 ; DUP ; DUG 3 ; DIG 6 ; DUP ; DUG 7 ; CONS ; SWAP ; DROP 1 } ;
                             ITER { DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    CONS ;
                                    DIP 1 { DIG 1 ; DROP 1 } ;
                                    DUG 1 ;
                                    DROP 1 } ;
                             DIP 1 { DROP 1 } ;
                             DIP 1 { DROP 1 } ;
                             DIP 1 { DROP 1 } ;
                             DIP 1 { DIG 2 ; DROP 1 } ;
                             DUG 2 ;
                             DROP 2 } ;
                      PUSH nat 3 ;
                      DIG 1 ;
                      DUP ;
                      DUG 2 ;
                      SIZE ;
                      COMPARE ;
                      GE ;
                      IF { NONE address ;
                           PUSH nat 0 ;
                           PAIR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           ITER { PUSH nat 0 ;
                                  DIG 2 ;
                                  DUP ;
                                  DUG 3 ;
                                  CAR ;
                                  COMPARE ;
                                  EQ ;
                                  IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                     { DIG 1 ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       PUSH nat 1 ;
                                       DIG 3 ;
                                       DUP ;
                                       DUG 4 ;
                                       CAR ;
                                       ADD ;
                                       PAIR } ;
                                  DIP 1 { DIG 1 ; DROP 1 } ;
                                  DUG 1 ;
                                  DROP 1 } ;
                           CDR ;
                           IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                           NONE address ;
                           PUSH nat 0 ;
                           PAIR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           ITER { PUSH nat 1 ;
                                  DIG 2 ;
                                  DUP ;
                                  DUG 3 ;
                                  CAR ;
                                  COMPARE ;
                                  EQ ;
                                  IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                     { DIG 1 ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       PUSH nat 1 ;
                                       DIG 3 ;
                                       DUP ;
                                       DUG 4 ;
                                       CAR ;
                                       ADD ;
                                       PAIR } ;
                                  DIP 1 { DIG 1 ; DROP 1 } ;
                                  DUG 1 ;
                                  DROP 1 } ;
                           CDR ;
                           IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                           NONE address ;
                           PUSH nat 0 ;
                           PAIR ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           ITER { PUSH nat 2 ;
                                  DIG 2 ;
                                  DUP ;
                                  DUG 3 ;
                                  CAR ;
                                  COMPARE ;
                                  EQ ;
                                  IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                     { DIG 1 ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       PUSH nat 1 ;
                                       DIG 3 ;
                                       DUP ;
                                       DUG 4 ;
                                       CAR ;
                                       ADD ;
                                       PAIR } ;
                                  DIP 1 { DIG 1 ; DROP 1 } ;
                                  DUG 1 ;
                                  DROP 1 } ;
                           CDR ;
                           IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                           DIG 8 ;
                           DUP ;
                           DUG 9 ;
                           PUSH nat 2 ;
                           PUSH int 1 ;
                           PAIR ;
                           PAIR ;
                           UNPAIR ;
                           UNPAIR ;
                           ABS ;
                           DIG 2 ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                           CAR ;
                           DIG 9 ;
                           DUP ;
                           DUG 10 ;
                           PUSH nat 10 ;
                           PUSH int 3 ;
                           PAIR ;
                           PAIR ;
                           UNPAIR ;
                           UNPAIR ;
                           ABS ;
                           DIG 2 ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                           CAR ;
                           DIG 10 ;
                           DUP ;
                           DUG 11 ;
                           PUSH nat 5 ;
                           PUSH int 1 ;
                           PAIR ;
                           PAIR ;
                           UNPAIR ;
                           UNPAIR ;
                           ABS ;
                           DIG 2 ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                           CAR ;
                           DIG 15 ;
                           DUP ;
                           DUG 16 ;
                           DIG 6 ;
                           DUP ;
                           DUG 7 ;
                           CONTRACT unit ;
                           IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           DIP 1 { DIG 15 ; DROP 1 } ;
                           DUG 15 ;
                           DIG 15 ;
                           DUP ;
                           DUG 16 ;
                           DIG 5 ;
                           DUP ;
                           DUG 6 ;
                           CONTRACT unit ;
                           IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           DIP 1 { DIG 15 ; DROP 1 } ;
                           DUG 15 ;
                           DIG 15 ;
                           DUP ;
                           DUG 16 ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           CONTRACT unit ;
                           IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           DIP 1 { DIG 15 ; DROP 1 } ;
                           DUG 15 ;
                           DIG 15 ;
                           DUP ;
                           DUG 16 ;
                           DIG 15 ;
                           DUP ;
                           DUG 16 ;
                           CONTRACT unit ;
                           IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           DIG 6 ;
                           DUP ;
                           DUG 7 ;
                           DIG 16 ;
                           DUP ;
                           DUG 17 ;
                           SUB ;
                           SUB ;
                           SUB ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           DIP 1 { DIG 15 ; DROP 1 } ;
                           DUG 15 ;
                           DROP 6 }
                         { PUSH nat 2 ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           SIZE ;
                           COMPARE ;
                           GE ;
                           IF { NONE address ;
                                PUSH nat 0 ;
                                PAIR ;
                                DIG 1 ;
                                DUP ;
                                DUG 2 ;
                                ITER { PUSH nat 0 ;
                                       DIG 2 ;
                                       DUP ;
                                       DUG 3 ;
                                       CAR ;
                                       COMPARE ;
                                       EQ ;
                                       IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                          { DIG 1 ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            PUSH nat 1 ;
                                            DIG 3 ;
                                            DUP ;
                                            DUG 4 ;
                                            CAR ;
                                            ADD ;
                                            PAIR } ;
                                       DIP 1 { DIG 1 ; DROP 1 } ;
                                       DUG 1 ;
                                       DROP 1 } ;
                                CDR ;
                                IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                                NONE address ;
                                PUSH nat 0 ;
                                PAIR ;
                                DIG 2 ;
                                DUP ;
                                DUG 3 ;
                                ITER { PUSH nat 1 ;
                                       DIG 2 ;
                                       DUP ;
                                       DUG 3 ;
                                       CAR ;
                                       COMPARE ;
                                       EQ ;
                                       IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                          { DIG 1 ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            PUSH nat 1 ;
                                            DIG 3 ;
                                            DUP ;
                                            DUG 4 ;
                                            CAR ;
                                            ADD ;
                                            PAIR } ;
                                       DIP 1 { DIG 1 ; DROP 1 } ;
                                       DUG 1 ;
                                       DROP 1 } ;
                                CDR ;
                                IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                                DIG 7 ;
                                DUP ;
                                DUG 8 ;
                                PUSH nat 5 ;
                                PUSH int 3 ;
                                PAIR ;
                                PAIR ;
                                UNPAIR ;
                                UNPAIR ;
                                ABS ;
                                DIG 2 ;
                                MUL ;
                                EDIV ;
                                IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                                CAR ;
                                DIG 8 ;
                                DUP ;
                                DUG 9 ;
                                PUSH nat 5 ;
                                PUSH int 2 ;
                                PAIR ;
                                PAIR ;
                                UNPAIR ;
                                UNPAIR ;
                                ABS ;
                                DIG 2 ;
                                MUL ;
                                EDIV ;
                                IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                                CAR ;
                                DIG 13 ;
                                DUP ;
                                DUG 14 ;
                                DIG 4 ;
                                DUP ;
                                DUG 5 ;
                                CONTRACT unit ;
                                IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                                DIG 3 ;
                                DUP ;
                                DUG 4 ;
                                UNIT ;
                                TRANSFER_TOKENS ;
                                CONS ;
                                DIP 1 { DIG 13 ; DROP 1 } ;
                                DUG 13 ;
                                DIG 13 ;
                                DUP ;
                                DUG 14 ;
                                DIG 3 ;
                                DUP ;
                                DUG 4 ;
                                CONTRACT unit ;
                                IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                                DIG 2 ;
                                DUP ;
                                DUG 3 ;
                                UNIT ;
                                TRANSFER_TOKENS ;
                                CONS ;
                                DIP 1 { DIG 13 ; DROP 1 } ;
                                DUG 13 ;
                                DIG 13 ;
                                DUP ;
                                DUG 14 ;
                                DIG 13 ;
                                DUP ;
                                DUG 14 ;
                                CONTRACT unit ;
                                IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                                DIG 2 ;
                                DUP ;
                                DUG 3 ;
                                DIG 4 ;
                                DUP ;
                                DUG 5 ;
                                DIG 13 ;
                                DUP ;
                                DUG 14 ;
                                SUB ;
                                SUB ;
                                UNIT ;
                                TRANSFER_TOKENS ;
                                CONS ;
                                DIP 1 { DIG 13 ; DROP 1 } ;
                                DUG 13 ;
                                DROP 4 }
                              { PUSH nat 1 ;
                                DIG 1 ;
                                DUP ;
                                DUG 2 ;
                                SIZE ;
                                COMPARE ;
                                GE ;
                                IF { NONE address ;
                                     PUSH nat 0 ;
                                     PAIR ;
                                     DIG 1 ;
                                     DUP ;
                                     DUG 2 ;
                                     ITER { PUSH nat 0 ;
                                            DIG 2 ;
                                            DUP ;
                                            DUG 3 ;
                                            CAR ;
                                            COMPARE ;
                                            EQ ;
                                            IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                               { DIG 1 ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 CDR ;
                                                 PUSH nat 1 ;
                                                 DIG 3 ;
                                                 DUP ;
                                                 DUG 4 ;
                                                 CAR ;
                                                 ADD ;
                                                 PAIR } ;
                                            DIP 1 { DIG 1 ; DROP 1 } ;
                                            DUG 1 ;
                                            DROP 1 } ;
                                     CDR ;
                                     IF_NONE { PUSH string "NoneValue" ; FAILWITH } {} ;
                                     DIG 10 ;
                                     DUP ;
                                     DUG 11 ;
                                     DIG 1 ;
                                     DUP ;
                                     DUG 2 ;
                                     CONTRACT unit ;
                                     IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                                     DIG 8 ;
                                     DUP ;
                                     DUG 9 ;
                                     UNIT ;
                                     TRANSFER_TOKENS ;
                                     CONS ;
                                     DIP 1 { DIG 10 ; DROP 1 } ;
                                     DUG 10 ;
                                     DROP 1 }
                                   { DIG 9 ;
                                     DUP ;
                                     DUG 10 ;
                                     DIG 9 ;
                                     DUP ;
                                     DUG 10 ;
                                     CONTRACT unit ;
                                     IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                                     DIG 7 ;
                                     DUP ;
                                     DUG 8 ;
                                     UNIT ;
                                     TRANSFER_TOKENS ;
                                     CONS ;
                                     DIP 1 { DIG 9 ; DROP 1 } ;
                                     DUG 9 } } } ;
                      DROP 1 ;
                      PUSH nat 2 ;
                      DIP 1 { DIG 2 ; DROP 1 } ;
                      DUG 2 }
                    { PUSH string "InvalidState" ; FAILWITH } ;
                 DROP 1 ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DIG 1 ;
                 PAIR } } } }
