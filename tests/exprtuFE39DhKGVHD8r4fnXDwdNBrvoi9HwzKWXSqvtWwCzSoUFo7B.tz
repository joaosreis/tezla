{ storage
    (pair (address %addr_xpa)
          (pair (address %admin)
                (pair (map %token
                         string
                         (pair (address %addr)
                               (pair (string %name)
                                     (pair (string %iconurl) (pair (nat %poolvalue) (pair (nat %totalqty) (nat %totallqt)))))))
                      (map %liquidity (pair string address) nat)))) ;
  parameter
    (or (pair %registertoken (string %i) (pair (address %a) (pair (string %n) (string %u))))
        (or (string %deletetoken)
            (or (pair %exchange (string %tA) (pair (nat %aA) (pair (string %tB) (nat %aB))))
                (or (pair %addLiquidity (string %tL) (nat %qL))
                    (pair %removeLiquidity (nat %qL) (string %tA)))))) ;
  code { LAMBDA
           (pair (pair (pair int nat) (pair int nat)) (or unit (or (or unit unit) (or unit unit))))
           bool
           { UNPAIR ;
             UNPAIR ;
             DIP { UNPAIR } ;
             UNPAIR ;
             DUG 3 ;
             MUL ;
             DIP { MUL } ;
             SWAP ;
             COMPARE ;
             SWAP ;
             IF_LEFT
               { DROP ; EQ }
               { IF_LEFT
                   { IF_LEFT { DROP ; LT } { DROP ; LE } }
                   { IF_LEFT { DROP ; GT } { DROP ; GE } } } } ;
         LAMBDA
           (pair (pair int nat) (pair nat (pair nat nat)))
           (pair int nat)
           { UNPAIR ;
             SWAP ;
             UNPAIR ;
             SWAP ;
             UNPAIR ;
             SWAP ;
             PUSH unit Unit ;
             UNIT ;
             LEFT unit ;
             PUSH nat 1 ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             INT ;
             PAIR ;
             PUSH nat 1000 ;
             PUSH int 997 ;
             PAIR ;
             PAIR ;
             UNPAIR ;
             DIP { UNPAIR } ;
             UNPAIR ;
             DIP { SWAP } ;
             MUL ;
             DIP { MUL } ;
             PAIR ;
             PUSH nat 1 ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             INT ;
             PAIR ;
             PAIR ;
             PAIR ;
             UNPAIR ;
             UNPAIR ;
             DIP { UNPAIR ; SWAP ; DUP } ;
             UNPAIR ;
             SWAP ;
             DUP ;
             DIG 3 ;
             MUL ;
             DUG 4 ;
             DIG 3 ;
             MUL ;
             DIP { MUL } ;
             DIG 3 ;
             IF_LEFT { DROP ; ADD } { DROP ; SWAP ; SUB } ;
             PAIR ;
             PUSH nat 1 ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             INT ;
             PAIR ;
             PUSH nat 1000 ;
             PUSH int 997 ;
             PAIR ;
             PUSH nat 1 ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             INT ;
             PAIR ;
             PAIR ;
             UNPAIR ;
             DIP { UNPAIR } ;
             UNPAIR ;
             DIP { SWAP } ;
             MUL ;
             DIP { MUL } ;
             PAIR ;
             PAIR ;
             UNPAIR ;
             DIP { UNPAIR } ;
             UNPAIR ;
             DIP { SWAP } ;
             MUL ;
             DIP { MUL } ;
             PAIR ;
             PAIR ;
             UNPAIR ;
             DIP { UNPAIR } ;
             UNPAIR ;
             DIG 3 ;
             PUSH int 0 ;
             DIG 4 ;
             DUP ;
             DUG 5 ;
             COMPARE ;
             GE ;
             IF { INT } { NEG } ;
             MUL ;
             DIP { MUL ; ABS } ;
             PAIR ;
             SWAP ;
             DROP ;
             DUG 4 ;
             DROP 4 } ;
         NIL operation ;
         DIG 3 ;
         UNPAIR ;
         DIP { UNPAIR ; SWAP ; UNPAIR ; SWAP ; UNPAIR ; SWAP } ;
         IF_LEFT
           { UNPAIR ;
             SWAP ;
             UNPAIR ;
             SWAP ;
             UNPAIR ;
             SWAP ;
             DIG 6 ;
             DUP ;
             DUG 7 ;
             SENDER ;
             COMPARE ;
             EQ ;
             NOT ;
             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             PUSH nat 0 ;
             PUSH nat 0 ;
             PAIR ;
             PUSH nat 0 ;
             PAIR ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             PAIR ;
             DIG 3 ;
             DUP ;
             DUG 4 ;
             PAIR ;
             DIG 4 ;
             DUP ;
             DUG 5 ;
             PAIR ;
             SOME ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             UPDATE ;
             DIP { DIG 5 ; DROP } ;
             DUG 5 ;
             DROP 4 ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             DIG 1 ;
             PAIR }
           { IF_LEFT
               { DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 NOT ;
                 IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 NONE (pair address (pair string (pair string (pair nat (pair nat nat))))) ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 UPDATE ;
                 DIP { DIG 2 ; DROP } ;
                 DUG 2 ;
                 DROP ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DIG 1 ;
                 PAIR }
               { IF_LEFT
                   { UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     COMPARE ;
                     NEQ ;
                     NOT ;
                     IF { PUSH string "SRC_EQ_DST" ; FAILWITH } {} ;
                     PUSH string "XTZ" ;
                     DIG 4 ;
                     DUP ;
                     DUG 5 ;
                     COMPARE ;
                     EQ ;
                     IF { DIG 5 ;
                          DUP ;
                          DUG 6 ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          GET ;
                          IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CAR ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          GET ;
                          IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CAR ;
                          DIG 11 ;
                          DUP ;
                          DUG 12 ;
                          DIG 1 ;
                          DUP ;
                          DUG 2 ;
                          DIG 3 ;
                          DUP ;
                          DUG 4 ;
                          PAIR ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          PAIR ;
                          PUSH nat 1000 ;
                          PUSH int 997 ;
                          PAIR ;
                          PAIR ;
                          EXEC ;
                          DIG 13 ;
                          DUP ;
                          DUG 14 ;
                          UNIT ;
                          LEFT unit ;
                          RIGHT (or unit unit) ;
                          RIGHT unit ;
                          PUSH nat 1 ;
                          PUSH nat 1 ;
                          INT ;
                          PAIR ;
                          UNIT ;
                          RIGHT unit ;
                          PUSH nat 1 ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          INT ;
                          PAIR ;
                          DIG 5 ;
                          DUP ;
                          DUG 6 ;
                          PAIR ;
                          PAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          DIP { UNPAIR ; SWAP ; DUP } ;
                          UNPAIR ;
                          SWAP ;
                          DUP ;
                          DIG 3 ;
                          MUL ;
                          DUG 4 ;
                          DIG 3 ;
                          MUL ;
                          DIP { MUL } ;
                          DIG 3 ;
                          IF_LEFT { DROP ; ADD } { DROP ; SWAP ; SUB } ;
                          PAIR ;
                          UNPAIR ;
                          ABS ;
                          INT ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          EXEC ;
                          IF { DUP ; PUSH string "INVALID_B_AMOUNT" ; PAIR ; FAILWITH } {} ;
                          PUSH mutez 1 ;
                          AMOUNT ;
                          EDIV ;
                          IF_NONE { PUSH string "DivByZero" ; FAILWITH } { DUP ; CAR ; SWAP ; DROP } ;
                          DUP ;
                          DIG 7 ;
                          DUP ;
                          DUG 8 ;
                          COMPARE ;
                          NEQ ;
                          IF { DUP ; PUSH string "INVALID_A_AMOUNT" ; PAIR ; FAILWITH } {} ;
                          DIG 9 ;
                          DUP ;
                          DUG 10 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          GET ;
                          IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                          CAR ;
                          CONTRACT %transfer (pair address (pair address nat)) ;
                          IF_NONE
                            { PUSH string "INVALID_B_ENTRY" ; FAILWITH }
                            { DIG 13 ;
                              DUP ;
                              DUG 14 ;
                              DIG 1 ;
                              DUP ;
                              DUG 2 ;
                              PUSH mutez 0 ;
                              DIG 8 ;
                              DUP ;
                              DUG 9 ;
                              SENDER ;
                              PAIR ;
                              SELF ;
                              ADDRESS ;
                              PAIR ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIP { DIG 13 ; DROP } ;
                              DUG 13 ;
                              DROP } ;
                          DIG 9 ;
                          DUP ;
                          DUG 10 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          GET ;
                          IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                          DIG 10 ;
                          DUP ;
                          DUG 11 ;
                          DIG 11 ;
                          DUP ;
                          DUG 12 ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          GET ;
                          IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          DROP ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          DIG 6 ;
                          DUP ;
                          DUG 7 ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CAR ;
                          ADD ;
                          SWAP ;
                          UNPAIR ;
                          DROP ;
                          PUSH int 0 ;
                          DIG 12 ;
                          DUP ;
                          DUG 13 ;
                          INT ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CAR ;
                          SUB ;
                          COMPARE ;
                          GE ;
                          IF { DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               INT ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               SUB ;
                               ABS }
                             { PUSH string "AssignNat" ; FAILWITH } ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SOME ;
                          DIG 8 ;
                          DUP ;
                          DUG 9 ;
                          UPDATE ;
                          DIP { DIG 10 ; DROP } ;
                          DUG 10 ;
                          DROP 5 }
                        { PUSH string "XTZ" ;
                          DIG 2 ;
                          DUP ;
                          DUG 3 ;
                          COMPARE ;
                          EQ ;
                          IF { DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               DIG 4 ;
                               DUP ;
                               DUG 5 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               DIG 3 ;
                               DUP ;
                               DUG 4 ;
                               PAIR ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               PAIR ;
                               PUSH nat 1000 ;
                               PUSH int 997 ;
                               PAIR ;
                               PAIR ;
                               EXEC ;
                               DIG 13 ;
                               DUP ;
                               DUG 14 ;
                               UNIT ;
                               LEFT unit ;
                               RIGHT (or unit unit) ;
                               RIGHT unit ;
                               PUSH nat 1 ;
                               PUSH nat 1 ;
                               INT ;
                               PAIR ;
                               UNIT ;
                               RIGHT unit ;
                               PUSH nat 1 ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               INT ;
                               PAIR ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               PAIR ;
                               PAIR ;
                               UNPAIR ;
                               UNPAIR ;
                               DIP { UNPAIR ; SWAP ; DUP } ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DIG 3 ;
                               MUL ;
                               DUG 4 ;
                               DIG 3 ;
                               MUL ;
                               DIP { MUL } ;
                               DIG 3 ;
                               IF_LEFT { DROP ; ADD } { DROP ; SWAP ; SUB } ;
                               PAIR ;
                               UNPAIR ;
                               ABS ;
                               INT ;
                               PAIR ;
                               PAIR ;
                               PAIR ;
                               EXEC ;
                               IF { DUP ; PUSH string "INVALID_B_AMOUNT" ; PAIR ; FAILWITH } {} ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CAR ;
                               CONTRACT %transfer (pair address (pair address nat)) ;
                               IF_NONE
                                 { PUSH string "INVALID_A_ENTRY" ; FAILWITH }
                                 { DIG 12 ;
                                   DUP ;
                                   DUG 13 ;
                                   DIG 1 ;
                                   DUP ;
                                   DUG 2 ;
                                   PUSH mutez 0 ;
                                   DIG 9 ;
                                   DUP ;
                                   DUG 10 ;
                                   SELF ;
                                   ADDRESS ;
                                   PAIR ;
                                   SENDER ;
                                   PAIR ;
                                   TRANSFER_TOKENS ;
                                   CONS ;
                                   DIP { DIG 12 ; DROP } ;
                                   DUG 12 ;
                                   DROP } ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               SENDER ;
                               CONTRACT unit ;
                               IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                               PUSH mutez 1 ;
                               PUSH nat 1 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               INT ;
                               PAIR ;
                               PAIR ;
                               UNPAIR ;
                               UNPAIR ;
                               ABS ;
                               DIG 2 ;
                               MUL ;
                               EDIV ;
                               IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                               CAR ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               CONS ;
                               DIP { DIG 11 ; DROP } ;
                               DUG 11 ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               DIG 9 ;
                               DUP ;
                               DUG 10 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               DIG 9 ;
                               DUP ;
                               DUG 10 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               PUSH int 0 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               INT ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               SUB ;
                               COMPARE ;
                               GE ;
                               IF { DIG 9 ;
                                    DUP ;
                                    DUG 10 ;
                                    INT ;
                                    DIG 6 ;
                                    DUP ;
                                    DUG 7 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    SUB ;
                                    ABS }
                                  { PUSH string "AssignNat" ; FAILWITH } ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               DIG 12 ;
                               DUP ;
                               DUG 13 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               ADD ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SOME ;
                               DIG 9 ;
                               DUP ;
                               DUG 10 ;
                               UPDATE ;
                               DIP { DIG 9 ; DROP } ;
                               DUG 9 ;
                               DROP 4 }
                             { DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               DIG 4 ;
                               DUP ;
                               DUG 5 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               DIG 3 ;
                               DUP ;
                               DUG 4 ;
                               PAIR ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               PAIR ;
                               PUSH nat 1000 ;
                               PUSH int 997 ;
                               PAIR ;
                               PAIR ;
                               EXEC ;
                               UNPAIR ;
                               EDIV ;
                               IF_NONE { PUSH string "DivByZero" ; FAILWITH } { CAR } ;
                               ABS ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 9 ;
                               DUP ;
                               DUG 10 ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 14 ;
                               DUP ;
                               DUG 15 ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               DIG 3 ;
                               DUP ;
                               DUG 4 ;
                               PAIR ;
                               DIG 4 ;
                               DUP ;
                               DUG 5 ;
                               PAIR ;
                               PUSH nat 1000 ;
                               PUSH int 997 ;
                               PAIR ;
                               PAIR ;
                               EXEC ;
                               DIG 16 ;
                               DUP ;
                               DUG 17 ;
                               UNIT ;
                               LEFT unit ;
                               RIGHT (or unit unit) ;
                               RIGHT unit ;
                               PUSH nat 1 ;
                               PUSH nat 1 ;
                               INT ;
                               PAIR ;
                               UNIT ;
                               RIGHT unit ;
                               PUSH nat 1 ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               INT ;
                               PAIR ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               PAIR ;
                               PAIR ;
                               UNPAIR ;
                               UNPAIR ;
                               DIP { UNPAIR ; SWAP ; DUP } ;
                               UNPAIR ;
                               SWAP ;
                               DUP ;
                               DIG 3 ;
                               MUL ;
                               DUG 4 ;
                               DIG 3 ;
                               MUL ;
                               DIP { MUL } ;
                               DIG 3 ;
                               IF_LEFT { DROP ; ADD } { DROP ; SWAP ; SUB } ;
                               PAIR ;
                               UNPAIR ;
                               ABS ;
                               INT ;
                               PAIR ;
                               PAIR ;
                               PAIR ;
                               EXEC ;
                               IF { DUP ; PUSH string "INVALID_B_AMOUNT" ; PAIR ; FAILWITH } {} ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CAR ;
                               CONTRACT %transfer (pair address (pair address nat)) ;
                               IF_NONE
                                 { PUSH string "INVALID_A_ENTRY" ; FAILWITH }
                                 { DIG 15 ;
                                   DUP ;
                                   DUG 16 ;
                                   DIG 1 ;
                                   DUP ;
                                   DUG 2 ;
                                   PUSH mutez 0 ;
                                   DIG 12 ;
                                   DUP ;
                                   DUG 13 ;
                                   SELF ;
                                   ADDRESS ;
                                   PAIR ;
                                   SENDER ;
                                   PAIR ;
                                   TRANSFER_TOKENS ;
                                   CONS ;
                                   DIP { DIG 15 ; DROP } ;
                                   DUG 15 ;
                                   DROP } ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               CAR ;
                               CONTRACT %transfer (pair address (pair address nat)) ;
                               IF_NONE
                                 { PUSH string "INVALID_B_ENTRY" ; FAILWITH }
                                 { DIG 15 ;
                                   DUP ;
                                   DUG 16 ;
                                   DIG 1 ;
                                   DUP ;
                                   DUG 2 ;
                                   PUSH mutez 0 ;
                                   DIG 10 ;
                                   DUP ;
                                   DUG 11 ;
                                   SENDER ;
                                   PAIR ;
                                   SELF ;
                                   ADDRESS ;
                                   PAIR ;
                                   TRANSFER_TOKENS ;
                                   CONS ;
                                   DIP { DIG 15 ; DROP } ;
                                   DUG 15 ;
                                   DROP } ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               DIG 12 ;
                               DUP ;
                               DUG 13 ;
                               DIG 13 ;
                               DUP ;
                               DUG 14 ;
                               DIG 12 ;
                               DUP ;
                               DUG 13 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               PUSH int 0 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               INT ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               SUB ;
                               COMPARE ;
                               GE ;
                               IF { DIG 9 ;
                                    DUP ;
                                    DUG 10 ;
                                    INT ;
                                    DIG 6 ;
                                    DUP ;
                                    DUG 7 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    SUB ;
                                    ABS }
                                  { PUSH string "AssignNat" ; FAILWITH } ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               DIG 15 ;
                               DUP ;
                               DUG 16 ;
                               DIG 7 ;
                               DUP ;
                               DUG 8 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               ADD ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SOME ;
                               DIG 12 ;
                               DUP ;
                               DUG 13 ;
                               UPDATE ;
                               DIP { DIG 12 ; DROP } ;
                               DUG 12 ;
                               DROP ;
                               DIG 11 ;
                               DUP ;
                               DUG 12 ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               DIG 12 ;
                               DUP ;
                               DUG 13 ;
                               DIG 13 ;
                               DUP ;
                               DUG 14 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               GET ;
                               IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               DIG 9 ;
                               DUP ;
                               DUG 10 ;
                               DIG 6 ;
                               DUP ;
                               DUG 7 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               ADD ;
                               SWAP ;
                               UNPAIR ;
                               DROP ;
                               PUSH int 0 ;
                               DIG 14 ;
                               DUP ;
                               DUG 15 ;
                               INT ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               SUB ;
                               COMPARE ;
                               GE ;
                               IF { DIG 13 ;
                                    DUP ;
                                    DUG 14 ;
                                    INT ;
                                    DIG 7 ;
                                    DUP ;
                                    DUG 8 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    SUB ;
                                    ABS }
                                  { PUSH string "AssignNat" ; FAILWITH } ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SOME ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               UPDATE ;
                               DIP { DIG 12 ; DROP } ;
                               DUG 12 ;
                               DROP 7 } } ;
                     DROP 4 ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DIG 1 ;
                     PAIR }
                   { IF_LEFT
                       { UNPAIR ;
                         SWAP ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         CAR ;
                         CONTRACT %transfer (pair address (pair address nat)) ;
                         IF_NONE
                           { PUSH string "INVALID_DST_ENTRY" ; FAILWITH }
                           { DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             DIG 1 ;
                             DUP ;
                             DUG 2 ;
                             PUSH mutez 0 ;
                             DIG 4 ;
                             DUP ;
                             DUG 5 ;
                             SELF ;
                             ADDRESS ;
                             PAIR ;
                             SENDER ;
                             PAIR ;
                             TRANSFER_TOKENS ;
                             CONS ;
                             DIP { DIG 7 ; DROP } ;
                             DUG 7 ;
                             DROP } ;
                         PUSH mutez 1 ;
                         AMOUNT ;
                         EDIV ;
                         IF_NONE { PUSH string "DivByZero" ; FAILWITH } { DUP ; CAR ; SWAP ; DROP } ;
                         PUSH nat 0 ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH nat 1000000 }
                            { PUSH nat 1 ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              GET ;
                              IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              INT ;
                              PAIR ;
                              PUSH nat 1 ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              DIG 7 ;
                              DUP ;
                              DUG 8 ;
                              DIG 6 ;
                              DUP ;
                              DUG 7 ;
                              GET ;
                              IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              MUL ;
                              INT ;
                              PAIR ;
                              PAIR ;
                              UNPAIR ;
                              DIP { UNPAIR } ;
                              UNPAIR ;
                              DIG 3 ;
                              PUSH int 0 ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              COMPARE ;
                              GE ;
                              IF { INT } { NEG } ;
                              MUL ;
                              DIP { MUL ; ABS } ;
                              PAIR ;
                              UNPAIR ;
                              EDIV ;
                              IF_NONE { PUSH string "DivByZero" ; FAILWITH } { CAR } ;
                              ABS } ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         SENDER ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         PAIR ;
                         MEM ;
                         IF { DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              SENDER ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              PAIR ;
                              GET ;
                              IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              ADD ;
                              SOME ;
                              SENDER ;
                              DIG 7 ;
                              DUP ;
                              DUG 8 ;
                              PAIR ;
                              UPDATE ;
                              DIP { DIG 5 ; DROP } ;
                              DUG 5 ;
                              DROP }
                            { DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              SENDER ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              PAIR ;
                              MEM ;
                              IF { PUSH string "KeyAlreadyExists" ; FAILWITH }
                                 { DIG 4 ;
                                   DUP ;
                                   DUG 5 ;
                                   DIG 1 ;
                                   DUP ;
                                   DUG 2 ;
                                   PUSH nat 0 ;
                                   ADD ;
                                   SOME ;
                                   SENDER ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   PAIR ;
                                   UPDATE ;
                                   DIP { DIG 4 ; DROP } ;
                                   DUG 4 } } ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         DIG 6 ;
                         DUP ;
                         DUG 7 ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         DIG 6 ;
                         DUP ;
                         DUG 7 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DROP ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         DIG 6 ;
                         DUP ;
                         DUG 7 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         ADD ;
                         SWAP ;
                         UNPAIR ;
                         DROP ;
                         DIG 9 ;
                         DUP ;
                         DUG 10 ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         ADD ;
                         SWAP ;
                         DROP ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         ADD ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         DIG 6 ;
                         DUP ;
                         DUG 7 ;
                         UPDATE ;
                         DIP { DIG 6 ; DROP } ;
                         DUG 6 ;
                         DROP 5 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DIG 1 ;
                         PAIR }
                       { UNPAIR ;
                         SWAP ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         SENDER ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         PAIR ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         COMPARE ;
                         LE ;
                         NOT ;
                         IF { PUSH string "NOT_ENOUGHT_LQT" ; FAILWITH } {} ;
                         PUSH nat 1 ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         INT ;
                         PAIR ;
                         PUSH nat 1 ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         INT ;
                         PAIR ;
                         PAIR ;
                         UNPAIR ;
                         DIP { UNPAIR } ;
                         UNPAIR ;
                         DIG 3 ;
                         PUSH int 0 ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         COMPARE ;
                         GE ;
                         IF { INT } { NEG } ;
                         MUL ;
                         DIP { MUL ; ABS } ;
                         PAIR ;
                         PUSH nat 1 ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         INT ;
                         PAIR ;
                         DIG 1 ;
                         DUP ;
                         DUG 2 ;
                         PAIR ;
                         UNPAIR ;
                         DIP { UNPAIR } ;
                         UNPAIR ;
                         DIP { SWAP } ;
                         MUL ;
                         DIP { MUL } ;
                         PAIR ;
                         UNPAIR ;
                         EDIV ;
                         IF_NONE { PUSH string "DivByZero" ; FAILWITH } { CAR } ;
                         ABS ;
                         DIG 8 ;
                         DUP ;
                         DUG 9 ;
                         SENDER ;
                         CONTRACT unit ;
                         IF_NONE { PUSH string "BadContract" ; FAILWITH } {} ;
                         PUSH mutez 1 ;
                         PUSH nat 1 ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         INT ;
                         PAIR ;
                         PAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         ABS ;
                         DIG 2 ;
                         MUL ;
                         EDIV ;
                         IF_NONE { PUSH string "DivByZero" ; FAILWITH } {} ;
                         CAR ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DIP { DIG 8 ; DROP } ;
                         DUG 8 ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         GET ;
                         IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                         CAR ;
                         CONTRACT %transfer (pair address (pair address nat)) ;
                         IF_NONE
                           { PUSH string "INVALID_DST_ENTRY" ; FAILWITH }
                           { PUSH nat 1 ;
                             DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             GET ;
                             IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             INT ;
                             PAIR ;
                             DIG 3 ;
                             DUP ;
                             DUG 4 ;
                             PAIR ;
                             UNPAIR ;
                             DIP { UNPAIR } ;
                             UNPAIR ;
                             DIP { SWAP } ;
                             MUL ;
                             DIP { MUL } ;
                             PAIR ;
                             UNPAIR ;
                             EDIV ;
                             IF_NONE { PUSH string "DivByZero" ; FAILWITH } { CAR } ;
                             ABS ;
                             DIG 10 ;
                             DUP ;
                             DUG 11 ;
                             DIG 2 ;
                             DUP ;
                             DUG 3 ;
                             PUSH mutez 0 ;
                             DIG 3 ;
                             DUP ;
                             DUG 4 ;
                             SENDER ;
                             PAIR ;
                             SELF ;
                             ADDRESS ;
                             PAIR ;
                             TRANSFER_TOKENS ;
                             CONS ;
                             DIP { DIG 10 ; DROP } ;
                             DUG 10 ;
                             DIG 6 ;
                             DUP ;
                             DUG 7 ;
                             SENDER ;
                             DIG 6 ;
                             DUP ;
                             DUG 7 ;
                             PAIR ;
                             MEM ;
                             IF { DIG 6 ;
                                  DUP ;
                                  DUG 7 ;
                                  SENDER ;
                                  DIG 6 ;
                                  DUP ;
                                  DUG 7 ;
                                  PAIR ;
                                  GET ;
                                  IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                                  DIG 7 ;
                                  DUP ;
                                  DUG 8 ;
                                  PUSH int 0 ;
                                  DIG 8 ;
                                  DUP ;
                                  DUG 9 ;
                                  INT ;
                                  DIG 3 ;
                                  DUP ;
                                  DUG 4 ;
                                  SUB ;
                                  COMPARE ;
                                  GE ;
                                  IF { DIG 7 ; DUP ; DUG 8 ; INT ; DIG 2 ; DUP ; DUG 3 ; SUB ; ABS }
                                     { PUSH string "AssignNat" ; FAILWITH } ;
                                  SOME ;
                                  SENDER ;
                                  DIG 8 ;
                                  DUP ;
                                  DUG 9 ;
                                  PAIR ;
                                  UPDATE ;
                                  DIP { DIG 7 ; DROP } ;
                                  DUG 7 ;
                                  DROP }
                                { DIG 6 ;
                                  DUP ;
                                  DUG 7 ;
                                  SENDER ;
                                  DIG 6 ;
                                  DUP ;
                                  DUG 7 ;
                                  PAIR ;
                                  MEM ;
                                  IF { PUSH string "KeyAlreadyExists" ; FAILWITH }
                                     { DIG 6 ;
                                       DUP ;
                                       DUG 7 ;
                                       PUSH int 0 ;
                                       DIG 7 ;
                                       DUP ;
                                       DUG 8 ;
                                       INT ;
                                       PUSH nat 0 ;
                                       SUB ;
                                       COMPARE ;
                                       GE ;
                                       IF { DIG 6 ; DUP ; DUG 7 ; INT ; PUSH nat 0 ; SUB ; ABS }
                                          { PUSH string "AssignNat" ; FAILWITH } ;
                                       SOME ;
                                       SENDER ;
                                       DIG 7 ;
                                       DUP ;
                                       DUG 8 ;
                                       PAIR ;
                                       UPDATE ;
                                       DIP { DIG 6 ; DROP } ;
                                       DUG 6 } } ;
                             DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             GET ;
                             IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             DIG 9 ;
                             DUP ;
                             DUG 10 ;
                             DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             GET ;
                             IF_NONE { PUSH string "GetNoneValue" ; FAILWITH } {} ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             SWAP ;
                             UNPAIR ;
                             DROP ;
                             PUSH int 0 ;
                             DIG 9 ;
                             DUP ;
                             DUG 10 ;
                             INT ;
                             DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             SUB ;
                             COMPARE ;
                             GE ;
                             IF { DIG 8 ;
                                  DUP ;
                                  DUG 9 ;
                                  INT ;
                                  DIG 6 ;
                                  DUP ;
                                  DUG 7 ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CAR ;
                                  SUB ;
                                  ABS }
                                { PUSH string "AssignNat" ; FAILWITH } ;
                             SWAP ;
                             UNPAIR ;
                             DROP ;
                             PUSH int 0 ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             INT ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             SUB ;
                             COMPARE ;
                             GE ;
                             IF { DIG 7 ;
                                  DUP ;
                                  DUG 8 ;
                                  INT ;
                                  DIG 7 ;
                                  DUP ;
                                  DUG 8 ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CAR ;
                                  SUB ;
                                  ABS }
                                { PUSH string "AssignNat" ; FAILWITH } ;
                             SWAP ;
                             DROP ;
                             PUSH int 0 ;
                             DIG 13 ;
                             DUP ;
                             DUG 14 ;
                             INT ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             SUB ;
                             COMPARE ;
                             GE ;
                             IF { DIG 12 ;
                                  DUP ;
                                  DUG 13 ;
                                  INT ;
                                  DIG 7 ;
                                  DUP ;
                                  DUG 8 ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  SUB ;
                                  ABS }
                                { PUSH string "AssignNat" ; FAILWITH } ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SOME ;
                             DIG 7 ;
                             DUP ;
                             DUG 8 ;
                             UPDATE ;
                             DIP { DIG 8 ; DROP } ;
                             DUG 8 ;
                             DROP 3 } ;
                         DROP 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DIG 1 ;
                         PAIR } } } } ;
         DIP { DROP 2 } } }
