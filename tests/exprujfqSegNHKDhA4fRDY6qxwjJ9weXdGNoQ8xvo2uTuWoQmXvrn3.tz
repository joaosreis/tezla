{ storage
    (pair (map %allTransaction
             string
             (list (pair (pair (int %price) (int %quantity)) (pair (string %stockType) (timestamp %time)))))
          (map %stocksTotal string (map string int))) ;
  parameter
    (pair (pair (int %price) (int %quantity)) (pair (string %stockType) (string %username))) ;
  code { UNPAIR ;
         NIL (pair (pair (int %price) (int %quantity)) (pair (string %stockType) (timestamp %time))) ;
         DUP 3 ;
         CAR ;
         DUP 3 ;
         GET 4 ;
         MEM ;
         IF { DUP 3 ;
              CAR ;
              DUP 3 ;
              GET 4 ;
              GET ;
              IF_NONE { PUSH int 30 ; FAILWITH } {} ;
              ITER { CONS } }
            {} ;
         DUP 3 ;
         CDR ;
         DUP 3 ;
         GET 4 ;
         MEM ;
         IF { DUP 3 ;
              CDR ;
              DUP 3 ;
              GET 4 ;
              GET ;
              IF_NONE { PUSH int 41 ; FAILWITH } {} ;
              DUP 3 ;
              GET 3 ;
              MEM ;
              IF { DUP 3 ;
                   UNPAIR ;
                   SWAP ;
                   DUP ;
                   DUP 5 ;
                   GET 4 ;
                   DUP ;
                   DUG 2 ;
                   GET ;
                   IF_NONE { PUSH int 43 ; FAILWITH } {} ;
                   DIG 6 ;
                   CDR ;
                   DUP 7 ;
                   GET 4 ;
                   GET ;
                   IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                   DUP 7 ;
                   GET 3 ;
                   GET ;
                   IF_NONE { PUSH int 43 ; FAILWITH } {} ;
                   DUP 7 ;
                   CAR ;
                   CDR ;
                   ADD ;
                   SOME ;
                   DUP 7 ;
                   GET 3 ;
                   UPDATE ;
                   SOME ;
                   SWAP ;
                   UPDATE ;
                   SWAP ;
                   PAIR ;
                   DUP ;
                   DUG 3 ;
                   UNPAIR ;
                   SWAP ;
                   DIG 4 ;
                   CDR ;
                   DUP 5 ;
                   GET 4 ;
                   GET ;
                   IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                   SOME ;
                   DUP 5 ;
                   GET 4 ;
                   UPDATE ;
                   SWAP ;
                   PAIR ;
                   DUG 2 }
                 { DIG 2 ;
                   UNPAIR ;
                   SWAP ;
                   DUP ;
                   DUP 5 ;
                   GET 4 ;
                   DUP ;
                   DUG 2 ;
                   GET ;
                   IF_NONE { PUSH int 48 ; FAILWITH } {} ;
                   DUP 6 ;
                   CAR ;
                   CDR ;
                   SOME ;
                   DUP 7 ;
                   GET 3 ;
                   UPDATE ;
                   SOME ;
                   SWAP ;
                   UPDATE ;
                   SWAP ;
                   PAIR ;
                   DUP ;
                   DUG 3 ;
                   UNPAIR ;
                   SWAP ;
                   DIG 4 ;
                   CDR ;
                   DUP 5 ;
                   GET 4 ;
                   GET ;
                   IF_NONE { PUSH int 47 ; FAILWITH } {} ;
                   SOME ;
                   DUP 5 ;
                   GET 4 ;
                   UPDATE ;
                   SWAP ;
                   PAIR ;
                   DUG 2 } }
            { DIG 2 ;
              UNPAIR ;
              SWAP ;
              PUSH (option (map string int)) (Some {}) ;
              DUP 5 ;
              GET 4 ;
              UPDATE ;
              SWAP ;
              PAIR ;
              UNPAIR ;
              SWAP ;
              DUP ;
              DUP 5 ;
              GET 4 ;
              DUP ;
              DUG 2 ;
              GET ;
              IF_NONE { PUSH int 53 ; FAILWITH } {} ;
              DUP 6 ;
              CAR ;
              CDR ;
              SOME ;
              DUP 7 ;
              GET 3 ;
              UPDATE ;
              SOME ;
              SWAP ;
              UPDATE ;
              SWAP ;
              PAIR ;
              DUG 2 } ;
         PUSH timestamp "2021-03-25T04:02:03Z" ;
         DUP 3 ;
         GET 3 ;
         PAIR %stockType %time ;
         DIG 2 ;
         DUP ;
         CAR ;
         CDR ;
         SWAP ;
         DUP ;
         DUG 4 ;
         CAR ;
         CAR ;
         PAIR %price %quantity ;
         PAIR ;
         CONS ;
         DIG 2 ;
         UNPAIR ;
         DIG 2 ;
         SOME ;
         DIG 3 ;
         GET 4 ;
         UPDATE ;
         PAIR ;
         NIL operation ;
         PAIR } }
