{ parameter (or (pair %permit key (pair signature bytes)) (nat %wrapped)) ;
  storage (pair (big_map (pair bytes address) unit) (pair nat address)) ;
  code { DUP ;
         CAR ;
         DIP { CDR } ;
         IF_LEFT
           { DUP ;
             CAR ;
             DUP ;
             DIP { SWAP ;
                   CDR ;
                   DUP ;
                   CAR ;
                   DIP { CDR ;
                         DUP ;
                         DIP { DIP { HASH_KEY ; IMPLICIT_ACCOUNT ; ADDRESS } ; PAIR ; SWAP } ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         CAR ;
                         DIP { SWAP } ;
                         PAIR ;
                         SELF ;
                         ADDRESS ;
                         CHAIN_ID ;
                         PAIR ;
                         PAIR ;
                         PACK } } ;
             DIP { DIP { DUP } } ;
             CHECK_SIGNATURE ;
             IF { DROP } { PUSH string "missigned" ; PAIR ; FAILWITH } ;
             SWAP ;
             DIP { DUP ;
                   CDR ;
                   DUP ;
                   CAR ;
                   PUSH nat 1 ;
                   ADD ;
                   DIP { CDR } ;
                   PAIR ;
                   SWAP ;
                   CAR ;
                   UNIT ;
                   SOME } ;
             UPDATE ;
             PAIR ;
             NIL operation ;
             PAIR }
           { DUP ;
             PUSH nat 42 ;
             COMPARE ;
             EQ ;
             IF {} { PUSH string "not 42" ; FAILWITH } ;
             PACK ;
             DIP { DUP ; CAR ; DIP { CDR ; DUP ; CAR ; DIP { CDR } ; SWAP ; DUP } } ;
             SWAP ;
             DIP { BLAKE2B ; PAIR } ;
             DUP ;
             DIG 2 ;
             DUP ;
             DIP { MEM ; IF {} { PUSH string "no permit" ; FAILWITH } ; NONE unit } ;
             UPDATE ;
             DIP { SWAP ; PAIR } ;
             PAIR ;
             NIL operation ;
             PAIR } } }
