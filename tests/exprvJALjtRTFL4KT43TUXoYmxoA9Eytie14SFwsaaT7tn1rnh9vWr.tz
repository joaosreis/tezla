{ storage
    (big_map
       nat
       (pair (address %token_address)
             (pair (nat %token_id)
                   (pair (nat %token_amount)
                         (pair (timestamp %end_timestamp)
                               (pair (address %seller) (pair (mutez %bid_amount) (address %bidder)))))))) ;
  parameter
    (or (nat %bid)
        (or (pair %create_auction
               (pair (nat %auction_id) (pair (mutez %bid_amount) (timestamp %end_timestamp)))
               (pair (address %token_address) (pair (nat %token_amount) (nat %token_id))))
            (nat %withdraw))) ;
  code { CAST (pair (or nat (or (pair (pair nat (pair mutez timestamp)) (pair address (pair nat nat))) nat))
                    (big_map
                       nat
                       (pair address (pair nat (pair nat (pair timestamp (pair address (pair mutez address)))))))) ;
         UNPAIR ;
         IF_LEFT
           { SWAP ;
             DUP ;
             DUG 2 ;
             SWAP ;
             DUP ;
             DUG 2 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 9 ;
             SENDER ;
             COMPARE ;
             NEQ ;
             IF {} { PUSH string "AUC_SELLER_CANNOT_BID" ; FAILWITH } ;
             PUSH mutez 100000 ;
             DUP 3 ;
             DUP 3 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 11 ;
             ADD ;
             AMOUNT ;
             COMPARE ;
             GE ;
             IF {} { PUSH string "AUC_BID_AMOUNT_TOO_LOW" ; FAILWITH } ;
             SWAP ;
             DUP ;
             DUG 2 ;
             SWAP ;
             DUP ;
             DUG 2 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 7 ;
             NOW ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "AUC_AUCTION_IS_OVER" ; FAILWITH } ;
             SWAP ;
             DUP ;
             DUG 2 ;
             SWAP ;
             DUP ;
             DUG 2 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 9 ;
             DUP 3 ;
             DUP 3 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 12 ;
             COMPARE ;
             NEQ ;
             IF { PUSH address "tz3jfebmewtfXYD1Xef34TwrfMg2rrrw6oum" ;
                  DUP 3 ;
                  DUP 3 ;
                  GET ;
                  IF_NONE { PUSH int 382 ; FAILWITH } {} ;
                  GET 12 ;
                  COMPARE ;
                  GT ;
                  IF { NIL operation ;
                       PUSH address "tz1aW9v8Ka7UCuoGFWjzag9Fv599mLbWVSq9" ;
                       CONTRACT unit ;
                       IF_NONE { PUSH int 393 ; FAILWITH } {} ;
                       DUP 4 ;
                       DUP 4 ;
                       GET ;
                       IF_NONE { PUSH int 382 ; FAILWITH } {} ;
                       GET 11 ;
                       UNIT ;
                       TRANSFER_TOKENS ;
                       CONS }
                     { NIL operation ;
                       DUP 3 ;
                       DUP 3 ;
                       GET ;
                       IF_NONE { PUSH int 382 ; FAILWITH } {} ;
                       GET 12 ;
                       CONTRACT unit ;
                       IF_NONE { PUSH int 395 ; FAILWITH } {} ;
                       DUP 4 ;
                       DUP 4 ;
                       GET ;
                       IF_NONE { PUSH int 382 ; FAILWITH } {} ;
                       GET 11 ;
                       UNIT ;
                       TRANSFER_TOKENS ;
                       CONS } }
                { NIL operation } ;
             DIG 2 ;
             DUP ;
             DUP 4 ;
             DUP ;
             DUG 2 ;
             GET ;
             IF_NONE { PUSH int 397 ; FAILWITH } {} ;
             SENDER ;
             UPDATE 12 ;
             SOME ;
             SWAP ;
             UPDATE ;
             DUP ;
             DUP 4 ;
             DUP ;
             DUG 2 ;
             GET ;
             IF_NONE { PUSH int 398 ; FAILWITH } {} ;
             AMOUNT ;
             UPDATE 11 ;
             SOME ;
             SWAP ;
             UPDATE ;
             DUG 2 ;
             PUSH int 300 ;
             NOW ;
             DUP 5 ;
             DUP 5 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             GET 7 ;
             SUB ;
             COMPARE ;
             LT ;
             IF { DIG 2 ;
                  DUP ;
                  DUP 4 ;
                  DUP ;
                  DUG 2 ;
                  GET ;
                  IF_NONE { PUSH int 400 ; FAILWITH } {} ;
                  NOW ;
                  PUSH int 300 ;
                  ADD ;
                  UPDATE 7 ;
                  SOME ;
                  SWAP ;
                  UPDATE ;
                  DUG 2 }
                {} ;
             DIG 2 ;
             DUP ;
             DUP 4 ;
             GET ;
             IF_NONE { PUSH int 382 ; FAILWITH } {} ;
             SOME ;
             DIG 3 ;
             UPDATE ;
             SWAP }
           { IF_LEFT
               { DUP ;
                 GET 5 ;
                 PUSH nat 0 ;
                 COMPARE ;
                 LT ;
                 IF {} { PUSH string "AUC_TOKEN_AMOUNT_TOO_LOW" ; FAILWITH } ;
                 NOW ;
                 PUSH int 60 ;
                 DUP ;
                 PUSH int 1 ;
                 MUL ;
                 MUL ;
                 ADD ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET 4 ;
                 COMPARE ;
                 GE ;
                 IF {} { PUSH string "AUC_END_DATE_TOO_SOON" ; FAILWITH } ;
                 NOW ;
                 PUSH int 60 ;
                 DUP ;
                 PUSH int 168 ;
                 MUL ;
                 MUL ;
                 ADD ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET 4 ;
                 COMPARE ;
                 LE ;
                 IF {} { PUSH string "AUC_END_DATE_TOO_LATE" ; FAILWITH } ;
                 DUP ;
                 CAR ;
                 GET 3 ;
                 PUSH mutez 100000 ;
                 SWAP ;
                 COMPARE ;
                 GE ;
                 IF {} { PUSH string "AUC_BID_AMOUNT_TOO_LOW" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CAR ;
                 MEM ;
                 IF { PUSH string "AUC_ID_ALREADY_IN_USE" ; FAILWITH } {} ;
                 DUP ;
                 GET 3 ;
                 CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                 IF_NONE { PUSH int 361 ; FAILWITH } {} ;
                 NIL operation ;
                 SWAP ;
                 PUSH mutez 0 ;
                 NIL (pair address (list (pair address (pair nat nat)))) ;
                 NIL (pair address (pair nat nat)) ;
                 DIG 5 ;
                 DUP ;
                 GET 5 ;
                 SWAP ;
                 DUP ;
                 DUG 7 ;
                 GET 6 ;
                 SELF_ADDRESS ;
                 PAIR 3 ;
                 CONS ;
                 SENDER ;
                 PAIR ;
                 CONS ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 DIG 2 ;
                 SENDER ;
                 DUP 4 ;
                 CAR ;
                 GET 3 ;
                 SENDER ;
                 DIG 5 ;
                 DUP ;
                 CAR ;
                 GET 4 ;
                 SWAP ;
                 DUP ;
                 GET 5 ;
                 SWAP ;
                 DUP ;
                 GET 6 ;
                 SWAP ;
                 DUP ;
                 DUG 9 ;
                 GET 3 ;
                 PAIR 7 ;
                 SOME ;
                 DIG 3 ;
                 CAR ;
                 CAR ;
                 UPDATE ;
                 SWAP }
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 7 ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 IF {} { PUSH string "AUC_AUCTION_IS_ONGOING" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 9 ;
                 DUP 3 ;
                 DUP 3 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 12 ;
                 COMPARE ;
                 NEQ ;
                 IF { PUSH address "tz3jfebmewtfXYD1Xef34TwrfMg2rrrw6oum" ;
                      DUP 3 ;
                      DUP 3 ;
                      GET ;
                      IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                      GET 9 ;
                      COMPARE ;
                      GT ;
                      IF { NIL operation ;
                           PUSH address "tz1aW9v8Ka7UCuoGFWjzag9Fv599mLbWVSq9" ;
                           CONTRACT unit ;
                           IF_NONE { PUSH int 415 ; FAILWITH } {} ;
                           DUP 4 ;
                           DUP 4 ;
                           GET ;
                           IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                           GET 11 ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS }
                         { NIL operation ;
                           DUP 3 ;
                           DUP 3 ;
                           GET ;
                           IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                           GET 9 ;
                           CONTRACT unit ;
                           IF_NONE { PUSH int 417 ; FAILWITH } {} ;
                           DUP 4 ;
                           DUP 4 ;
                           GET ;
                           IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                           GET 11 ;
                           UNIT ;
                           TRANSFER_TOKENS ;
                           CONS } }
                    { NIL operation } ;
                 DUP 3 ;
                 DUP 3 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 CAR ;
                 CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                 IF_NONE { PUSH int 411 ; FAILWITH } {} ;
                 PUSH mutez 0 ;
                 NIL (pair address (list (pair address (pair nat nat)))) ;
                 NIL (pair address (pair nat nat)) ;
                 DUP 7 ;
                 DUP 7 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 5 ;
                 DUP 8 ;
                 DUP 8 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 3 ;
                 DUP 9 ;
                 DUP 9 ;
                 GET ;
                 IF_NONE { PUSH int 407 ; FAILWITH } {} ;
                 GET 12 ;
                 PAIR 3 ;
                 CONS ;
                 SELF_ADDRESS ;
                 PAIR ;
                 CONS ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 DIG 2 ;
                 NONE (pair address (pair nat (pair nat (pair timestamp (pair address (pair mutez address)))))) ;
                 DIG 3 ;
                 UPDATE ;
                 SWAP } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
