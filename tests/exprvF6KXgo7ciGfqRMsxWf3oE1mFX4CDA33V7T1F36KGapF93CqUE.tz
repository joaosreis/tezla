{ parameter
    (or (or (or (string %burn) (string %buy))
            (or (pair %fa12buy
                   (pair (nat %amount) (address %buyer))
                   (pair (address %owner) (string %tokenId)))
                (or (pair %getAdministrator unit (contract address))
                    (pair %getOwner string (contract address)))))
        (or (or (pair %getTotalTokens unit (contract int))
                (or (pair %mint
                       (pair (pair (option %contractAddr address) (option %expiration timestamp))
                             (pair (option %lockTime timestamp) (option %metaData (map string string))))
                       (pair (pair (bool %onSale) (address %owner))
                             (pair (option %receiver address) (pair (string %tokenId) (nat %value)))))
                    (address %setAdministrator)))
            (or (bool %setPause)
                (or (pair %setSale
                       (pair (option %contractAddr address) (option %receiver address))
                       (pair (bool %sale) (pair (string %tokenId) (nat %value))))
                    (pair %transfer (string %tokenId) (pair (address %from) (address %to))))))) ;
  storage
    (pair (pair (address %administrator) (int %nbTokens))
          (pair (bool %paused)
                (big_map %tokens
                   string
                   (pair (pair (pair (map %approvals address nat) (option %contractAddr address))
                               (pair (option %expiration timestamp) (option %lockTime timestamp)))
                         (pair (pair (map %metaData string string) (bool %onSale))
                               (pair (address %owner) (pair (option %receiver address) (nat %value)))))))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     MEM ;
                     IF {} { PUSH string "Unreferenced token" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 13 ; FAILWITH } {} } ;
                     GET 5 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "Only owner allowed" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 20 ; FAILWITH } {} } ;
                     CAR ;
                     CDR ;
                     CDR ;
                     { IF_NONE
                         {}
                         { DROP ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET 4 ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET ;
                           { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                           CAR ;
                           CDR ;
                           CDR ;
                           { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                           NOW ;
                           COMPARE ;
                           GT ;
                           IF {} { PUSH string "Token is currently locked" ; FAILWITH } } } ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     NONE (pair (pair (pair (map %approvals address nat) (option %contractAddr address))
                                      (pair (option %expiration timestamp) (option %lockTime timestamp)))
                                (pair (pair (map %metaData string string) (bool %onSale))
                                      (pair (address %owner) (pair (option %receiver address) (nat %value))))) ;
                     DIG 4 ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     PUSH int 1 ;
                     SWAP ;
                     SUB ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     NIL operation }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     IF { PUSH string "Contract is paused" ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     MEM ;
                     IF {} { PUSH string "Unreferenced token" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 51 ; FAILWITH } {} } ;
                     CDR ;
                     CAR ;
                     CDR ;
                     IF {} { PUSH string "Not on sale" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 16 ; FAILWITH } {} } ;
                     CAR ;
                     CDR ;
                     CAR ;
                     { IF_NONE
                         {}
                         { DROP ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET 4 ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET ;
                           { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                           CAR ;
                           CDR ;
                           CAR ;
                           { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                           NOW ;
                           COMPARE ;
                           LE ;
                           IF {} { PUSH string "Token is expired" ; FAILWITH } } } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 54 ; FAILWITH } {} } ;
                     CAR ;
                     CAR ;
                     CDR ;
                     { IF_NONE {} { PUSH string "Not allowed for XTZ funds" ; FAILWITH } } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 55 ; FAILWITH } {} } ;
                     GET 7 ;
                     { IF_NONE
                         {}
                         { DROP ;
                           SENDER ;
                           DUP 3 ;
                           GET 4 ;
                           DUP 3 ;
                           GET ;
                           { IF_NONE { PUSH int 56 ; FAILWITH } {} } ;
                           GET 7 ;
                           { IF_NONE { PUSH int 56 ; FAILWITH } {} } ;
                           COMPARE ;
                           EQ ;
                           IF {} { PUSH string "Not on sale for this account" ; FAILWITH } } } ;
                     PUSH mutez 1 ;
                     DUP 3 ;
                     GET 4 ;
                     DUP 3 ;
                     GET ;
                     { IF_NONE { PUSH int 57 ; FAILWITH } {} } ;
                     GET 8 ;
                     MUL ;
                     AMOUNT ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "Not enough funds" ; FAILWITH } ;
                     NIL operation ;
                     DUP 3 ;
                     GET 4 ;
                     DUP 3 ;
                     GET ;
                     { IF_NONE { PUSH int 58 ; FAILWITH } {} } ;
                     GET 5 ;
                     CONTRACT unit ;
                     { IF_NONE { PUSH int 58 ; FAILWITH } {} } ;
                     AMOUNT ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DIG 2 ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DUP 6 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 59 ; FAILWITH } {} } ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     CDR ;
                     SENDER ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DIG 5 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 60 ; FAILWITH } {} } ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     CAR ;
                     PUSH bool False ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     IF { PUSH string "Contract is paused" ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     MEM ;
                     IF {} { PUSH string "Unreferenced token" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 126 ; FAILWITH } {} } ;
                     CDR ;
                     CAR ;
                     CDR ;
                     IF {} { PUSH string "Not on sale" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 16 ; FAILWITH } {} } ;
                     CAR ;
                     CDR ;
                     CAR ;
                     { IF_NONE
                         {}
                         { DROP ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET 4 ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           GET 4 ;
                           GET ;
                           { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                           CAR ;
                           CDR ;
                           CAR ;
                           { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                           NOW ;
                           COMPARE ;
                           LE ;
                           IF {} { PUSH string "Token is expired" ; FAILWITH } } } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 128 ; FAILWITH } {} } ;
                     CAR ;
                     CAR ;
                     CDR ;
                     { IF_NONE
                         {}
                         { DROP ;
                           SENDER ;
                           DUP 3 ;
                           GET 4 ;
                           DUP 3 ;
                           GET 4 ;
                           GET ;
                           { IF_NONE { PUSH int 129 ; FAILWITH } {} } ;
                           CAR ;
                           CAR ;
                           CDR ;
                           { IF_NONE { PUSH int 129 ; FAILWITH } {} } ;
                           COMPARE ;
                           EQ ;
                           IF {} { PUSH string "Not allowed for this contract" ; FAILWITH } } } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 13 ; FAILWITH } {} } ;
                     GET 5 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "Only payable to owner" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 131 ; FAILWITH } {} } ;
                     GET 7 ;
                     { IF_NONE
                         {}
                         { DROP ;
                           DUP ;
                           CAR ;
                           CDR ;
                           DUP 3 ;
                           GET 4 ;
                           DUP 3 ;
                           GET 4 ;
                           GET ;
                           { IF_NONE { PUSH int 132 ; FAILWITH } {} } ;
                           GET 7 ;
                           { IF_NONE { PUSH int 132 ; FAILWITH } {} } ;
                           COMPARE ;
                           EQ ;
                           IF {} { PUSH string "Not on sale for this account" ; FAILWITH } } } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 4 ;
                     GET ;
                     { IF_NONE { PUSH int 133 ; FAILWITH } {} } ;
                     GET 8 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     GE ;
                     IF {} { PUSH string "Not enough funds" ; FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DUP 5 ;
                     GET 4 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 134 ; FAILWITH } {} } ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     CDR ;
                     DUP 8 ;
                     CAR ;
                     CDR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     DUP ;
                     DIG 4 ;
                     GET 4 ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     { IF_NONE { PUSH int 135 ; FAILWITH } {} } ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     CAR ;
                     PUSH bool False ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     NIL operation }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         NIL operation ;
                         DIG 2 ;
                         CDR ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         TRANSFER_TOKENS ;
                         CONS }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         { IF_NONE { PUSH int 66 ; FAILWITH } {} } ;
                         GET 5 ;
                         NIL operation ;
                         DIG 2 ;
                         CDR ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         TRANSFER_TOKENS ;
                         CONS } } } }
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     NIL operation ;
                     DIG 2 ;
                     CDR ;
                     PUSH mutez 0 ;
                     DIG 3 ;
                     TRANSFER_TOKENS ;
                     CONS }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 7 ;
                         MEM ;
                         IF { PUSH string "Already referenced token" ; FAILWITH } {} ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP 4 ;
                         GET 8 ;
                         NONE address ;
                         PAIR %receiver %value ;
                         DUP 5 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         PAIR %owner ;
                         DUP 5 ;
                         CDR ;
                         CAR ;
                         CAR ;
                         EMPTY_MAP string string ;
                         PAIR %metaData %onSale ;
                         PAIR ;
                         DIG 4 ;
                         DUP ;
                         CAR ;
                         CDR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 6 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         PAIR %expiration %lockTime ;
                         DUP 6 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         EMPTY_MAP address nat ;
                         PAIR %approvals %contractAddr ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         DUP 5 ;
                         GET 7 ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         DUP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { IF_NONE
                             { DROP }
                             { DROP ;
                               DUP ;
                               CAR ;
                               CDR ;
                               CDR ;
                               { IF_NONE { PUSH int 82 ; FAILWITH } {} } ;
                               ITER { CAR ;
                                      DIG 2 ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 6 ;
                                      GET 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      { IF_NONE { PUSH int 83 ; FAILWITH } {} } ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      DUP 10 ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      { IF_NONE { PUSH int 82 ; FAILWITH } {} } ;
                                      DUP 10 ;
                                      GET ;
                                      { IF_NONE { PUSH int 83 ; FAILWITH } {} } ;
                                      SOME ;
                                      DIG 9 ;
                                      UPDATE ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP } ;
                               DROP } } ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         PUSH int 1 ;
                         ADD ;
                         SWAP ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Only administrator allowed" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         CDR ;
                         DIG 2 ;
                         PAIR ;
                         PAIR } ;
                     NIL operation } }
               { IF_LEFT
                   { DROP ;
                     DUP ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "Only administrator allowed" ; FAILWITH } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         IF { PUSH string "Contract is paused" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         MEM ;
                         IF {} { PUSH string "Unreferenced token" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         GET ;
                         { IF_NONE { PUSH int 13 ; FAILWITH } {} } ;
                         GET 5 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Only owner allowed" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         GET ;
                         { IF_NONE { PUSH int 16 ; FAILWITH } {} } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         { IF_NONE
                             {}
                             { DROP ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 5 ;
                               GET ;
                               { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                               CAR ;
                               CDR ;
                               CAR ;
                               { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                               NOW ;
                               COMPARE ;
                               LE ;
                               IF {} { PUSH string "Token is expired" ; FAILWITH } } } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         GET ;
                         { IF_NONE { PUSH int 20 ; FAILWITH } {} } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { IF_NONE
                             {}
                             { DROP ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 5 ;
                               GET ;
                               { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                               CAR ;
                               CDR ;
                               CDR ;
                               { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                               NOW ;
                               COMPARE ;
                               GT ;
                               IF {} { PUSH string "Token is currently locked" ; FAILWITH } } } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP ;
                         DUP 5 ;
                         GET 5 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         { IF_NONE { PUSH int 31 ; FAILWITH } {} } ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         CAR ;
                         DUP 8 ;
                         GET 3 ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP ;
                         DUP 5 ;
                         GET 5 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         { IF_NONE { PUSH int 32 ; FAILWITH } {} } ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DUP 9 ;
                         GET 6 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP ;
                         DUP 5 ;
                         GET 5 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         { IF_NONE { PUSH int 33 ; FAILWITH } {} } ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DUP 9 ;
                         CAR ;
                         CDR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP ;
                         DUP 5 ;
                         GET 5 ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         { IF_NONE { PUSH int 34 ; FAILWITH } {} } ;
                         UNPAIR ;
                         UNPAIR ;
                         CAR ;
                         DIG 7 ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 3 ;
                         IF { PUSH string "Contract is paused" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         MEM ;
                         IF {} { PUSH string "Unreferenced token" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         { IF_NONE { PUSH int 13 ; FAILWITH } {} } ;
                         GET 5 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Only owner allowed" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         { IF_NONE { PUSH int 16 ; FAILWITH } {} } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         { IF_NONE
                             {}
                             { DROP ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               GET ;
                               { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                               CAR ;
                               CDR ;
                               CAR ;
                               { IF_NONE { PUSH int 17 ; FAILWITH } {} } ;
                               NOW ;
                               COMPARE ;
                               LE ;
                               IF {} { PUSH string "Token is expired" ; FAILWITH } } } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 4 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET ;
                         { IF_NONE { PUSH int 20 ; FAILWITH } {} } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { IF_NONE
                             {}
                             { DROP ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               GET 4 ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               GET ;
                               { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                               CAR ;
                               CDR ;
                               CDR ;
                               { IF_NONE { PUSH int 21 ; FAILWITH } {} } ;
                               NOW ;
                               COMPARE ;
                               GT ;
                               IF {} { PUSH string "Token is currently locked" ; FAILWITH } } } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         DUP ;
                         DUP 5 ;
                         CAR ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         { IF_NONE { PUSH int 44 ; FAILWITH } {} } ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 7 ;
                         GET 4 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR } } ;
                 NIL operation } } ;
         PAIR } }
