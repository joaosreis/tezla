{ storage
    (pair (pair (pair (set %admin address) (mutez %betLimit))
                (pair (bool %bettingPaused)
                      (pair (big_map %bettors
                               address
                               (map int
                                    (pair (pair (mutez %amount) (pair %range int int))
                                          (pair (int %stakedAt) (pair (bool %withdrawn) (mutez %withdrawnAmount))))))
                            (int %blocksPerCycle))))
          (pair (pair (big_map %cycleData
                         int
                         (pair (pair (map %amountByRange (pair int int) mutez)
                                     (pair (bool %concluded) (int %endingPrice)))
                               (pair (int %referencePrice) (pair (pair %roi int int) (mutez %totalAmount)))))
                      (pair (int %rangeEnd) (int %rangeStep)))
                (pair (pair %roi int int) (pair (int %stakingPeriod) (bool %withdrawalsPaused))))) ;
  parameter
    (or (or (or (address %addAdmin)
                (or (mutez %changeBetLimit) (pair %changeBetRange (int %end) (int %step))))
            (or (or (unit %changeBettingPauseState) (int %changeBlocksPerCycle))
                (or (pair %changeROI (int %denominator) (int %numerator))
                    (unit %changeWithdrawalsPauseState))))
        (or (or (unit %default) (or (option %delegate key_hash) (unit %depositXTZ)))
            (or (or (pair %placeBet (int %bottom) (int %top)) (mutez %recoverXTZ))
                (or (address %removeAdmin) (int %updatePrice))))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     MEM ;
                     IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     PUSH bool True ;
                     DIG 5 ;
                     UPDATE ;
                     PAIR ;
                     PAIR ;
                     PAIR }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         CAR ;
                         DIG 3 ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         CAR ;
                         DUP 4 ;
                         CDR ;
                         DIG 4 ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR } } }
               { IF_LEFT
                   { IF_LEFT
                       { DROP ;
                         DUP ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         DUP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 3 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         NOT ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 3 ;
                         UNPAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { DROP ;
                         DUP ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         DUP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         GET 8 ;
                         NOT ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR } } } ;
             NIL operation }
           { IF_LEFT
               { IF_LEFT
                   { DROP ;
                     PUSH mutez 0 ;
                     AMOUNT ;
                     COMPARE ;
                     GT ;
                     IF {} { PUSH string "Please send atleast 1 mutez" ; FAILWITH } ;
                     NIL operation }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SET_DELEGATE ;
                         NIL operation ;
                         SWAP ;
                         CONS }
                       { DROP ;
                         DUP ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         NIL operation } } }
               { IF_LEFT
                   { IF_LEFT
                       { PUSH bool False ;
                         DUP 3 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Betting is paused by admin." ; FAILWITH } ;
                         SOURCE ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "Betting not allowed through contract" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {}
                            { SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              PUSH (option
                                      (map int
                                           (pair (pair (mutez %amount) (pair %range int int))
                                                 (pair (int %stakedAt) (pair (bool %withdrawn) (mutez %withdrawnAmount))))))
                                   (Some {}) ;
                              SENDER ;
                              UPDATE ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SWAP } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         GET ;
                         IF_NONE { PUSH int 13 ; FAILWITH } {} ;
                         DIG 2 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 4 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         MEM ;
                         IF { PUSH string "You have already placed bet for this cycle." ; FAILWITH }
                            {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         AMOUNT ;
                         COMPARE ;
                         LE ;
                         IF {} { PUSH string "Bet more than limit" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 4 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 20 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 3 ;
                         CDR ;
                         PAIR ;
                         MEM ;
                         IF {} { PUSH string "Invalid Range" ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 4 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         MEM ;
                         IF {} { PUSH string "Betting not initiated for this cycle." ; FAILWITH } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP ;
                         SENDER ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 46 ; FAILWITH } {} ;
                         PUSH (pair (bool %withdrawn) (mutez %withdrawnAmount)) (Pair False 0) ;
                         DUP 10 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         PAIR %stakedAt ;
                         DIG 8 ;
                         DUP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 10 ;
                         CDR ;
                         PAIR ;
                         AMOUNT ;
                         PAIR %amount %range ;
                         PAIR ;
                         SOME ;
                         DIG 9 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         UPDATE ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DUP ;
                         DIG 6 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 8 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 49 ; FAILWITH } {} ;
                         UNPAIR ;
                         UNPAIR ;
                         AMOUNT ;
                         DIG 10 ;
                         DUP ;
                         CDR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 49 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         DIG 10 ;
                         DUP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 12 ;
                         CDR ;
                         PAIR ;
                         GET ;
                         IF_NONE { PUSH int 49 ; FAILWITH } {} ;
                         ADD ;
                         SOME ;
                         DIG 9 ;
                         UNPAIR ;
                         SWAP ;
                         PAIR ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DUP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         DUP ;
                         DIG 5 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         DUP ;
                         DUG 7 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH int 50 ; FAILWITH } {} ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         AMOUNT ;
                         DIG 9 ;
                         DUP ;
                         CDR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 37 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         GET ;
                         IF_NONE { PUSH int 50 ; FAILWITH } {} ;
                         GET 6 ;
                         ADD ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         NIL operation }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         NIL operation ;
                         SENDER ;
                         CONTRACT unit ;
                         IF_NONE { PUSH int 129 ; FAILWITH } {} ;
                         DIG 2 ;
                         UNIT ;
                         TRANSFER_TOKENS ;
                         CONS } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-Authorized" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         PUSH bool False ;
                         DIG 5 ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         IF {} { PUSH string "Un-authorized" ; FAILWITH } ;
                         PUSH int 0 ;
                         EMPTY_MAP (pair int int) mutez ;
                         PUSH int 0 ;
                         DUP 5 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         COMPARE ;
                         LE ;
                         LOOP { DIG 4 ;
                                DUP ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CAR ;
                                SWAP ;
                                DUP ;
                                DUG 6 ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CDR ;
                                DUP 3 ;
                                ADD ;
                                COMPARE ;
                                LE ;
                                IF { SWAP ;
                                     PUSH (option mutez) (Some 0) ;
                                     DUP 6 ;
                                     CDR ;
                                     CAR ;
                                     CDR ;
                                     CDR ;
                                     DUP 4 ;
                                     ADD ;
                                     DUP 4 ;
                                     PAIR ;
                                     UPDATE ;
                                     PUSH (option mutez) (Some 0) ;
                                     DUP 3 ;
                                     PUSH int -1 ;
                                     MUL ;
                                     DUP 7 ;
                                     CDR ;
                                     CAR ;
                                     CDR ;
                                     CDR ;
                                     DUP 5 ;
                                     ADD ;
                                     PUSH int -1 ;
                                     MUL ;
                                     PAIR ;
                                     UPDATE ;
                                     SWAP }
                                   { SWAP ;
                                     PUSH (option mutez) (Some 0) ;
                                     DIG 2 ;
                                     DUP ;
                                     DUP ;
                                     DUG 4 ;
                                     PAIR ;
                                     UPDATE ;
                                     PUSH (option mutez) (Some 0) ;
                                     DUP 3 ;
                                     PUSH int -1 ;
                                     MUL ;
                                     DUP 4 ;
                                     PUSH int -1 ;
                                     MUL ;
                                     PAIR ;
                                     UPDATE ;
                                     SWAP } ;
                                DUP 5 ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CDR ;
                                ADD ;
                                DUP 5 ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CAR ;
                                SWAP ;
                                DUP ;
                                DUG 2 ;
                                COMPARE ;
                                LE } ;
                         DROP ;
                         SWAP ;
                         DROP ;
                         DUP 3 ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         PUSH mutez 0 ;
                         DUP 8 ;
                         GET 5 ;
                         PAIR %roi %totalAmount ;
                         DUP 7 ;
                         PAIR %referencePrice ;
                         PUSH (pair (bool %concluded) (int %endingPrice)) (Pair False 0) ;
                         DIG 6 ;
                         PAIR %amountByRange ;
                         PAIR ;
                         SOME ;
                         DIG 6 ;
                         DUP ;
                         GET 7 ;
                         SWAP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 57 ; FAILWITH } {} ;
                         CAR ;
                         ADD ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CAR ;
                         PUSH int 1 ;
                         DUP 4 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         LEVEL ;
                         EDIV ;
                         IF_NONE { PUSH int 57 ; FAILWITH } {} ;
                         CAR ;
                         SUB ;
                         MEM ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              DUP ;
                              PUSH int 1 ;
                              DIG 7 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              LEVEL ;
                              EDIV ;
                              IF_NONE { PUSH int 57 ; FAILWITH } {} ;
                              CAR ;
                              SUB ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 79 ; FAILWITH } {} ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CAR ;
                              DIG 8 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              DUP ;
                              UNPAIR ;
                              SWAP ;
                              UNPAIR ;
                              UNPAIR ;
                              DUP ;
                              PUSH int 1 ;
                              DIG 6 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              LEVEL ;
                              EDIV ;
                              IF_NONE { PUSH int 57 ; FAILWITH } {} ;
                              CAR ;
                              SUB ;
                              DUP ;
                              DUG 2 ;
                              GET ;
                              IF_NONE { PUSH int 80 ; FAILWITH } {} ;
                              UNPAIR ;
                              UNPAIR ;
                              SWAP ;
                              CDR ;
                              PUSH bool True ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              PAIR ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              PAIR }
                            { DROP } } ;
                     NIL operation } } } ;
         PAIR } }
