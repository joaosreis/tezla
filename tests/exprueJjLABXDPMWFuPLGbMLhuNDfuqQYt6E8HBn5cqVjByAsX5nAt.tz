{ parameter (pair :FrozenTypes.param (mutez %amount) (address %beneficiary)) ;
  storage
    (pair :FrozenTypes.storage (set %fund_owners address) (timestamp %unfrozen)) ;
  code { DUP ;
         CAR ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         CDR ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         CAR ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         CAR ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CDR ;
         PUSH unit Unit ;
         DUP ;
         DROP ;
         AMOUNT ;
         PUSH mutez 0 ;
         DUP ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         COMPARE ;
         GT ;
         DUP ;
         IF { PUSH string "frozen contract cannot accept positive amount transfer" ;
              DUP ;
              FAILWITH }
            { UNIT } ;
         DUP ;
         DROP ;
         PUSH unit Unit ;
         DUP ;
         DROP ;
         SOURCE ;
         DIG 8 ;
         DUP ;
         DUG 9 ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         MEM ;
         DUP ;
         NOT ;
         DUP ;
         IF { PUSH string "source of operation is not whitelisted for withdrawal operations" ;
              DUP ;
              FAILWITH }
            { UNIT } ;
         DUP ;
         DROP ;
         PUSH unit Unit ;
         DUP ;
         DROP ;
         NOW ;
         DIG 12 ;
         DUP ;
         DUG 13 ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         COMPARE ;
         LT ;
         DUP ;
         IF { PUSH string "deposit still frozen" ; DUP ; FAILWITH } { UNIT } ;
         DUP ;
         DROP ;
         PUSH unit Unit ;
         DUP ;
         DROP ;
         BALANCE ;
         DIG 18 ;
         DUP ;
         DUG 19 ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         COMPARE ;
         LT ;
         DUP ;
         IF { PUSH string "requested withdrawal amount exceeds the balance" ;
              DUP ;
              FAILWITH }
            { UNIT } ;
         DUP ;
         DROP ;
         PUSH unit Unit ;
         DIP { DROP 13 } ;
         DUP ;
         DROP ;
         DIG 10 ;
         DUP ;
         DUG 11 ;
         CAR ;
         DIG 11 ;
         DUP ;
         DUG 12 ;
         CDR ;
         DUP ;
         CONTRACT unit ;
         DUP ;
         IF_NONE
           { PUSH string "incorrect or not-supported beneficiary address" ;
             DUP ;
             FAILWITH }
           { PUSH unit Unit ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             DIG 5 ;
             DUP ;
             DUG 6 ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             TRANSFER_TOKENS ;
             DUP ;
             DIP { DROP 3 } } ;
         NIL operation ;
         DUP ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CONS ;
         DIG 15 ;
         DUP ;
         DUG 16 ;
         DIG 1 ;
         DUP ;
         DUG 2 ;
         PAIR ;
         DUP ;
         DIP { DROP 7 } ;
         DUP ;
         DIP { DROP 13 } } }
