{ storage
    (pair (pair (address %admin) (big_map %grid (pair nat nat) bool))
          (pair (address %land_nft_address) (pair (nat %lands) (int %pixels_sold)))) ;
  parameter (pair (pair (nat %height) (nat %width)) (pair (nat %x) (nat %y))) ;
  code { UNPAIR ;
         PUSH mutez 0 ;
         PUSH mutez 1 ;
         PUSH nat 100 ;
         DIG 3 ;
         DUP ;
         CAR ;
         CAR ;
         SWAP ;
         DUP ;
         DUG 5 ;
         CAR ;
         CDR ;
         MUL ;
         MUL ;
         MUL ;
         COMPARE ;
         GT ;
         IF {}
            { PUSH string
                   "WrongCondition: sp.mutez((params.width * params.height) * 100) > sp.tez(0)" ;
              FAILWITH } ;
         PUSH mutez 1 ;
         PUSH nat 100 ;
         DIG 2 ;
         DUP ;
         CAR ;
         CAR ;
         SWAP ;
         DUP ;
         DUG 4 ;
         CAR ;
         CDR ;
         MUL ;
         MUL ;
         MUL ;
         AMOUNT ;
         COMPARE ;
         GE ;
         IF {}
            { PUSH string
                   "WrongCondition: sp.amount >= sp.mutez((params.width * params.height) * 100)" ;
              FAILWITH } ;
         DUP ;
         CAR ;
         CDR ;
         PUSH nat 0 ;
         DUP ;
         DUP 3 ;
         COMPARE ;
         GT ;
         LOOP { DUP 3 ;
                CAR ;
                CAR ;
                PUSH nat 0 ;
                DUP ;
                DUP 3 ;
                COMPARE ;
                GT ;
                LOOP { DUP 6 ;
                       CAR ;
                       CDR ;
                       SWAP ;
                       DUP ;
                       DUG 2 ;
                       DUP 7 ;
                       GET 4 ;
                       ADD ;
                       DUP 5 ;
                       DUP 8 ;
                       GET 3 ;
                       ADD ;
                       PAIR ;
                       MEM ;
                       IF { DUP ;
                            DUP 6 ;
                            GET 4 ;
                            ADD ;
                            INT ;
                            DUP 4 ;
                            DUP 7 ;
                            GET 3 ;
                            ADD ;
                            INT ;
                            PAIR ;
                            PUSH string "contains pixel that has been bought already" ;
                            PAIR ;
                            FAILWITH }
                          {} ;
                       DIG 5 ;
                       UNPAIR ;
                       UNPAIR ;
                       SWAP ;
                       PUSH (option bool) (Some True) ;
                       DUP 5 ;
                       DUP 10 ;
                       GET 4 ;
                       ADD ;
                       DUP 8 ;
                       DUP 11 ;
                       GET 3 ;
                       ADD ;
                       PAIR ;
                       UPDATE ;
                       SWAP ;
                       PAIR ;
                       SWAP ;
                       UNPAIR ;
                       SWAP ;
                       UNPAIR ;
                       SWAP ;
                       PUSH int 1 ;
                       ADD ;
                       SWAP ;
                       PAIR ;
                       SWAP ;
                       PAIR ;
                       SWAP ;
                       PAIR ;
                       DUG 5 ;
                       PUSH nat 1 ;
                       ADD ;
                       DUP ;
                       DUP 3 ;
                       COMPARE ;
                       GT } ;
                DROP 2 ;
                PUSH nat 1 ;
                ADD ;
                DUP ;
                DUP 3 ;
                COMPARE ;
                GT } ;
         DROP 2 ;
         NIL operation ;
         DUP 3 ;
         GET 3 ;
         CONTRACT %mint
           (pair (pair (pair (nat %height) (string %image))
                       (pair (string %link) (pair (map %metadata string bytes) (bool %nsfw))))
                 (pair (pair (address %owner) (pair (string %title) (nat %token_id)))
                       (pair (nat %width) (pair (nat %x) (nat %y))))) ;
         IF_NONE { PUSH string "Invalid Interface" ; FAILWITH } {} ;
         PUSH mutez 0 ;
         DIG 3 ;
         DUP ;
         GET 4 ;
         SWAP ;
         DUP ;
         DUG 5 ;
         GET 3 ;
         PAIR %x %y ;
         DUP 5 ;
         CAR ;
         CDR ;
         PAIR %width ;
         DUP 6 ;
         GET 5 ;
         PUSH string "" ;
         PAIR %title %token_id ;
         SENDER ;
         PAIR %owner ;
         PAIR ;
         PUSH (pair (string %link) (pair (map %metadata string bytes) (bool %nsfw)))
              (Pair "" (Pair {} False)) ;
         PUSH string "" ;
         DIG 6 ;
         CAR ;
         CAR ;
         PAIR %height %image ;
         PAIR ;
         PAIR ;
         TRANSFER_TOKENS ;
         CONS ;
         SWAP ;
         UNPAIR ;
         SWAP ;
         UNPAIR ;
         SWAP ;
         UNPAIR ;
         PUSH nat 1 ;
         ADD ;
         PAIR ;
         SWAP ;
         PAIR ;
         SWAP ;
         PAIR ;
         SWAP ;
         PAIR } }
