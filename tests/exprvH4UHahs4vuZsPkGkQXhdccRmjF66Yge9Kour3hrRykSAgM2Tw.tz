{ parameter (or (nat %inject) (nat %retrieve)) ;
  storage
    (pair (pair (nat %contract_balance) (address %contract_owner))
          (map %donors address nat)) ;
  code { UNPAIR ;
         IF_LEFT
           { PUSH mutez 1 ;
             AMOUNT ;
             EDIV ;
             IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
             CAR ;
             SWAP ;
             DUP ;
             DUG 2 ;
             SWAP ;
             COMPARE ;
             EQ ;
             IF {}
                { PUSH string "Error: Real amount of mutez sent doesn't match your declaration." ;
                  FAILWITH } ;
             SWAP ;
             DUP ;
             DUG 2 ;
             CDR ;
             SOURCE ;
             GET ;
             DUP 3 ;
             CDR ;
             DUG 2 ;
             IF_NONE { PUSH nat 0 } {} ;
             ADD ;
             SOME ;
             SOURCE ;
             UPDATE ;
             SWAP ;
             CAR ;
             PAIR ;
             NIL operation ;
             PAIR }
           { SWAP ;
             DUP ;
             DUG 2 ;
             CAR ;
             CDR ;
             SOURCE ;
             COMPARE ;
             EQ ;
             NOT ;
             IF { PUSH string "Forbidden: You're not the owner." ; FAILWITH } {} ;
             SWAP ;
             DUP ;
             DUG 2 ;
             CAR ;
             CAR ;
             SWAP ;
             DUP ;
             DUG 2 ;
             COMPARE ;
             GT ;
             IF { PUSH string "Forbidden: Not enough funds in contract's balance." ;
                  FAILWITH }
                {} ;
             SWAP ;
             DUP ;
             DUG 2 ;
             CDR ;
             DUP 3 ;
             CAR ;
             CDR ;
             DUP 3 ;
             DIG 4 ;
             CAR ;
             CAR ;
             SUB ;
             ABS ;
             PAIR ;
             PAIR ;
             PUSH mutez 1 ;
             DIG 2 ;
             MUL ;
             SOURCE ;
             CONTRACT unit ;
             IF_NONE { PUSH string "bad address for get_contract" ; FAILWITH } {} ;
             SWAP ;
             UNIT ;
             TRANSFER_TOKENS ;
             SWAP ;
             NIL operation ;
             DIG 2 ;
             CONS ;
             PAIR } } }
