{ storage
    (pair (pair (pair (address %ICOadmin) (nat %contributed))
                (pair (big_map %contributionMap
                         address
                         (pair (nat %group1amount) (pair (nat %group2amount) (nat %group3amount))))
                      (address %dAddr)))
          (pair (pair (nat %max_xtz) (address %sponsorAddr))
                (pair (timestamp %start) (address %t_addr)))) ;
  parameter (or (int %buy) (or (unit %claim) (unit %releaseFunds))) ;
  code { UNPAIR ;
         IF_LEFT
           { SWAP ;
             DUP ;
             DUG 2 ;
             GET 5 ;
             PUSH int 2592000 ;
             ADD ;
             NOW ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "Sale has ended" ; FAILWITH } ;
             SWAP ;
             DUP ;
             GET 3 ;
             CAR ;
             SWAP ;
             DUP ;
             DUG 3 ;
             CAR ;
             CAR ;
             CDR ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "Max contribution exceeded" ; FAILWITH } ;
             PUSH mutez 1000000 ;
             PUSH nat 0 ;
             MUL ;
             AMOUNT ;
             COMPARE ;
             GT ;
             IF {} { PUSH string "Quantity is 0" ; FAILWITH } ;
             DUP ;
             PUSH int 4 ;
             COMPARE ;
             GT ;
             IF {} { PUSH string "wrong option" ; FAILWITH } ;
             SWAP ;
             DUP ;
             DUG 2 ;
             CAR ;
             GET 3 ;
             SENDER ;
             MEM ;
             IF {}
                { SWAP ;
                  UNPAIR ;
                  UNPAIR ;
                  SWAP ;
                  UNPAIR ;
                  PUSH nat 0 ;
                  DUP ;
                  DUP ;
                  PAIR 3 ;
                  SOME ;
                  SENDER ;
                  UPDATE ;
                  PAIR ;
                  SWAP ;
                  PAIR ;
                  PAIR ;
                  SWAP } ;
             DUP ;
             PUSH int 1 ;
             COMPARE ;
             EQ ;
             IF { SWAP ;
                  UNPAIR ;
                  UNPAIR ;
                  SWAP ;
                  UNPAIR ;
                  DUP ;
                  SENDER ;
                  DUP ;
                  DUG 2 ;
                  GET ;
                  IF_NONE { PUSH int 183 ; FAILWITH } {} ;
                  DUP ;
                  CAR ;
                  PUSH nat 1000000 ;
                  PUSH mutez 1 ;
                  AMOUNT ;
                  EDIV ;
                  IF_NONE { UNIT ; FAILWITH } {} ;
                  CAR ;
                  EDIV ;
                  IF_NONE { PUSH int 183 ; FAILWITH } { CAR } ;
                  ADD ;
                  UPDATE 1 ;
                  SOME ;
                  SWAP ;
                  UPDATE ;
                  PAIR ;
                  SWAP ;
                  PAIR ;
                  PAIR ;
                  SWAP }
                {} ;
             DUP ;
             PUSH int 2 ;
             COMPARE ;
             EQ ;
             IF { SWAP ;
                  UNPAIR ;
                  UNPAIR ;
                  SWAP ;
                  UNPAIR ;
                  DUP ;
                  SENDER ;
                  DUP ;
                  DUG 2 ;
                  GET ;
                  IF_NONE { PUSH int 185 ; FAILWITH } {} ;
                  DUP ;
                  GET 3 ;
                  PUSH nat 1000000 ;
                  PUSH mutez 1 ;
                  AMOUNT ;
                  EDIV ;
                  IF_NONE { UNIT ; FAILWITH } {} ;
                  CAR ;
                  EDIV ;
                  IF_NONE { PUSH int 185 ; FAILWITH } { CAR } ;
                  ADD ;
                  UPDATE 3 ;
                  SOME ;
                  SWAP ;
                  UPDATE ;
                  PAIR ;
                  SWAP ;
                  PAIR ;
                  PAIR ;
                  SWAP }
                {} ;
             PUSH int 3 ;
             COMPARE ;
             EQ ;
             IF { UNPAIR ;
                  UNPAIR ;
                  SWAP ;
                  UNPAIR ;
                  DUP ;
                  SENDER ;
                  DUP ;
                  DUG 2 ;
                  GET ;
                  IF_NONE { PUSH int 187 ; FAILWITH } {} ;
                  DUP ;
                  GET 4 ;
                  PUSH nat 1000000 ;
                  PUSH mutez 1 ;
                  AMOUNT ;
                  EDIV ;
                  IF_NONE { UNIT ; FAILWITH } {} ;
                  CAR ;
                  EDIV ;
                  IF_NONE { PUSH int 187 ; FAILWITH } { CAR } ;
                  ADD ;
                  UPDATE 4 ;
                  SOME ;
                  SWAP ;
                  UPDATE ;
                  PAIR ;
                  SWAP ;
                  PAIR ;
                  PAIR }
                {} ;
             UNPAIR ;
             UNPAIR ;
             UNPAIR ;
             SWAP ;
             PUSH nat 1000000 ;
             PUSH mutez 1 ;
             AMOUNT ;
             EDIV ;
             IF_NONE { UNIT ; FAILWITH } {} ;
             CAR ;
             EDIV ;
             IF_NONE { PUSH int 188 ; FAILWITH } { CAR } ;
             ADD ;
             SWAP ;
             PAIR ;
             PAIR ;
             PAIR ;
             NIL operation }
           { IF_LEFT
               { DROP ;
                 DUP ;
                 GET 5 ;
                 PUSH int 1800 ;
                 ADD ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 IF {} { PUSH string "funds are not yet released" ; FAILWITH } ;
                 DUP ;
                 GET 5 ;
                 PUSH int 1800 ;
                 ADD ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 IF { DUP ;
                      CAR ;
                      GET 3 ;
                      PUSH nat 0 ;
                      SWAP ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 193 ; FAILWITH } {} ;
                      CAR ;
                      COMPARE ;
                      GT }
                    { PUSH bool False } ;
                 IF { DUP ;
                      GET 6 ;
                      CONTRACT %transfer (pair address (pair address nat)) ;
                      IF_NONE { PUSH int 194 ; FAILWITH } {} ;
                      NIL operation ;
                      SWAP ;
                      PUSH mutez 0 ;
                      PUSH nat 1300000 ;
                      DUP 5 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 202 ; FAILWITH } {} ;
                      CAR ;
                      MUL ;
                      SENDER ;
                      SELF_ADDRESS ;
                      PAIR 3 ;
                      TRANSFER_TOKENS ;
                      CONS ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      DUP ;
                      SENDER ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 207 ; FAILWITH } {} ;
                      PUSH nat 0 ;
                      UPDATE 1 ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      SWAP }
                    { NIL operation } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 5 ;
                 PUSH int 3600 ;
                 ADD ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 IF { PUSH nat 0 ;
                      DUP 3 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 210 ; FAILWITH } {} ;
                      GET 3 ;
                      COMPARE ;
                      GT }
                    { PUSH bool False } ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      GET 6 ;
                      CONTRACT %transfer (pair address (pair address nat)) ;
                      IF_NONE { PUSH int 211 ; FAILWITH } {} ;
                      PUSH mutez 0 ;
                      PUSH nat 1600000 ;
                      DUP 5 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 219 ; FAILWITH } {} ;
                      GET 3 ;
                      MUL ;
                      SENDER ;
                      SELF_ADDRESS ;
                      PAIR 3 ;
                      TRANSFER_TOKENS ;
                      CONS ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      DUP ;
                      SENDER ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 224 ; FAILWITH } {} ;
                      PUSH nat 0 ;
                      UPDATE 3 ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      SWAP }
                    {} ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 5 ;
                 PUSH int 5400 ;
                 ADD ;
                 NOW ;
                 COMPARE ;
                 GT ;
                 IF { PUSH nat 0 ;
                      DUP 3 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 226 ; FAILWITH } {} ;
                      GET 4 ;
                      COMPARE ;
                      GT }
                    { PUSH bool False } ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      GET 6 ;
                      CONTRACT %transfer (pair address (pair address nat)) ;
                      IF_NONE { PUSH int 227 ; FAILWITH } {} ;
                      PUSH mutez 0 ;
                      PUSH nat 1800000 ;
                      DUP 5 ;
                      CAR ;
                      GET 3 ;
                      SENDER ;
                      GET ;
                      IF_NONE { PUSH int 235 ; FAILWITH } {} ;
                      GET 4 ;
                      MUL ;
                      SENDER ;
                      SELF_ADDRESS ;
                      PAIR 3 ;
                      TRANSFER_TOKENS ;
                      CONS ;
                      SWAP ;
                      UNPAIR ;
                      UNPAIR ;
                      SWAP ;
                      UNPAIR ;
                      DUP ;
                      SENDER ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 240 ; FAILWITH } {} ;
                      PUSH nat 0 ;
                      UPDATE 4 ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      SWAP }
                    {} }
               { DROP ;
                 DUP ;
                 CAR ;
                 CAR ;
                 CAR ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 IF {} { PUSH string "you are not an admin" ; FAILWITH } ;
                 DUP ;
                 CAR ;
                 CAR ;
                 CAR ;
                 CONTRACT unit ;
                 IF_NONE { PUSH int 251 ; FAILWITH } {} ;
                 NIL operation ;
                 SWAP ;
                 PUSH nat 10 ;
                 BALANCE ;
                 PUSH nat 6 ;
                 MUL ;
                 EDIV ;
                 IF_NONE { PUSH int 248 ; FAILWITH } {} ;
                 CAR ;
                 UNIT ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 GET 3 ;
                 CDR ;
                 CONTRACT unit ;
                 IF_NONE { PUSH int 252 ; FAILWITH } {} ;
                 PUSH nat 10 ;
                 BALANCE ;
                 PUSH nat 3 ;
                 MUL ;
                 EDIV ;
                 IF_NONE { PUSH int 249 ; FAILWITH } {} ;
                 CAR ;
                 UNIT ;
                 TRANSFER_TOKENS ;
                 CONS ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET 4 ;
                 CONTRACT unit ;
                 IF_NONE { PUSH int 253 ; FAILWITH } {} ;
                 PUSH nat 10 ;
                 BALANCE ;
                 PUSH nat 1 ;
                 MUL ;
                 EDIV ;
                 IF_NONE { PUSH int 250 ; FAILWITH } {} ;
                 CAR ;
                 UNIT ;
                 TRANSFER_TOKENS ;
                 CONS } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
