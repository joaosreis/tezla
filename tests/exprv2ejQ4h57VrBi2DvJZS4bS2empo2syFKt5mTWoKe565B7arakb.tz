{ parameter
    (or (or (or (or (pair %addDocument string bytes) (pair %approve (address %spender) (nat %value)))
                (or (unit %claimOwnership)
                    (pair %getAllowance (pair (address %owner) (address %spender)) (contract nat))))
            (or (or (pair %getBalance (address %owner) (contract nat)) (contract %getOwner address))
                (or (pair %getTotalSupply unit (contract nat)) (address %proposeNewOwner))))
        (or (list %setVerificationModules address)
            (pair %transfer (address %from) (pair (address %to) (nat %value))))) ;
  storage
    (pair (pair (pair (map %documentStorage string (list bytes))
                      (big_map %ledger address (pair (map %allowances address nat) (nat %balance))))
                (pair (address %owner) (address %proposedOwner)))
          (pair (nat %totalSupply) (list %verificationModules address))) ;
  code { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         PUSH mutez 0 ;
         AMOUNT ;
         COMPARE ;
         NEQ ;
         IF { PUSH string "This contract does not accept tezi deposits" ; FAILWITH }
            {} ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "CALLER_NOT_OWNER" ; FAILWITH } {} ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CDR ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         CAR ;
                         CDR ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         DIG 6 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         GET ;
                         IF_NONE { NIL bytes ; DIG 6 ; CONS } { DIG 6 ; CONS } ;
                         DIG 5 ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DUP ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { DROP 2 }
                            { DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              CAR ;
                              CAR ;
                              CDR ;
                              SENDER ;
                              GET ;
                              IF_NONE { PUSH nat 0 ; EMPTY_MAP address nat ; PAIR } {} ;
                              DUP ;
                              CAR ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              GET ;
                              IF_NONE
                                { PUSH unit Unit }
                                { PUSH nat 0 ;
                                  DIG 4 ;
                                  DUP ;
                                  DUG 5 ;
                                  COMPARE ;
                                  GT ;
                                  PUSH nat 0 ;
                                  DIG 2 ;
                                  COMPARE ;
                                  GT ;
                                  AND ;
                                  IF { PUSH string "UnsafeAllowanceChange" ; FAILWITH } { PUSH unit Unit } } ;
                              DROP ;
                              DIG 3 ;
                              DUP ;
                              DUG 4 ;
                              CDR ;
                              DIG 4 ;
                              DUP ;
                              DUG 5 ;
                              CAR ;
                              CDR ;
                              DIG 5 ;
                              DUP ;
                              DUG 6 ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DIG 3 ;
                              DUP ;
                              DUG 4 ;
                              CDR ;
                              DIG 4 ;
                              CAR ;
                              DIG 6 ;
                              DIG 6 ;
                              SWAP ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              SOME ;
                              SENDER ;
                              UPDATE ;
                              DIG 3 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              PAIR } ;
                         NIL operation ;
                         PAIR } }
                   { IF_LEFT
                       { DROP ;
                         DUP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "CALLER_NOT_PROPOSED_OWNER" ; FAILWITH } {} ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CDR ;
                         PAIR ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         CAR ;
                         CAR ;
                         DIG 2 ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         NIL operation ;
                         SWAP ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 4 ;
                         GET ;
                         IF_NONE
                           { DIG 3 ; DROP ; PUSH nat 0 }
                           { CAR ; DIG 4 ; GET ; IF_NONE { PUSH nat 0 } {} } ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DIG 2 ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         NIL operation ;
                         DIG 2 ;
                         PUSH mutez 0 ;
                         DIG 4 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 4 ;
                         GET ;
                         IF_NONE { PUSH nat 0 } { CDR } ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DIG 2 ;
                         PUSH mutez 0 ;
                         DIG 2 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         TRANSFER_TOKENS ;
                         NIL operation ;
                         SWAP ;
                         CONS ;
                         PAIR } }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DIG 2 ;
                         CDR ;
                         NIL operation ;
                         SWAP ;
                         PUSH mutez 0 ;
                         DIG 3 ;
                         CDR ;
                         CAR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "CALLER_NOT_OWNER" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         SWAP ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         NIL operation ;
                         PAIR } } } }
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CDR ;
                 CAR ;
                 SENDER ;
                 COMPARE ;
                 NEQ ;
                 IF { PUSH string "CALLER_NOT_OWNER" ; FAILWITH } {} ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 PAIR ;
                 SWAP ;
                 CAR ;
                 PAIR ;
                 NIL operation ;
                 PAIR }
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CDR ;
                 PAIR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 DIG 2 ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 COMPARE ;
                 EQ ;
                 IF { DROP ; SWAP ; DROP ; SWAP ; DROP }
                    { SWAP ;
                      DUP ;
                      DUG 2 ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      DIG 4 ;
                      DUP ;
                      DUG 5 ;
                      DUP ;
                      SENDER ;
                      COMPARE ;
                      NEQ ;
                      IF { DIG 2 ;
                           CAR ;
                           CAR ;
                           CDR ;
                           SWAP ;
                           GET ;
                           IF_NONE { PUSH string "NotEnoughAllowance" ; FAILWITH } {} ;
                           CAR ;
                           SENDER ;
                           GET ;
                           IF_NONE { PUSH string "NotEnoughAllowance" ; FAILWITH } {} ;
                           COMPARE ;
                           GE ;
                           IF { PUSH unit Unit } { PUSH string "NotEnoughAllowance" ; FAILWITH } }
                         { DROP 3 ; PUSH unit Unit } ;
                      DROP ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      CAR ;
                      CAR ;
                      CDR ;
                      DIG 3 ;
                      DUP ;
                      DUG 4 ;
                      GET ;
                      IF_NONE { PUSH nat 0 ; EMPTY_MAP address nat ; PAIR } {} ;
                      DUP ;
                      CDR ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      COMPARE ;
                      GT ;
                      IF { PUSH string "NotEnoughBalance" ; FAILWITH } {} ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      CDR ;
                      SUB ;
                      ABS ;
                      SWAP ;
                      CAR ;
                      PAIR ;
                      SENDER ;
                      DIG 4 ;
                      DUP ;
                      DUG 5 ;
                      COMPARE ;
                      NEQ ;
                      IF { DUP ;
                           CAR ;
                           SENDER ;
                           GET ;
                           IF_NONE { PUSH string "NotEnoughAllowance" ; FAILWITH } {} ;
                           PUSH int 0 ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           SUB ;
                           COMPARE ;
                           LT ;
                           IF { DROP ; PUSH string "NotEnoughAllowance" ; FAILWITH }
                              { SWAP ;
                                DUP ;
                                DUG 2 ;
                                CDR ;
                                DIG 2 ;
                                CAR ;
                                DIG 3 ;
                                DUP ;
                                DUG 4 ;
                                DIG 3 ;
                                SUB ;
                                ABS ;
                                SOME ;
                                SENDER ;
                                UPDATE ;
                                PAIR } }
                         {} ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      CDR ;
                      DIG 3 ;
                      DUP ;
                      DUG 4 ;
                      CAR ;
                      CDR ;
                      DIG 4 ;
                      DUP ;
                      DUG 5 ;
                      CAR ;
                      CAR ;
                      CDR ;
                      DIG 3 ;
                      DIG 6 ;
                      SWAP ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      DIG 4 ;
                      CAR ;
                      CAR ;
                      CAR ;
                      PAIR ;
                      PAIR ;
                      PAIR ;
                      DUP ;
                      CAR ;
                      CAR ;
                      CDR ;
                      DIG 3 ;
                      DUP ;
                      DUG 4 ;
                      GET ;
                      IF_NONE { PUSH nat 0 ; EMPTY_MAP address nat ; PAIR } {} ;
                      DIG 2 ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      CDR ;
                      ADD ;
                      SWAP ;
                      CAR ;
                      PAIR ;
                      SWAP ;
                      DUP ;
                      DUG 2 ;
                      CDR ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      CAR ;
                      CDR ;
                      DIG 3 ;
                      DUP ;
                      DUG 4 ;
                      CAR ;
                      CAR ;
                      CDR ;
                      DIG 3 ;
                      DIG 5 ;
                      SWAP ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      DIG 3 ;
                      CAR ;
                      CAR ;
                      CAR ;
                      PAIR ;
                      PAIR ;
                      PAIR } ;
                 DUG 2 ;
                 NIL operation ;
                 DIG 2 ;
                 CDR ;
                 CDR ;
                 ITER { CONTRACT %verifyFA1_2Transfer
                          (pair (address %from) (pair (address %to) (nat %value))) ;
                        IF_NONE { PUSH string "INCORRECT_CONTRACT" ; FAILWITH } {} ;
                        PUSH mutez 0 ;
                        DIG 3 ;
                        DUP ;
                        DUG 4 ;
                        TRANSFER_TOKENS ;
                        CONS } ;
                 SWAP ;
                 DROP ;
                 PAIR } } } }
