{ storage
    (pair (pair (address %admin)
                (pair (mutez %adminBalance)
                      (map %betData int (map int (pair (nat %seed) (list %senderList address))))))
          (pair (pair (map %betSize int nat) (int %currentCycle))
                (pair (nat %earnedAmount) (map %yields int nat)))) ;
  parameter
    (or (or (pair %completeBet (int %betId) (int %betType))
            (or (unit %depositFunds) (int %incrementCycle)))
        (or (pair %placeBet (int %betType) (nat %seed))
            (or (option %updateBaker key_hash) (nat %withdrawAdminFunds)))) ;
  code { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           { IF_LEFT
               { SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 ADD ;
                 COMPARE ;
                 LT ;
                 IF {} { PUSH string "Bet not yet mature" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 MEM ;
                 IF {} { PUSH string "Invalid bet type" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 CDR ;
                 PUSH nat 10000 ;
                 DIG 5 ;
                 DUP ;
                 DUG 6 ;
                 CDR ;
                 CDR ;
                 CDR ;
                 DIG 5 ;
                 DUP ;
                 DUG 6 ;
                 CDR ;
                 GET ;
                 IF_NONE { PUSH int 45 ; FAILWITH } {} ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CDR ;
                 GET ;
                 IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                 CDR ;
                 SIZE ;
                 DIG 7 ;
                 CDR ;
                 CAR ;
                 CAR ;
                 DIG 7 ;
                 DUP ;
                 DUG 8 ;
                 CDR ;
                 GET ;
                 IF_NONE { PUSH int 45 ; FAILWITH } {} ;
                 MUL ;
                 MUL ;
                 EDIV ;
                 IF_NONE { PUSH int 45 ; FAILWITH } { CAR } ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PUSH nat 0 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 PUSH mutez 1 ;
                 PUSH nat 100 ;
                 PUSH nat 10 ;
                 DIG 9 ;
                 CDR ;
                 CDR ;
                 CAR ;
                 MUL ;
                 EDIV ;
                 IF_NONE { PUSH int 49 ; FAILWITH } { CAR } ;
                 MUL ;
                 ADD ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 PAIR ;
                 DUG 2 ;
                 NIL operation ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CDR ;
                 GET ;
                 IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                 CDR ;
                 ITER { DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        CAR ;
                        CDR ;
                        CDR ;
                        DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        CDR ;
                        GET ;
                        IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                        DIG 4 ;
                        DUP ;
                        DUG 5 ;
                        CAR ;
                        GET ;
                        IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                        CDR ;
                        SIZE ;
                        PUSH timestamp "0" ;
                        NOW ;
                        SUB ;
                        ABS ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        CAR ;
                        CDR ;
                        CDR ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        CDR ;
                        GET ;
                        IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                        DIG 6 ;
                        DUP ;
                        DUG 7 ;
                        CAR ;
                        GET ;
                        IF_NONE { PUSH int 42 ; FAILWITH } {} ;
                        CAR ;
                        ADD ;
                        EDIV ;
                        IF_NONE { PUSH int 43 ; FAILWITH } { CDR } ;
                        DIG 3 ;
                        DUP ;
                        DUG 4 ;
                        COMPARE ;
                        EQ ;
                        IF { CONTRACT unit ;
                             IF_NONE { PUSH int 54 ; FAILWITH } {} ;
                             PUSH mutez 1 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             CAR ;
                             CAR ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             GET ;
                             IF_NONE { PUSH int 53 ; FAILWITH } {} ;
                             PUSH nat 100 ;
                             PUSH nat 90 ;
                             DIG 8 ;
                             DUP ;
                             DUG 9 ;
                             CDR ;
                             CDR ;
                             CAR ;
                             MUL ;
                             EDIV ;
                             IF_NONE { PUSH int 53 ; FAILWITH } { CAR } ;
                             ADD ;
                             MUL ;
                             UNIT ;
                             TRANSFER_TOKENS ;
                             CONS }
                           { CONTRACT unit ;
                             IF_NONE { PUSH int 56 ; FAILWITH } {} ;
                             PUSH mutez 1 ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             CAR ;
                             CAR ;
                             DIG 5 ;
                             DUP ;
                             DUG 6 ;
                             CDR ;
                             GET ;
                             IF_NONE { PUSH int 56 ; FAILWITH } {} ;
                             MUL ;
                             UNIT ;
                             TRANSFER_TOKENS ;
                             CONS } ;
                        PUSH nat 1 ;
                        DIG 2 ;
                        ADD ;
                        SWAP } ;
                 SWAP ;
                 DROP ;
                 SWAP ;
                 DROP }
               { IF_LEFT
                   { DROP ;
                     DUP ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { DUP ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          DUP ;
                          CAR ;
                          SWAP ;
                          CDR ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          CAR ;
                          AMOUNT ;
                          ADD ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR }
                        {} }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     CAR ;
                     SWAP ;
                     CDR ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     CAR ;
                     DUP ;
                     CAR ;
                     SWAP ;
                     CDR ;
                     DIG 4 ;
                     ADD ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR } ;
                 NIL operation } }
           { IF_LEFT
               { PUSH mutez 1 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CDR ;
                 CAR ;
                 CAR ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 29 ; FAILWITH } {} ;
                 MUL ;
                 PACK ;
                 AMOUNT ;
                 PACK ;
                 COMPARE ;
                 EQ ;
                 IF {} { PUSH string "incorrect amount sent to the entry point" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 GET ;
                 IF_NONE { PUSH int 30 ; FAILWITH } {} ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CDR ;
                 CAR ;
                 CDR ;
                 MEM ;
                 IF { SWAP ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 31 ; FAILWITH } {} ;
                      DUP ;
                      DIG 8 ;
                      DUP ;
                      DUG 9 ;
                      CDR ;
                      CAR ;
                      CDR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 31 ; FAILWITH } {} ;
                      CAR ;
                      DIG 9 ;
                      DUP ;
                      DUG 10 ;
                      CAR ;
                      CDR ;
                      CDR ;
                      DIG 9 ;
                      DUP ;
                      DUG 10 ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 31 ; FAILWITH } {} ;
                      DIG 10 ;
                      CDR ;
                      CAR ;
                      CDR ;
                      GET ;
                      IF_NONE { PUSH int 31 ; FAILWITH } {} ;
                      CDR ;
                      SENDER ;
                      CONS ;
                      SWAP ;
                      PAIR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 32 ; FAILWITH } {} ;
                      DUP ;
                      DIG 8 ;
                      DUP ;
                      DUG 9 ;
                      CDR ;
                      CAR ;
                      CDR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 32 ; FAILWITH } {} ;
                      CDR ;
                      PUSH nat 100000 ;
                      PUSH timestamp "0" ;
                      NOW ;
                      SUB ;
                      ABS ;
                      DIG 10 ;
                      DUP ;
                      DUG 11 ;
                      CDR ;
                      DIG 12 ;
                      DUP ;
                      DUG 13 ;
                      CAR ;
                      CDR ;
                      CDR ;
                      DIG 12 ;
                      CAR ;
                      GET ;
                      IF_NONE { PUSH int 32 ; FAILWITH } {} ;
                      DIG 12 ;
                      CDR ;
                      CAR ;
                      CDR ;
                      GET ;
                      IF_NONE { PUSH int 32 ; FAILWITH } {} ;
                      CAR ;
                      ADD ;
                      ADD ;
                      EDIV ;
                      IF_NONE { PUSH int 32 ; FAILWITH } { CDR } ;
                      PAIR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR }
                    { SWAP ;
                      DUP ;
                      DUG 2 ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      DIG 5 ;
                      DUP ;
                      DUG 6 ;
                      CAR ;
                      DUP ;
                      DUG 2 ;
                      GET ;
                      IF_NONE { PUSH int 35 ; FAILWITH } {} ;
                      DIG 7 ;
                      CDR ;
                      CAR ;
                      CDR ;
                      NIL address ;
                      SENDER ;
                      CONS ;
                      DIG 8 ;
                      CDR ;
                      PAIR %seed %senderList ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      SWAP ;
                      PAIR ;
                      SWAP ;
                      PAIR ;
                      PAIR } ;
                 NIL operation }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SET_DELEGATE ;
                     NIL operation ;
                     SWAP ;
                     CONS }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {}
                        { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     CAR ;
                     PUSH mutez 1 ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     MUL ;
                     COMPARE ;
                     LE ;
                     IF {}
                        { PUSH string "WrongCondition: sp.mutez(params) <= self.data.adminBalance" ;
                          FAILWITH } ;
                     NIL operation ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CAR ;
                     CAR ;
                     CONTRACT unit ;
                     IF_NONE { PUSH int 79 ; FAILWITH } {} ;
                     PUSH mutez 1 ;
                     DIG 3 ;
                     DUP ;
                     DUG 4 ;
                     MUL ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DIG 2 ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     CAR ;
                     DUP ;
                     CAR ;
                     SWAP ;
                     CDR ;
                     DUP ;
                     CDR ;
                     SWAP ;
                     CAR ;
                     PUSH mutez 1 ;
                     DIG 6 ;
                     MUL ;
                     SWAP ;
                     SUB ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
