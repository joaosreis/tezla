{ parameter (unit %default) ;
  storage (pair (address %fa2) (address %seller)) ;
  code { CDR ;
         DUP ;
         DIP { { { DUP ; CAR ; DIP { CDR } } } ;
               DIP { DIP { PUSH mutez 1000000 ;
                           AMOUNT ;
                           EDIV ;
                           { IF_NONE { { UNIT ; FAILWITH } } {} } ;
                           { { DUP ; CAR ; DIP { CDR } } } ;
                           SWAP ;
                           PUSH mutez 0 ;
                           { { COMPARE ; EQ } ; IF {} { { UNIT ; FAILWITH } } } ;
                           PUSH nat 0 ;
                           PAIR ;
                           SENDER ;
                           PAIR } ;
                     PAIR } ;
               CONTRACT (list (pair address (pair address (pair nat nat)))) ;
               { IF_NONE { { UNIT ; FAILWITH } } {} } ;
               SWAP ;
               DIP { PUSH mutez 0 ; NIL (pair address (pair address (pair nat nat))) } ;
               CONS ;
               TRANSFER_TOKENS ;
               DIP { NIL operation } ;
               CONS } ;
         SWAP ;
         PAIR } }
