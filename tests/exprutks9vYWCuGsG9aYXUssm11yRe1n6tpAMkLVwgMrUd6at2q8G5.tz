{ storage
    (pair (pair (pair (big_map %credentials string string) (string %modulus))
                (pair (big_map %pnyx_accounts address string) (big_map %timestamps int timestamp)))
          (pair (pair (big_map %vote_commitments_1 string string)
                      (big_map %vote_commitments_2 string string))
                (pair (big_map %vote_commitments_3 string string)
                      (big_map %vote_openings string string)))) ;
  parameter
    (or (pair %add_credential (string %credential) (string %token))
        (or (pair %open_commitment (string %token) (string %vote_opening))
            (pair %vote (int %index) (pair (string %token) (string %vote_commitment))))) ;
  code { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           { NOW ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             CAR ;
             CDR ;
             CDR ;
             PUSH int 0 ;
             GET ;
             IF_NONE { PUSH int 37 ; FAILWITH } {} ;
             COMPARE ;
             LT ;
             IF {}
                { PUSH string "WrongCondition: self.data.timestamps[0] < sp.now" ; FAILWITH } ;
             NOW ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             CAR ;
             CDR ;
             CDR ;
             PUSH int 1 ;
             GET ;
             IF_NONE { PUSH int 38 ; FAILWITH } {} ;
             COMPARE ;
             GT ;
             IF {}
                { PUSH string "WrongCondition: self.data.timestamps[1] > sp.now" ; FAILWITH } ;
             SWAP ;
             DUP ;
             DUG 2 ;
             CAR ;
             CDR ;
             CAR ;
             SENDER ;
             MEM ;
             IF {}
                { PUSH string "WrongCondition: self.data.pnyx_accounts.contains(sp.sender)" ;
                  FAILWITH } ;
             SWAP ;
             DUP ;
             CDR ;
             SWAP ;
             CAR ;
             DUP ;
             CDR ;
             SWAP ;
             CAR ;
             DUP ;
             CDR ;
             SWAP ;
             CAR ;
             DIG 4 ;
             DUP ;
             CDR ;
             SWAP ;
             CAR ;
             SOME ;
             SWAP ;
             UPDATE ;
             PAIR ;
             PAIR ;
             PAIR }
           { IF_LEFT
               { NOW ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 PUSH int 2 ;
                 GET ;
                 IF_NONE { PUSH int 64 ; FAILWITH } {} ;
                 COMPARE ;
                 LT ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.timestamps[2] < sp.now" ; FAILWITH } ;
                 NOW ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 PUSH int 3 ;
                 GET ;
                 IF_NONE { PUSH int 65 ; FAILWITH } {} ;
                 COMPARE ;
                 GT ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.timestamps[3] > sp.now" ; FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 MEM ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.vote_commitments_1.contains(params.token)" ;
                      FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CAR ;
                 CDR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 MEM ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.vote_commitments_2.contains(params.token)" ;
                      FAILWITH } ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CDR ;
                 CDR ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 DUG 2 ;
                 CAR ;
                 MEM ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.vote_commitments_3.contains(params.token)" ;
                      FAILWITH } ;
                 SWAP ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 DIG 4 ;
                 DUP ;
                 CAR ;
                 SWAP ;
                 CDR ;
                 SOME ;
                 SWAP ;
                 UPDATE ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR }
               { NOW ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 PUSH int 1 ;
                 GET ;
                 IF_NONE { PUSH int 49 ; FAILWITH } {} ;
                 COMPARE ;
                 LT ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.timestamps[1] < sp.now" ; FAILWITH } ;
                 NOW ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 CAR ;
                 CDR ;
                 CDR ;
                 PUSH int 2 ;
                 GET ;
                 IF_NONE { PUSH int 50 ; FAILWITH } {} ;
                 COMPARE ;
                 GT ;
                 IF {}
                    { PUSH string "WrongCondition: self.data.timestamps[2] > sp.now" ; FAILWITH } ;
                 DUP ;
                 CAR ;
                 PUSH int 1 ;
                 COMPARE ;
                 EQ ;
                 IF { SWAP ;
                      DUP ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DUP ;
                      CDR ;
                      SWAP ;
                      CAR ;
                      DIG 4 ;
                      DUP ;
                      CDR ;
                      CAR ;
                      SWAP ;
                      CDR ;
                      CDR ;
                      SOME ;
                      SWAP ;
                      UPDATE ;
                      PAIR ;
                      PAIR ;
                      SWAP ;
                      PAIR }
                    { DUP ;
                      CAR ;
                      PUSH int 2 ;
                      COMPARE ;
                      EQ ;
                      IF { SWAP ;
                           DUP ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           DUP ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           DIG 4 ;
                           DUP ;
                           CDR ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           CDR ;
                           SOME ;
                           SWAP ;
                           UPDATE ;
                           SWAP ;
                           PAIR ;
                           PAIR ;
                           SWAP ;
                           PAIR }
                         { SWAP ;
                           DUP ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           DUP ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           DIG 4 ;
                           DUP ;
                           CDR ;
                           CAR ;
                           SWAP ;
                           CDR ;
                           CDR ;
                           SOME ;
                           SWAP ;
                           UPDATE ;
                           PAIR ;
                           SWAP ;
                           PAIR ;
                           SWAP ;
                           PAIR } } } } ;
         NIL operation ;
         PAIR } }
