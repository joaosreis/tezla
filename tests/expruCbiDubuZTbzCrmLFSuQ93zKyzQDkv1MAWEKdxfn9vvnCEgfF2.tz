{ parameter
    (or (or (or (or (pair %buy_tickets address (pair nat string))
                    (pair %buy_tickets_with_kolibri address (pair nat string)))
                (or (pair %create_ticket address string) (pair %redeem_ticket address string)))
            (or (or (address %remove_pool) (address %update_admin))
                (or (address %update_kolibri_address) (nat %update_kolibri_ticket_price))))
        (or (or (or (string %update_nickname) (mutez %update_nickname_fee))
                (or (pair %update_pool_addresses address string) (mutez %update_ticket_price)))
            (or (string %update_ticket_types) (unit %withdraw_balance)))) ;
  storage
    (pair (big_map %tickets (pair (address %owner) (string %ticket_type)) (ticket timestamp))
          (pair %data
             (address %admin)
             (pair (big_map %pool_addresses address string)
                   (pair (big_map %nicknames address (pair timestamp string))
                         (pair (set %ticket_types string)
                               (pair (mutez %ticket_price)
                                     (pair (int %ticket_validity)
                                           (pair (mutez %nickname_fee)
                                                 (pair (address %kolibri) (pair (nat %kolibri_ticket_price) (bool %tx_to_kolibri))))))))))) ;
  code { UNPAIR ;
         SWAP ;
         UNPAIR ;
         DIG 2 ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUG 2 ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DUP 4 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         MUL ;
                         AMOUNT ;
                         COMPARE ;
                         NEQ ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         NEQ ;
                         AND ;
                         IF { DROP 5 ; PUSH string "INCORRECT_AMOUNT" ; FAILWITH }
                            { SELF_ADDRESS ;
                              SENDER ;
                              COMPARE ;
                              NEQ ;
                              PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              EQ ;
                              AND ;
                              IF { DROP 5 ; PUSH string "INVALID_SENDER" ; FAILWITH }
                                 { DUP 4 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   NOT ;
                                   SELF_ADDRESS ;
                                   SENDER ;
                                   COMPARE ;
                                   EQ ;
                                   PUSH mutez 0 ;
                                   AMOUNT ;
                                   COMPARE ;
                                   EQ ;
                                   AND ;
                                   AND ;
                                   IF { DROP 5 ; PUSH string "INVALID_KOLIBRI_BUY" ; FAILWITH }
                                      { PUSH nat 0 ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        COMPARE ;
                                        EQ ;
                                        IF { DROP 5 ; PUSH string "ZERO_TICKET_AMOUNT" ; FAILWITH }
                                           { DUP 4 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             DUP 3 ;
                                             MEM ;
                                             NOT ;
                                             IF { DROP 5 ; PUSH string "INVALID_TICKET_TYPE" ; FAILWITH }
                                                { SWAP ;
                                                  DIG 2 ;
                                                  PAIR ;
                                                  DIG 3 ;
                                                  NONE (ticket timestamp) ;
                                                  DUP 3 ;
                                                  GET_AND_UPDATE ;
                                                  IF_NONE
                                                    { DIG 2 ; NOW ; TICKET }
                                                    { READ_TICKET ; SWAP ; DROP ; CDR ; CDR ; DIG 3 ; ADD ; NOW ; TICKET } ;
                                                  SOME ;
                                                  DIG 2 ;
                                                  GET_AND_UPDATE ;
                                                  DROP ;
                                                  SWAP ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  NOT ;
                                                  SELF_ADDRESS ;
                                                  SENDER ;
                                                  COMPARE ;
                                                  EQ ;
                                                  PUSH mutez 0 ;
                                                  AMOUNT ;
                                                  COMPARE ;
                                                  EQ ;
                                                  AND ;
                                                  AND ;
                                                  IF { PUSH bool False ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DUP 3 ;
                                                       CDR ;
                                                       CAR ;
                                                       PAIR ;
                                                       DIG 2 ;
                                                       CAR ;
                                                       PAIR }
                                                     { SWAP } ;
                                                  SWAP ;
                                                  PAIR } } } } } ;
                         NIL operation ;
                         PAIR }
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         IF { DROP 2 ; PUSH string "ONGOING_KOLIBRI_TX" ; FAILWITH }
                            { SELF_ADDRESS ;
                              SENDER ;
                              COMPARE ;
                              EQ ;
                              IF { DROP 2 ; PUSH string "NO_TX_FROM_SELF" ; FAILWITH }
                                 { DUP ;
                                   UNPAIR ;
                                   SWAP ;
                                   CAR ;
                                   SENDER ;
                                   DIG 2 ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 3 ; PUSH string "PLAYER_IS_NOT_SENDER" ; FAILWITH }
                                      { DUP 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        CONTRACT %transfer (pair (address %from) (pair (address %to) (nat %value))) ;
                                        IF_NONE { PUSH string "UNKNOWN_KOLIBRI_CONTRACT" ; FAILWITH } {} ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        DIG 2 ;
                                        MUL ;
                                        DUP 4 ;
                                        CAR ;
                                        PAIR ;
                                        SENDER ;
                                        PAIR ;
                                        SWAP ;
                                        PUSH mutez 0 ;
                                        DIG 2 ;
                                        TRANSFER_TOKENS ;
                                        SELF %buy_tickets ;
                                        PUSH mutez 0 ;
                                        DIG 3 ;
                                        TRANSFER_TOKENS ;
                                        PUSH bool True ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DUP 4 ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DIG 3 ;
                                        CAR ;
                                        PAIR ;
                                        NIL operation ;
                                        DIG 2 ;
                                        CONS ;
                                        DIG 2 ;
                                        CONS ;
                                        PAIR } } } ;
                         UNPAIR ;
                         SWAP ;
                         DIG 2 ;
                         PAIR ;
                         SWAP ;
                         PAIR } }
                   { IF_LEFT
                       { SWAP ;
                         DUG 2 ;
                         UNPAIR ;
                         DUP 3 ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         DUP 4 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         OR ;
                         IF { PAIR ;
                              DIG 2 ;
                              NONE (ticket timestamp) ;
                              DUP 3 ;
                              GET_AND_UPDATE ;
                              IF_NONE
                                { PUSH nat 1 ; NOW ; TICKET }
                                { READ_TICKET ; SWAP ; DROP ; CDR ; CDR ; PUSH nat 1 ; ADD ; NOW ; TICKET } ;
                              SOME ;
                              DIG 2 ;
                              GET_AND_UPDATE ;
                              DROP ;
                              PAIR }
                            { DROP 4 ; PUSH string "FORBIDDEN_OP" ; FAILWITH } ;
                         NIL operation ;
                         PAIR }
                       { SWAP ;
                         DIG 2 ;
                         DUP ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         MEM ;
                         NOT ;
                         IF { DROP 3 ; PUSH string "UNKNOWN_POOL" ; FAILWITH }
                            { DUG 2 ;
                              NONE (ticket timestamp) ;
                              DUP 3 ;
                              GET_AND_UPDATE ;
                              IF_NONE
                                { DROP 2 ; PUSH string "NO_TICKET_TO_REDEEM" ; FAILWITH }
                                { READ_TICKET ;
                                  SWAP ;
                                  DROP ;
                                  CDR ;
                                  UNPAIR ;
                                  PUSH nat 0 ;
                                  DUP 3 ;
                                  COMPARE ;
                                  EQ ;
                                  IF { DROP 4 ; PUSH string "ZERO_TICKET_AMOUNT" ; FAILWITH }
                                     { NOW ;
                                       DUP 6 ;
                                       CDR ;
                                       CDR ;
                                       CDR ;
                                       CDR ;
                                       CDR ;
                                       CAR ;
                                       DIG 2 ;
                                       ADD ;
                                       COMPARE ;
                                       LT ;
                                       IF { DROP 3 ; PUSH string "EXPIRED_TICKETS" ; FAILWITH }
                                          { PUSH nat 1 ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            COMPARE ;
                                            EQ ;
                                            IF { DROP ; NONE (ticket timestamp) ; DIG 2 ; GET_AND_UPDATE ; PAIR }
                                               { PUSH nat 1 ;
                                                 SWAP ;
                                                 SUB ;
                                                 ABS ;
                                                 NOW ;
                                                 TICKET ;
                                                 SOME ;
                                                 DIG 2 ;
                                                 GET_AND_UPDATE ;
                                                 PAIR } } } } ;
                              CDR ;
                              PAIR } ;
                         NIL operation ;
                         PAIR } } }
               { IF_LEFT
                   { IF_LEFT
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              DUP 3 ;
                              CDR ;
                              CAR ;
                              DIG 2 ;
                              NONE string ;
                              SWAP ;
                              UPDATE ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ; CDR ; SWAP ; PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR } }
                   { IF_LEFT
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR } } } }
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         AMOUNT ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "INCORRECT_FEE" ; FAILWITH }
                            { PUSH nat 30 ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              SIZE ;
                              COMPARE ;
                              GT ;
                              IF { DROP 2 ; PUSH string "NICKNAME_GREATER_THAN_30_CHAR" ; FAILWITH }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   GET ;
                                   IF_NONE
                                     { SWAP ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       CDR ;
                                       CDR ;
                                       DUP 3 ;
                                       CDR ;
                                       CDR ;
                                       CAR ;
                                       DIG 2 ;
                                       NOW ;
                                       PAIR ;
                                       SOME ;
                                       SENDER ;
                                       UPDATE ;
                                       PAIR ;
                                       SWAP ;
                                       DUP ;
                                       DUG 2 ;
                                       CDR ;
                                       CAR ;
                                       PAIR ;
                                       SWAP ;
                                       CAR ;
                                       PAIR }
                                     { NOW ;
                                       PUSH int 2592000 ;
                                       DIG 2 ;
                                       CAR ;
                                       ADD ;
                                       COMPARE ;
                                       GT ;
                                       IF { DROP 2 ; PUSH string "UPDATE_UNAVAILABLE" ; FAILWITH }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            DUP 3 ;
                                            CDR ;
                                            CDR ;
                                            CAR ;
                                            DIG 2 ;
                                            NOW ;
                                            PAIR ;
                                            SOME ;
                                            SENDER ;
                                            UPDATE ;
                                            PAIR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            SWAP ;
                                            CAR ;
                                            PAIR } } } } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR } }
                   { IF_LEFT
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { UNPAIR ;
                              DUP 3 ;
                              CDR ;
                              CDR ;
                              DUP 4 ;
                              CDR ;
                              CAR ;
                              DUP 3 ;
                              GET ;
                              IF_NONE
                                { DUP 4 ; CDR ; CAR ; DIG 3 ; DIG 3 ; SWAP ; SOME ; SWAP ; UPDATE }
                                { DROP ; DUP 4 ; CDR ; CAR ; DIG 3 ; SOME ; DIG 3 ; UPDATE } ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR }
                       { DIG 2 ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                            { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         PAIR ;
                         NIL operation ;
                         PAIR } } }
               { IF_LEFT
                   { DIG 2 ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                        { SWAP ;
                          DUP ;
                          DUG 2 ;
                          CDR ;
                          CDR ;
                          CDR ;
                          CAR ;
                          SWAP ;
                          DUP ;
                          DUG 2 ;
                          MEM ;
                          IF { SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               DUP 3 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 2 ;
                               PUSH bool False ;
                               SWAP ;
                               UPDATE ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               CAR ;
                               PAIR }
                             { SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               DUP 3 ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               DIG 2 ;
                               PUSH bool True ;
                               SWAP ;
                               UPDATE ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               CAR ;
                               PAIR } } ;
                     SWAP ;
                     PAIR ;
                     NIL operation ;
                     PAIR }
                   { DROP ;
                     SWAP ;
                     DUP ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { DROP 2 ; PUSH string "NOT_AND_ADMIN" ; FAILWITH }
                        { DUP ;
                          CAR ;
                          CONTRACT unit ;
                          IF_NONE { PUSH string "UNKNOWN_ADDRESS" ; FAILWITH } {} ;
                          SWAP ;
                          DIG 2 ;
                          PAIR ;
                          NIL operation ;
                          DIG 2 ;
                          BALANCE ;
                          UNIT ;
                          TRANSFER_TOKENS ;
                          CONS ;
                          PAIR } } } } } }
